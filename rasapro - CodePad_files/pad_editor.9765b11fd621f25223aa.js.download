"use strict";(self.webpackChunkcodepad=self.webpackChunkcodepad||[]).push([[1190],{9264:(e,t,n)=>{n.r(t),n.d(t,{pageStartup:()=>Tn}),n(31567),n(25221);var i=n(19388),a=n(87514),s=n(89130),o=n(95863),l=n(18370),r=n(58987),d=n(22955);n(44114);const c={theme:{storageName:"theme",default:"Homepage theme"},fontSize:{storageName:"fontSize",default:11},tabChar:{default:"spaces"},tabSize:{default:4},fontFamily:{storageName:"fontFamily",default:"Consolas, consola"},lineWrap:{storageName:"noLineWrap",default:!0,storageReverse:!0},lineNumbersCode:{storageName:"noLineNumbersCode",default:!0,storageReverse:!0},lineNumbersText:{storageName:"noLineNumbersText",default:!0,storageReverse:!0},tabLines:{storageName:"noTabLines",default:!0,storageReverse:!0},epicMode:{storageName:"epic",default:!1,storageReverse:!1},closeBrackets:{storageName:"noCloseBrackets",default:!0,storageReverse:!0},activeLine:{storageName:"noActiveLine",default:!0,storageReverse:!0},languageServer:{storageName:"languageServer",default:!0,storageReverse:!1},autosave:{storageName:"noAutosave",default:!0,storageReverse:!0}};class u{theme="Light";fontSize=(()=>c.fontSize.default)();tabChar=(()=>c.tabChar.default)();tabSize=(()=>c.tabSize.default)();fontFamily=(()=>c.fontFamily.default)();lineWrap=(()=>c.lineWrap.default)();lineNumbersCode=(()=>c.lineNumbersCode.default)();lineNumbersText=(()=>c.lineNumbersText.default)();tabLines=(()=>c.tabLines.default)();epicMode=(()=>c.epicMode.default)();closeBrackets=(()=>c.closeBrackets.default)();activeLine=(()=>c.activeLine.default)();languageServer=(()=>c.languageServer.default)();autosave=(()=>c.autosave.default)();constructor(e){e instanceof u&&(this.theme=e.theme,this.fontSize=e.fontSize,this.tabChar=e.tabChar,this.tabSize=e.tabSize,this.fontFamily=e.fontFamily,this.lineWrap=e.lineWrap,this.lineNumbersCode=e.lineNumbersCode,this.lineNumbersText=e.lineNumbersText,this.tabLines=e.tabLines,this.epicMode=e.epicMode,this.closeBrackets=e.closeBrackets,this.activeLine=e.activeLine,this.languageServer=e.languageServer,this.autosave=e.autosave)}}function h(e,t){let n="";return n=e in t&&null!=t[e]?t[e]:function(e){let t=localStorage.getItem(e.storageName),n=null;return null!=t?("boolean"==typeof e.default?t="true"===t:"number"==typeof e.default&&(t=parseInt(t)),n=e.storageReverse?!t:t):n=e.default,n}(c[e]),n}function m(e){$.ajax({method:"POST",url:"/api/accounts/save_preferences",data:JSON.stringify(e),contentType:"application/json",error:function(e,t){alert(t)}})}function p(e,t,n){if(n){const n=c[e];t===n.default?localStorage.removeItem(n.storageName):n.storageReverse?localStorage.setItem(n.storageName,!t):localStorage.setItem(n.storageName,t)}else{const n={};n[e]=t,m(n)}}function f(e,t,n){$.ajax({method:"POST",url:"/api/projects/set_tab_type",contentType:"application/json",data:JSON.stringify({projectId:e,tabchar:t,tabsize:n}),error:function(e,t){alert(t+" "+e.responseText)}})}class g{#e;constructor(e,t,n){e?"string"==typeof e&&(e=JSON.parse(e)):e={};const i=new u;t&&(i.tabChar=t),n&&(i.tabSize=n);const a=h("theme",e);let s=a;if("Homepage theme"==s){const e=localStorage.getItem("homepageTheme")??"System";s="System"===e?window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"Dark":"Light":e}if(i.theme=s,i.fontSize=h("fontSize",e),i.fontFamily=h("fontFamily",e),i.lineWrap=h("lineWrap",e),i.lineNumbersCode=h("lineNumbersCode",e),i.lineNumbersText=h("lineNumbersText",e),i.tabLines=h("tabLines",e),i.epicMode=h("epicMode",e),"edit"===window.CodePadGlobals.mode&&(i.closeBrackets=h("closeBrackets",e),i.activeLine=h("activeLine",e),i.languageServer=h("languageServer",e),i.autosave=h("autosave",e)),function(e,t){$("#theme-list").val(t),$("#font-sizes").val(e.fontSize),$("#tab-chars").val(e.tabChar),$("#tab-sizes").val(e.tabSize),$("#font-families").val(e.fontFamily),$("#linewrap").prop("checked",e.lineWrap),$("#linenumberscode").prop("checked",e.lineNumbersCode),$("#linenumberstext").prop("checked",e.lineNumbersText),$("#tab-lines").prop("checked",e.tabLines),$("#whoooa").prop("checked",e.epicMode),$("#close-brackets").prop("checked",e.closeBrackets),$("#active-line-mode").prop("checked",e.activeLine),$("#language-server").prop("checked",e.languageServer),$("#autosave").prop("checked",e.autosave)}(i,a),this.#e=Object.freeze(i),window.CodePadGlobals.userId&&Object.values(e).includes(null)){const e={};for(const t in i)e[t]="theme"===t?a:i[t];m(e)}this.changeHandlers=[],this.#t()}get config(){return this.#e}registerChangeHandler(e){this.changeHandlers.push(e)}removeChangeHandler(e){const t=this.changeHandlers.indexOf(e);t>=0&&this.changeHandlers.splice(t,1)}#t(){const e=!window.CodePadGlobals.userId,t=()=>{const t=document.getElementById("theme-list");let n=t.options[t.selectedIndex].value;if(p("theme",n,e),"Homepage theme"==n){const e=localStorage.getItem("homepageTheme")??"System";n="System"===e?window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"Dark":"Light":e}this.#n("theme",n)};$("#theme-list").on("change",t),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(()=>{t()})),$("#font-sizes").on("change",(t=>{const n=t.currentTarget,i=parseInt(n.options[n.selectedIndex].value);this.#n("fontSize",i),p("fontSize",i,e)})),$("#tab-chars").on("change",(e=>{const t=e.currentTarget,n=t.options[t.selectedIndex].value;this.#n("tabChar",n),f(window.CodePadGlobals.projectData.id,n,this.config.tabSize)})),$("#tab-sizes").on("change",(e=>{const t=e.currentTarget,n=parseInt(t.options[t.selectedIndex].value);this.#n("tabSize",n),f(window.CodePadGlobals.projectData.id,this.config.tabChar,n)})),$("#font-families").on("change",(t=>{const n=t.currentTarget,i=n.options[n.selectedIndex].value;this.#n("fontFamily",i),p("fontFamily",i,e)})),$("#linewrap").on("change",(t=>{const n=t.currentTarget.checked;this.#n("lineWrap",n),p("lineWrap",n,e)})),$("#linenumberscode").on("change",(t=>{const n=t.currentTarget.checked;this.#n("lineNumbersCode",n),p("lineNumbersCode",n,e)})),$("#linenumberstext").on("change",(t=>{const n=t.currentTarget.checked;this.#n("lineNumbersText",n),p("lineNumbersText",n,e)})),$("#tab-lines").on("change",(t=>{const n=t.currentTarget.checked;this.#n("tabLines",n),p("tabLines",n,e)})),$("#whoooa").on("change",(t=>{const n=t.currentTarget.checked;this.#n("epicMode",n),p("epicMode",n,e)})),$("#close-brackets").on("change",(t=>{const n=t.currentTarget.checked;this.#n("closeBrackets",n),p("closeBrackets",n,e)})),$("#active-line-mode").on("change",(t=>{const n=t.currentTarget.checked;this.#n("activeLine",n),p("activeLine",n,e)})),$("#language-server").on("change",(t=>{const n=t.currentTarget.checked;this.#n("languageServer",n),p("languageServer",n,e)})),$("#autosave").on("change",(t=>{const n=t.currentTarget.checked;this.#n("autosave",n),p("autosave",n,e)}))}#n(e,t){const n=new u(this.#e);n[e]=t;const i=this.#e;this.#e=Object.freeze(n);for(const e of this.changeHandlers)e(n,i)}}n(18111),n(20116);class b{constructor(){this.onRun=()=>{},this.onStop=()=>{},this.runnableFiles={files:[],isManualMainFile:!1};const e=$("#run-btn-holder");this.runBtnText=e.find(".output-run-btn-text"),this.mainRunBtn=this.runBtnText.closest(".output-run-btn"),this.allRunBtns=e.find(".output-run-btn");const t=$("#run-btn-disabled-tooltip")[0];this.runBtnDisabledTooltip=new bootstrap.Tooltip(t);const n=e.find("#run-btn-tooltip")[0];this.runBtnTooltip=new bootstrap.Tooltip(n),this.isRunning=!1,this._updateTooltipState(),this.wsDisconnected=!0,i.registerDisconnectHandler((()=>{this.wsDisconnected=!0,this.allRunBtns.prop("disabled",!0),this._updateTooltipState()})),i.registerReadyHandler((()=>{this.wsDisconnected=!1,this.runnableFiles.files.length>0&&this.allRunBtns.prop("disabled",!1),this._updateTooltipState()})),this.mainRunBtn.click((()=>{this.isRunning?this.onStop():this.runnableFiles.files.length>0&&this.onRun(this.runnableFiles.files[0])}))}_updateTooltipState(){if(this.wsDisconnected||0===this.runnableFiles.files.length)this.runBtnDisabledTooltip.enable(),this.runBtnTooltip.disable(),this.runBtnTooltip.hide(),this.wsDisconnected?this.runBtnDisabledTooltip.setContent({".tooltip-inner":"Not connected to server"}):this.runBtnDisabledTooltip.setContent({".tooltip-inner":"No files to run"});else if(this.runBtnDisabledTooltip.disable(),this.runBtnDisabledTooltip.hide(),this.isRunning)this.runBtnTooltip.disable(),this.runBtnTooltip.hide();else{this.runBtnTooltip.enable();let e="";if(this.runnableFiles.manualMainFile)e="Run main file";else{const t=this.runnableFiles.files[0];e="Run "+t.slice(t.lastIndexOf("/")+1)}this.runBtnTooltip.setContent({".tooltip-inner":e})}}setOnRun(e){this.onRun=e}setOnStop(e){this.onStop=e}setRunnableFiles(e){this.runnableFiles=e,this.allRunBtns.prop("disabled",0===this.runnableFiles.files.length||this.wsDisconnected),this._updateTooltipState()}showStopButton(){this.allRunBtns.removeClass("btn-primary"),this.allRunBtns.addClass("btn-danger"),this.mainRunBtn.find("i").removeClass("fa-play"),this.mainRunBtn.find("i").addClass("fa-stop"),this.runBtnText.text("Stop"),this.isRunning=!0,this._updateTooltipState()}showRunButton(){this.allRunBtns.removeClass("btn-danger"),this.allRunBtns.addClass("btn-primary"),this.mainRunBtn.find("i").removeClass("fa-stop"),this.mainRunBtn.find("i").addClass("fa-play"),this.runBtnText.text("Run"),this.mainRunBtn.blur(),this.isRunning=!1,this._updateTooltipState()}}let v=null;function E(e){0==$("#cody_agree_dialog").length&&($("body").append('\n<div class="modal fade" id="cody-agree-dialog" tabindex="-1" role="dialog" aria-hidden="true">\n    <div class="modal-dialog modal-dialog-centered modal-xl" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h4 class="modal-title">Cody AI Agreement</h4>\n                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n            </div>\n            <form action="" id="cody-agree-form">\n                <div class="modal-body">\n                    <p>I hereby acknowledge that by using OpenAI\'s ChatGPT, I may be subjected to copyright laws and potential infringement. Furthermore, works derived using the output of ChatGPT may not be protected by copyright laws. Copyright laws vary by country and geographical location.</p>\n                    <p>I acknowledge that I have read and understand this agreement.</p>\n                </div>\n                <div class="modal-footer justify-content-center">\n                    <button type="submit" class="btn btn-primary">Agree</button>\n                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>'),document.getElementById("cody-agree-dialog").addEventListener("hidden.bs.modal",(()=>{v&&(v(),v=null)})));let t=!1;const n=document.getElementById("cody-agree-dialog"),i=bootstrap.Modal.getOrCreateInstance(n);i.show(),$("#cody-agree-form").off("submit"),$("#cody-agree-form").submit((async n=>{n.preventDefault(),n.stopPropagation(),t=!0;const a=await fetch("/api/accounts/ai_agree",{method:"POST"});i.hide(),a.ok?(window.CodePadGlobals.aiAgreed=!0,e&&e(!0)):(e&&e(!1),alert("Something went wrong. Please try again."))})),v=()=>{e&&!t&&e(!1)}}var y=n(88387),w=n(96540),C=n(29377),T=n(30372);function I(){return I=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},I.apply(null,arguments)}const S=(0,w.lazy)((()=>Promise.all([n.e(4342),n.e(567)]).then(n.bind(n,80567)))),D=(0,w.lazy)((()=>n.e(8801).then(n.bind(n,8801))));class P{static get SELF(){return 0}static get AI(){return 1}static get ERROR(){return 2}}class N{static get INVALID_SESSION(){return-1}static get MUST_SIGN_AI_AGREEMENT(){return-2}static get OUT_OF_TOKENS(){return-3}static get INTERNAL_AI_ERROR(){return-4}static get PROMPT_IN_PROGRESS(){return-5}static get TENANT_DISABLED(){return-6}}let x=0;function M(){return x++,x}const F="Hi, I'm Cody, your AI coding assistant! What do you need help with?",A=(0,w.memo)((function({children:e,textToCopy:t}){const[n,i]=(0,w.useState)("Copy");return w.createElement(w.Fragment,null,e,w.createElement("button",{className:"copy-snippet-btn btn btn-outline-secondary btn-sm",onTransitionEnd:e=>{"visibility"===e.propertyName&&i("Copy")},onClick:()=>{navigator.clipboard?(navigator.clipboard.writeText(t),i("Copied!")):i("Copy failed")}},n))})),O=(0,w.memo)((function({text:e}){const t=(0,w.useContext)(y.Dx);return w.createElement(w.Suspense,{fallback:w.createElement("div",null,e)},w.createElement(S,{components:{pre:e=>w.createElement("pre",I({},e,{className:"copyable-snippet"})),code:e=>{const{children:n,className:i,_node:a,...s}=e,o=/language-(\w+)/.exec(i||"");return o?w.createElement(A,{textToCopy:n},w.createElement(D,I({},s,{style:"light"===t?C.A:T.A,language:o[1],PreTag:"div"}),n)):w.createElement("code",I({},s,{className:i}),n)}}},e))})),k=(0,w.memo)((function({text:e}){return w.createElement("div",{className:"mb-2 chat-message-self-wrapper"},w.createElement("span",{className:"chat-message"},e))})),L=(0,w.memo)((function({text:e,finished:t}){let n=null;return t||(n=w.createElement("i",{className:"loading-dots"},"Thinking...")),w.createElement("div",{className:"chat-message-external-wrapper",style:{position:"relative",whiteSpace:"normal"}},w.createElement("div",{className:"mb-2 chat-message",style:{marginLeft:"22px"}},w.createElement(O,{text:e}),n),w.createElement("i",{className:"fa-solid fa-robot",style:{position:"absolute",top:"calc(100% - 12px)"}}))})),R=(0,w.memo)((function({text:e}){return w.createElement("div",{className:"alert alert-warning chat-error-msg mt-2 mb-3"},e)})),_=function(){return w.createElement("div",{className:"alert alert-warning chat-error-msg mb-2 mx-2"},w.createElement("a",{href:"javascript:",onClick:()=>{(0,r.f)()}},"Sign up")," ","to start chatting with Cody!")};let j,G=[];const H=(0,w.memo)((function(){const e=(0,w.useRef)(null),t=(0,w.useRef)(!1),n=(0,w.useRef)(!1),a=(0,w.useRef)(null),[s,o]=(0,w.useState)((()=>[{key:M(),text:F,type:P.AI,responseId:-1,finished:!0}])),[l,r]=(0,w.useState)(!1),[d,c]=(0,w.useState)(!1),[u,h]=(0,w.useState)(!1),[m,p]=(0,w.useState)("btn btn-secondary"),[f,g]=(0,w.useState)("fa-solid fa-microphone"),b=(0,w.useRef)(null);(0,w.useMemo)((()=>{e.current&&e.current.scrollTop+e.current.clientHeight>=e.current.scrollHeight&&(t.current=!0)}),[s]),(0,w.useEffect)((()=>{t.current&&(e.current.scrollTop=e.current.scrollHeight,t.current=!1)}),[s]),(0,w.useEffect)((()=>{const e=()=>{c(!1)};i.registerDisconnectHandler(e);const t=()=>{c(!0)};i.registerConnectHandler(t);const a=(e,t)=>{o((n=>n.map((n=>n.type===P.AI&&n.responseId===e?{...n,text:n.text+t}:n))))};i.registerEventHandler("AI:CHUNK",a);const s=e=>{n.current=!1,o((t=>t.map((t=>t.type===P.AI&&t.responseId===e?{...t,finished:!0}:t))))};return i.registerEventHandler("AI:FINISH",s),()=>{i.removeConnectHandler(t),i.removeDisconnectHandler(e),i.removeEventHandler("AI:CHUNK",a),i.removeEventHandler("AI:FINISH",s)}}),[]),(0,w.useEffect)((()=>{if(l)return;const e=e=>e.findIndex((e=>e.key===a.current));if(d)null!=a.current&&e(s)===s.length-1&&o((e=>{const t=e.map((e=>e.key===a.current?{...e,text:"Connection restored."}:e));return t.push({key:M(),text:F,type:P.AI,responseId:-1,finished:!0}),t}));else{let t=0;null!=a.current&&(t=e(s)),s.length-t>2&&o((e=>{n.current=!1;const t=e.map((e=>e.type===P.AI?{...e,responseId:-1,finished:!0}:e)),i=M();return a.current=i,t.push({key:i,text:"Connection lost. Please check your internet or refresh the page.",type:P.ERROR}),t}))}}),[d,s,l]);const v=s.map((e=>e.type===P.AI?w.createElement(L,{text:e.text,finished:e.finished,key:e.key}):e.type===P.SELF?w.createElement(k,{text:e.text,key:e.key}):w.createElement(R,{text:e.text,key:e.key})));let C=null;window.CodePadGlobals.userId||(C=w.createElement(_,null));const T=!window.CodePadGlobals.userId||l||!d;return w.createElement("div",{className:"py-2 chat-window"},w.createElement("h3",{className:"mb-3 px-2"},"Cody AI"),w.createElement("div",{className:"message-container mb-2 px-2",ref:e},v),C,w.createElement(y.uc,{onSubmit:t=>{if(n.current)return;const a=()=>{e.current.scrollTop=e.current.scrollHeight,n.current=!0;const a={key:M(),text:"",type:P.AI,responseId:-1,finished:!1};o((e=>[...e,{key:M(),text:t,type:P.SELF},a])),i.sendMessage("AI:PROMPT",t,(e=>{if(e>=0)a.responseId=e;else{n.current=!1;let t="Something went wrong. Please refresh the page or try again. :(";e===N.MUST_SIGN_AI_AGREEMENT?(t="Please sign the AI agreement before using Cody AI.",E()):e===N.OUT_OF_TOKENS?(t="Sorry, you've hit the daily token limit, and Cody is getting tired. Come back tomorrow!",r(!0)):e===N.INTERNAL_AI_ERROR?(t="Sorry, it seems that Cody is hibernating now. Come back later!",r(!0)):e===N.PROMPT_IN_PROGRESS?t="Cody is busy answering your first question!":e===N.TENANT_DISABLED&&(t="Cody is disabled for this organization."),o((e=>{const n=e.filter((e=>e.key!==a.key));return n.push({key:M(),text:t,type:P.ERROR}),n}))}}))};window.CodePadGlobals.aiAgreed?a():E((e=>{e&&a()}))},extraBtn:w.createElement("button",{type:"button",className:m,onClick:()=>{u?(g("fa-solid fa-microphone"),j&&"inactive"!==j.state&&j.stop()):async function(){G=[];const e=await navigator.mediaDevices.getUserMedia({audio:!0});j=new MediaRecorder(e),j.ondataavailable=e=>{G.push(e.data)},j.onstop=()=>{e.getTracks().forEach((e=>e.stop()));const t=new Blob(G,{type:"audio/wav"});h(!1),g("spinner-border spinner-border-sm"),i.sendMessage("AI:RECORD",t,(e=>{var t;t=e,g("fa-solid fa-microphone"),p("btn btn-secondary"),void 0!==t&&b.current&&b.current.setValue(t)}))},j.start()}().then((()=>{h(!0),p("btn btn-danger"),g("fa-solid fa-stop")}))},disabled:T},w.createElement("i",{className:f})),disabled:T,ref:b}))}));n(22489),n(7588);class U{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.handlers=[],this.currentData=e}addHandler(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.handlers.push(e),t&&e(this.currentData)}removeHandler(e){this.handlers=this.handlers.filter((t=>t!==e))}getData(){return this.currentData}setData(e){e!==this.currentData&&(this.currentData=e,setTimeout((()=>{this.handlers.forEach((t=>t(e)))}),0))}}let B=new U([]),W=0;function z(e){let t="unset";e>9?t="'!'":e>0&&(t=`'${e}'`),$(".live-chat-tab").css("--unread-count",t)}const V=e=>{const t=new Date;B.setData([...B.getData(),{...e,timestamp:t.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}]),e.userId!==parseInt(window.CodePadGlobals.userId)&&(W++,z(W))},J=e=>{e&&(B.setData([...B.getData(),{isJoinLeaveMsg:!0,text:`${e} joined the pad!`}]),W++,z(W))},K=e=>{e&&(B.setData([...B.getData(),{isJoinLeaveMsg:!0,text:`${e} left the pad!`}]),W++,z(W))},Y=(0,w.memo)((function(){return w.createElement("div",{className:"alert alert-warning chat-error-msg mb-2 mx-2 small text-align"},w.createElement("div",null,w.createElement("button",{type:"button",className:"btn btn-link align-baseline p-0",onClick:()=>(0,r.f)()},"Sign up"),"Â to join the conversation!"))})),q=(0,w.memo)((function({text:e}){return w.createElement("div",{className:"alert alert-warning chat-error-msg mb-2 mx-2 small"},w.createElement("i",{className:"fa-solid fa-triangle-exclamation me-2"}),e)})),X=(0,w.memo)((function({text:e,index:t}){return w.createElement("div",{key:t,className:"live-chat-join-leave-message mb-3 text-muted"},e)})),Z=(0,w.memo)((function({text:e,timestamp:t}){return w.createElement("div",{className:"chat-message-self-wrapper mb-2 d-flex flex-column"},w.createElement("div",{className:"d-flex justify-content-end"},w.createElement("div",{className:"d-flex"},w.createElement("span",{className:"chat-message me-1"},e)),w.createElement("a",{className:"mt-auto",href:`/user/${window.CodePadGlobals.username}`,target:"_blank",rel:"noreferrer"},w.createElement("img",{className:"live-chat-user-pic",src:`/profilepic/${window.CodePadGlobals.username}`}))),w.createElement("div",{className:"d-flex justify-content-end"},w.createElement("span",{className:"mb-1 mt-1",style:{fontSize:"0.8em"}},window.CodePadGlobals.username,"Â â€¢Â ",t)))})),Q=(0,w.memo)((function({text:e,username:t,timestamp:n}){return w.createElement("div",{className:"chat-message-external-wrapper mb-2 d-flex flex-column"},w.createElement("div",{className:"d-flex"},w.createElement("a",{className:"mt-auto",href:`/user/${t}`,target:"_blank",rel:"noreferrer"},w.createElement("img",{className:"live-chat-user-pic",src:`/profilepic/${t}`})),w.createElement("div",{className:"d-flex"},w.createElement("span",{className:"chat-message ms-1"},e))),w.createElement("div",{className:"d-flex"},w.createElement("span",{className:"mb-1 mt-1",style:{fontSize:"0.8em"}},t,"Â â€¢Â ",n)))})),ee=(0,w.memo)((function(){return w.createElement("div",{className:"alert alert-info mb-2 mx-2",role:"alert"},"Hmm looks like it's just you in here... Here are some crickets to keep you company: ðŸ¦—ðŸ¦—ðŸ¦—")})),te=(0,w.memo)((function({node:e}){const[t,n]=(0,w.useState)(!1),[a,s]=(0,w.useState)(B.getData()),[o,l]=(0,w.useState)(0),[r,d]=(0,w.useState)(window.CodePadGlobals.projectData.ownerName===window.CodePadGlobals.username&&0==window.CodePadGlobals.projectData.editUsers.size&&0==window.CodePadGlobals.projectData.viewUsers.size),c=(0,w.useRef)(null);(0,w.useEffect)((()=>{i.removeEventHandler("CHAT:MESSAGE",V),i.removeEventHandler("CHAT:JOINED_PAD",J),i.removeEventHandler("CHAT:LEFT_PAD",K);const t=t=>{const n=new Date;s((e=>[...e,{...t,timestamp:n.toLocaleTimeString([],{hour:"numeric",minute:"numeric"})}])),e.visible||t.userId===parseInt(window.CodePadGlobals.userId)||l((e=>e+1))},a=t=>{t&&s((e=>[...e,{isJoinLeaveMsg:!0,text:`${t} joined the pad!`}])),e.visible||l((e=>e+1))},o=t=>{t&&s((e=>[...e,{isJoinLeaveMsg:!0,text:`${t} left the pad!`}])),e.visible||l((e=>e+1))},r=()=>{n(!0)},c=()=>{n(!1)};i.registerEventHandler("CHAT:MESSAGE",t),i.registerEventHandler("CHAT:JOINED_PAD",a),i.registerEventHandler("CHAT:LEFT_PAD",o),i.registerConnectHandler(r),i.registerDisconnectHandler(c),e.setEventListener("visibility",(e=>{e.visible&&setTimeout((()=>{l(0)}),0)}));let u=null;return window.CodePadGlobals.userId&&(u=e=>{"editUsers"!==e&&"viewUsers"!==e||d(window.CodePadGlobals.projectData.ownerName===window.CodePadGlobals.username&&0==window.CodePadGlobals.projectData.editUsers.size&&0==window.CodePadGlobals.projectData.viewUsers.size)},window.CodePadGlobals.projectData.registerChangeHandler(u)),()=>{i.removeEventHandler("CHAT:MESSAGE",t),i.removeEventHandler("CHAT:JOINED_PAD",a),i.removeEventHandler("CHAT:LEFT_PAD",o),i.removeConnectHandler(r),i.removeDisconnectHandler(c),e.removeEventListener("visibility"),u&&window.CodePadGlobals.projectData.removeChangeHandler(u)}}),[]),(0,w.useEffect)((()=>{z(o)}),[o]),(0,w.useEffect)((()=>{c.current&&c.current.scrollTo({top:c.current.scrollHeight,behavior:"smooth"})}),[a]);const u=a.map(((e,t)=>e.isJoinLeaveMsg?w.createElement(X,{key:t,text:e.text}):e.userId===parseInt(window.CodePadGlobals.userId)?w.createElement(Z,{key:t,text:e.text,timestamp:e.timestamp}):w.createElement(Q,{key:t,text:e.text,username:e.username,timestamp:e.timestamp})));let h=null,m=null;return null===h&&(window.CodePadGlobals.userId?window.CodePadGlobals.canChat?t?window.CodePadGlobals.projectData.ownerName||(h=w.createElement(q,{text:"Sorry! Anonymous pads can't use the Live Chat! Create your own pad instead!"})):h=w.createElement(q,{text:"Connection lost! Please check your connection or try again later."}):h=w.createElement(q,{text:"Sorry! You don't have permission to chat in this pad."}):h=w.createElement(Y,null)),!h&&r&&(m=w.createElement(ee,null)),w.createElement("div",{className:"py-2 theme-text-color chat-window"},w.createElement("h3",{className:"px-2"},"Live Chat"),w.createElement("div",{className:"alert alert-secondary px-2 py-2 mx-auto small",role:"alert"},w.createElement("i",{className:"fa-solid fa-circle-info me-2"}),"Chat history is not saved."),w.createElement("div",{id:"live-chat-message-container",className:"message-container mb-2 px-2",ref:c},u),m,h,w.createElement(y.uc,{onSubmit:e=>{i.sendMessage("CHAT:MESSAGE",e)},disabled:null!=h||r}))}));var ne=n(16397),ie=n(17134);function ae(e,t,n){let a="about:blank";if(i.containerName){const n=t.indexOf("//")+2;let s=i.containerName;const o=e.config;o.customWebServer&&o.customWebServerPort&&80!=o.customWebServerPort&&(s+="-"+o.customWebServerPort),a=t.substring(0,n)+s+"."+t.substring(n)+"/__frame"}return"dark"===n&&(a+="?theme=dark"),a}function se(e,t,n){t.current?t.current.port1.postMessage(e):n.current={...n.current,...e}}const oe=(0,w.memo)((function({webDomain:e,runConfig:t,fileToRun:n,onIframeFocused:a,onTitleChange:s,ref:o}){const l=(0,w.useContext)(y.Dx),[r,d]=(0,w.useState)((()=>ae(t,e,l))),c=(0,w.useRef)(null),u=(0,w.useRef)(null),h=(0,w.useRef)(null),m=(0,w.useCallback)((e=>{se({newUrl:"/"+e},c,u),h.current.focus()}),[e]);(0,w.useImperativeHandle)(o,(()=>({runFile:m})),[m]),(0,w.useEffect)((()=>{se({theme:l},c,u)}),[l]),(0,w.useEffect)((()=>{const e=()=>{setTimeout((()=>{document.activeElement===h.current&&a()}),0)};return document.addEventListener("focusout",e),()=>{document.removeEventListener("focusout",e)}}),[a]),(0,w.useEffect)((()=>{const n=()=>{let n=ae(t,e,l);r.replace(/\?.*$/,"")!=n.replace(/\?.*$/,"")&&d(n)},a=()=>{n()},s=(e,t)=>{e.customWebServer===t.customWebServer&&e.customWebServerPort===t.customWebServerPort||n()};return i.registerConnectHandler(a),t.registerChangeHandler(s),()=>{i.removeConnectHandler(a),t.removeChangeHandler(s)}}),[r,l,e,t]),(0,w.useEffect)((()=>{c.current=null}),[r]);const p=(0,w.useCallback)((()=>{n.file?n.manualMainFile?se({runBtnTooltip:"Load main file"},c,u):se({runBtnTooltip:"Load "+n.file.slice(n.file.lastIndexOf("/")+1)},c,u):se({runBtnTooltip:"Load index page"},c,u)}),[n]);(0,w.useEffect)((()=>{p()}),[p]);const f=(0,w.useCallback)((e=>{null!=e.data.title&&(""===e.data.title?s("Web Page"):s(e.data.title)),e.data.runBtnClicked&&m(n.file)}),[s,m,n]),g=(0,y.Vo)(f);return w.createElement("iframe",{className:"w-100 h-100 d-block border-0",src:r,onLoad:e=>{const t=e.target;c.current=new MessageChannel,c.current.port1.onmessage=e=>{g.current(e)},u.current&&(c.current.port1.postMessage(u.current),u.current=null),t.contentWindow.postMessage("CODEPAD:PORT","*",[c.current.port2]),p()},ref:h,style:{backgroundColor:"var(--bs-body-bg)"}})}));var le=n(78108);const re=Object.freeze({PENDING:-2,CANCELED:-1,SUCCESS:0,FAILURE:1,TIMED_OUT:2});let de=new U([]),ce=!1;function ue(){ce||(ce=!0,de.addHandler((e=>{e.length>0?$("#run-tests-btn").fadeIn():$("#run-tests-btn").fadeOut()})),fetch("/api/projects/get_tests/"+window.CodePadGlobals.projectData.id).then((async e=>{if(e.ok){const t=await e.json();de.setData(t)}else{const t=await e.text();alert(`Failed to get tests: ${e.status}\n${t}`)}})))}async function he(e){const t=await fetch("/api/projects/delete_test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:window.CodePadGlobals.projectData.id,testId:e})});if(!t.ok){const e=await t.text();throw alert(`Failed to delete test: ${t.status}\n${e}`),new Error("Failed to delete test")}}async function me(e,t,n){const i=await fetch("/api/projects/edit_test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:window.CodePadGlobals.projectData.id,testId:e,name:t,command:n})});if(!i.ok){const e=await i.text();throw alert(`Failed to edit test: ${i.status}\n${e}`),new Error("Failed to edit test")}}const pe=(0,w.memo)((function({title:e,confirmText:t,initialData:n={},onConfirm:i,onCancel:a}){const[s,o]=(0,w.useState)(n.name??""),[l,r]=(0,w.useState)(n.command??""),d=s.length>0&&l.length>0;return w.createElement(w.Fragment,null,w.createElement("h5",{className:"mb-3 pb-1 border-bottom border-2"},w.createElement("strong",null,e)),w.createElement("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation();const t=new FormData(e.currentTarget);i(t.get("name"),t.get("cmd"))}},w.createElement("label",{className:"form-label w-100 mb-3"},"Name:",w.createElement("input",{className:"form-control",name:"name",value:s,onChange:e=>{o(e.target.value)},required:!0})),w.createElement("label",{className:"form-label w-100"},"Command:",w.createElement("textarea",{className:"form-control mb-2",rows:"2",name:"cmd",value:l,onChange:e=>{r(e.target.value)},required:!0}),w.createElement("small",null,w.createElement("i",{className:"fa-solid fa-circle-info me-2"}),w.createElement("i",null,"Exit code of 0 indicates test success. Command output is displayed afterward."))),w.createElement("div",{className:"d-flex justify-content-end"},w.createElement("button",{className:"btn btn-success btn-sm me-1",type:"submit",disabled:!d},t),w.createElement("button",{className:"btn btn-secondary btn-sm",type:"button",onClick:()=>{a()}},"Cancel"))))})),fe=(0,w.memo)((function({testResult:e}){const t=(0,w.useId)(),n=(0,w.useId)(),i=(0,w.useId)(),a=(0,w.useId)(),s=(0,w.useId)(),o=(0,w.useId)(),l=(0,w.useId)(),[r,d]=(0,w.useState)("fa-caret-right"),c=(0,w.useRef)(null);(0,w.useEffect)((()=>{let e=null,t=null,n=null;return c.current&&(n=c.current,e=()=>{d("fa-caret-right")},c.current.addEventListener("hide.bs.collapse",e),t=()=>{d("fa-caret-down")},c.current.addEventListener("show.bs.collapse",t)),()=>{n&&(n.removeEventListener("hide.bs.collapse",e),n.removeEventListener("show.bs.collapse",t))}}),[e]);let u=null;if(e.message&&(u=w.createElement("p",{style:{whiteSpace:"pre-wrap"}},e.message),e.italicized&&(u=w.createElement("i",null,u))),e.errorMsg){u||(u=w.createElement("p",null,"Something went wrong while processing the test's output..."));let t=null;return e.errorFormatted&&(t=w.createElement("pre",null,w.createElement("code",null,e.errorFormatted))),w.createElement(w.Fragment,null,u,w.createElement("button",{className:"btn btn-link p-0 mb-1","data-bs-toggle":"collapse","data-bs-target":"#"+l,"aria-expanded":"false","aria-controls":l},w.createElement("i",{className:"me-2 fa-solid "+r,style:{width:"12px"}}),"Details"),w.createElement("div",{className:"collapse",id:l,ref:c},e.errorMsg,t))}let h=[],m=[];const p=(e,t,n,i)=>{const a=0===h.length;h.push(w.createElement("button",{key:n,id:e,className:"nav-link px-2 py-1 "+(a?"active":""),"data-bs-toggle":"tab","data-bs-target":"#"+t,type:"button",role:"tab","aria-controls":t,"aria-selected":"true"},n)),m.push(w.createElement("div",{key:n,id:t,className:"tab-pane show "+(a?"show active":""),role:"tabpanel","aria-labelledby":e,tabIndex:"0"},w.createElement("pre",{className:"border-top-0"},w.createElement("code",null,i))))};if(e.input&&p(t,n,"Input",e.input),e.expectedOutput){let t="Output";e.status!==re.SUCCESS&&(t="Expected Output"),p(i,a,t,e.expectedOutput)}e.status!==re.SUCCESS&&e.actualOutput&&p(s,o,"Actual Output",e.actualOutput);let f=null;return h.length>0&&(f=w.createElement(w.Fragment,null,w.createElement("nav",null,w.createElement("div",{className:"nav nav-underline",role:"tablist"},h)),w.createElement("div",{className:"tab-content"},m))),w.createElement(w.Fragment,null,u,f)})),ge=(0,w.memo)((function({testData:e,accordionId:t,onRunTest:n,onStopTest:i,canEdit:a,onEditTest:s,onDeleteTest:o}){const[l,r]=(0,w.useState)(!1),d=(0,w.useId)();let c=null,u=null,h="status-unknown",m=null;e.result?(e.result.status===re.PENDING?c=w.createElement("span",{className:"status-text loading-dots ms-auto"},"Running..."):e.result.status===re.CANCELED?(c=w.createElement("span",{className:"status-text ms-auto"},"[Canceled]"),h="status-unfinished"):e.result.status===re.SUCCESS?(c=w.createElement("span",{className:"status-text ms-auto"},"[Success]"),h="status-success"):e.result.status===re.FAILURE?(c=w.createElement("span",{className:"status-text ms-auto"},"[Failure]"),h="status-failure"):e.result.status===re.TIMED_OUT&&(c=w.createElement("span",{className:"status-text ms-auto"},"[Timed Out]"),h="status-unfinished"),e.result.status!==re.PENDING&&e.result.status!==re.CANCELED&&(u=w.createElement(w.Fragment,null,w.createElement(fe,{testResult:e.result}),w.createElement("hr",null))),m=e.result.status===re.PENDING?w.createElement("button",{className:"btn btn-sm btn-danger",onClick:i},w.createElement("i",{className:"fa-solid fa-stop me-1"}),"Cancel"):w.createElement("button",{className:"btn btn-sm btn-info",onClick:n},w.createElement("i",{className:"fa-solid fa-rotate me-1"}),"Restart")):m=w.createElement("button",{className:"btn btn-sm btn-info",onClick:n},w.createElement("i",{className:"fa-solid fa-play me-1"}),"Start");let p=null;if(l)p=w.createElement(pe,{title:"Editing Test",confirmText:"Save",initialData:{name:e.name,command:e.command},onConfirm:(e,t)=>{s(e,t),r(!1)},onCancel:()=>{r(!1)}});else{let t=null,n=null;a&&(t=w.createElement("div",{className:"mb-2"},w.createElement("h5",null,"Command:"),w.createElement("pre",null,w.createElement("code",null,e.command))),n=w.createElement("div",{className:"float-end"},w.createElement("button",{className:"btn btn-sm btn-primary",onClick:()=>{r(!0)}},w.createElement("i",{className:"fa-solid fa-pen-to-square me-1"}),"Edit"),w.createElement("button",{className:"btn btn-sm btn-danger ms-1",onClick:()=>{const e=bootstrap.Collapse.getInstance("#"+d);e?(e.hide(),setTimeout((()=>{o()}),225)):o()}},"Delete"))),p=w.createElement(w.Fragment,null,u,t,m,n)}return w.createElement("div",{className:"accordion-item"},w.createElement("h4",{className:"accordion-header "+h},w.createElement("button",{className:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#"+d,"aria-expanded":"false","aria-controls":d},e.name,c)),w.createElement("div",{id:d,className:"accordion-collapse collapse","data-bs-parent":"#"+t},w.createElement("div",{className:"accordion-body"},p)))})),be=Object.freeze({SET_STATUS:0,SET_RESULT:1,ADD_TESTS:2,REMOVE_TEST:3,EDIT_TEST:4});function ve(e,t){if(t.type===be.SET_STATUS){const n={...e};let i=!t.shouldSet&&!t.id;for(const[e,a]of Object.entries(n))(i||t.shouldSet&&t.shouldSet(a)||t.id&&t.id===e)&&(n[e]={...a,result:{...a.result,status:t.status}});return n}if(t.type===be.SET_RESULT){if(t.id in e){const n={...e};return n[t.id]={...n[t.id],result:t.result},n}return e}if(t.type===be.ADD_TESTS){const n={...e};for(const e of t.data){const{id:t,...i}=e;n[t]={...i,result:null}}return n}if(t.type===be.REMOVE_TEST){const n={...e};return t.id in n&&delete n[t.id],n}if(t.type===be.EDIT_TEST){const n={...e};return t.id in n&&(n[t.id]={...t.data,result:null}),n}throw new Error("Invalid test reducer action type: "+t.type)}const Ee=(0,w.memo)((function({initialTestData:e,canEdit:t,onRunStateChange:n,ref:a}){const s=(0,w.useId)(),[o,l]=(0,w.useState)(!1),[r,d]=(0,w.useReducer)(ve,{},(()=>ve({},{type:be.ADD_TESTS,data:e})));(0,w.useImperativeHandle)(a,(()=>({runAllTests:()=>{i.sendMessage("TEST:RUN",Object.keys(r)),d({type:be.SET_STATUS,status:re.PENDING})},stop:()=>{d({type:be.SET_STATUS,shouldSet:e=>e.result&&e.result.status===re.PENDING,status:re.CANCELED}),i.sendMessage("TEST:CANCEL")}})),[r]),(0,w.useEffect)((()=>{const e=(e,t,n)=>{d({type:be.SET_RESULT,id:e,result:{...n,status:t}})};return i.registerEventHandler("TEST:FINISH",e),()=>{i.removeEventHandler("TEST:FINISH",e)}}),[]),(0,w.useEffect)((()=>{let e=!1;for(const t of Object.values(r))if(t.result&&t.result.status===re.PENDING){e=!0;break}n(e);const t=[];for(const[e,n]of Object.entries(r))t.push({id:e,name:n.name,command:n.command});de.setData(t)}),[r,n]);const c=(0,y.Vo)(n);(0,w.useEffect)((()=>{const e=c.current;return()=>{e(!1),i.sendMessage("TEST:CANCEL")}}),[c]);let u=null;if(Object.keys(r).length>0){const e=new Intl.Collator([],{numeric:!0}),n=Object.entries(r);n.sort(((t,n)=>e.compare(t[1].name,n[1].name)));const a=[];for(const[e,o]of n)a.push(w.createElement(ge,{key:e,testData:o,accordionId:s,onRunTest:()=>{i.sendMessage("TEST:RUN",[e]),d({type:be.SET_STATUS,id:e,status:re.PENDING})},onStopTest:()=>{d({type:be.SET_STATUS,id:e,status:re.CANCELED}),i.sendMessage("TEST:CANCEL",[e])},canEdit:t,onEditTest:(t,n)=>{me(e,t,n).then((()=>{d({type:be.EDIT_TEST,id:e,data:{name:t,command:n}})}))},onDeleteTest:()=>{he(e).then((()=>{d({type:be.REMOVE_TEST,id:e})}))}}));u=w.createElement("div",{id:s,className:"test-case-display accordion accordion-flush"},a)}else u=w.createElement("i",{className:"d-block text-center"},"No tests configured...");let h=null;if(t)if(o){let e=null;u&&(e=w.createElement("hr",null)),h=w.createElement(w.Fragment,null,e,w.createElement("div",{className:"bg-body-tertiary shadow-sm m-3 p-3 rounded"},w.createElement(pe,{title:"New Test",confirmText:"Add",onConfirm:(e,t)=>{l(!1),async function(e,t){const n=await fetch("/api/projects/add_test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:window.CodePadGlobals.projectData.id,name:e,command:t})});if(n.ok)return{id:(await n.json()).id,name:e,command:t};{const e=await n.text();throw alert(`Failed to add test: ${n.status}\n${e}`),new Error("Failed to add test")}}(e,t).then((e=>{d({type:be.ADD_TESTS,data:[e]})}))},onCancel:()=>{l(!1)}})))}else h=w.createElement("div",{className:"add-test-btn m-3"},w.createElement("button",{className:"btn btn-transparent mx-1 fs-6",onClick:()=>{l(!0)}},w.createElement("i",{className:"fa-solid fa-plus me-2"}),"Add Test"));return w.createElement(w.Fragment,null,w.createElement("h3",{className:"mt-3 text-center"},"Test Cases"),w.createElement("hr",null),u,h)})),ye=(0,w.memo)((function({canEdit:e,onRunStateChange:t,ref:n}){const[i,a]=(0,w.useState)(de.getData()),s=(0,w.useRef)(null);return(0,w.useImperativeHandle)(n,(()=>({runAllTests:()=>{s.current&&s.current.runAllTests()},stop:()=>{s.current&&s.current.stop()}})),[]),(0,w.useEffect)((()=>{ue();const e=e=>{a(e)};return de.addHandler(e,!0),()=>{de.removeHandler(e)}}),[]),i?w.createElement(Ee,{initialTestData:i,canEdit:e,onRunStateChange:t,ref:s}):w.createElement("div",{className:"w-100 h-100 d-flex justify-content-center align-items-center"},w.createElement("div",{className:"spinner-border text-primary",style:{width:"4rem",height:"4rem"},role:"status"},w.createElement("span",{className:"visually-hidden"},"Loading...")))}));var we=n(47721);n(17642),n(58004),n(33853),n(45876),n(32475),n(15024),n(31698);class Ce{constructor(){this.tabs=[]}givePrecedence(e){const t=this.getTabIndex(e);t>=0&&t!=this.tabs.length-1&&(this.tabs.push(this.tabs.splice(t,1)[0]),this.onTabListChanged())}removePrecedence(e){const t=this.getTabIndex(e);if(t>=0){let e=t;for(;e-1>=0&&this.tabs[e-1].isVisible;)e--;if(e!=t){const n=this.tabs.splice(t,1)[0];this.tabs.splice(e,0,n),this.onTabListChanged()}}}getTabIndex(e){for(let t=0;t<this.tabs.length;t++)if(this.tabs[t].id===e)return t;return-1}getMostActiveTab(e){for(let t=this.tabs.length-1;t>=0;t--)if(!e||e(this.tabs[t]))return this.tabs[t];return null}activateTab(e){return this.givePrecedence(e),!0}closingTab(){return!0}maximizeToggle(e,t,n){e&&this.activateTab(e);for(const e of t){const t=this.getTabIndex(e);if(t>=0)for(const e of this.tabs[t]._visibilityHandlers)e({visible:!n})}}getStickyButtons(){return[]}getComponent(e){const t=e.getId(),n=(0,w.useRef)(!1);if(!n.current){n.current=!0;const i={id:t,isVisible:e.isVisible,resizeEvent:{addHandler:t=>{e.setEventListener("resize",t,!1)},removeHandler:t=>{e.removeEventListener("resize",t)}},_visibilityHandlers:new Set,visibilityEvent:{addHandler:t=>{i._visibilityHandlers.add(t),e.setEventListener("visibility",t,!1)},removeHandler:t=>{i._visibilityHandlers.delete(t),e.removeEventListener("visibility",t)}}};this.tabs.push(i),e.setEventListener("visibility",(e=>{i.isVisible=e.visible,e.visible?this.givePrecedence(t):this.removePrecedence(t)}),!1)}return(0,w.useEffect)((()=>(this.onTabListChanged(),()=>{e.removeEventListener("visibility");let t=this.getTabIndex(e.getId());t>=0&&(this.tabs.splice(t,1),this.onTabListChanged())})),[e]),"Default component content"}getComponentTitle(){return"Default title"}onTabListChanged(){}}var Te=n(79445),Ie=n(55544);const Se=Object.freeze([Te.t.CONSOLE,Te.t.TESTS]);function De({onClick:e}){const t=(0,w.useRef)(null);return w.createElement(y.O2,{tag:"button",className:"flexlayout__tab_toolbar_button",style:{width:"1.5rem"},title:"Create new output tab","aria-label":"Create new output tab","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-fallback-placements":'["bottom"]',onClick:n=>{t.current&&t.current.hide(),e(n)},ref:t},w.createElement("i",{className:"fa-solid fa-plus"}))}class Pe extends Ce{constructor(e,t,n,a){super(),this.layoutModel=e,this.outputTypes=t,this.webDomain=n,this.runConfig=a,this.consoleRunEvent=new U(null),this.testRunEvent=new U(!1);const s={};for(const e of Object.values(Te.t))s[e]=!this.outputTypes.includes(e);s[Te.t.CONSOLE]||=this.runConfig.config.runInShell,this.hideTabTypeEvent=new U(s),this.iframeFileToRunEvent=new U({file:"",manualMainFile:!1}),this.outputTabs={},this.outputTabTitles={},this.disabledCloseId=null,this.runConfig.registerChangeHandler(((e,t)=>{if(this.outputTypes.includes(Te.t.CONSOLE)&&e.runInShell!==t.runInShell){if(e.runInShell){const e=this.getMostActiveTab((e=>this.outputTabs[e.id].type===Te.t.CONSOLE));e&&(this.getMostActiveTab((e=>this.outputTabs[e.id].type===Te.t.SHELL))?this.layoutModel.doActionWithIntercept(Ie.En.deleteTab(e.id)):this.outputTabs[e.id].setType(Te.t.SHELL))}this.hideTabTypeEvent.setData({...this.hideTabTypeEvent.getData(),[Te.t.CONSOLE]:e.runInShell})}})),i.registerEventHandler("GUI:DETECTED",this.createGUITab.bind(this)),i.registerEventHandler("GUI:GONE",(()=>{for(const e of Object.values(this.outputTabs))e.type===Te.t.GUI&&e.guiWasDetected&&(e.guiWasDetected=!1,e.imperativeHandles.current.stopGUI())}))}getStickyButtons(e){return[w.createElement(De,{key:"add output tab",onClick:()=>{this.addOutputTab(e.getId())}})]}getComponent(e){super.getComponent(e);const t=e.getId(),[n,i]=(0,w.useState)((()=>{const t=e.getConfig();return t&&t.initialType?t.initialType:Te.t.CHOOSING})),[a,s]=(0,w.useState)((()=>this.hideTabTypeEvent.getData())),[o,l]=(0,w.useState)((()=>this.iframeFileToRunEvent.getData())),r=(0,w.useRef)(null),d=(0,w.useRef)(!1);if(!d.current){d.current=!0;let a=!1,s=null,o=e.getConfig();o&&(o.guiDetected&&(a=!0),o.initialRunData&&(s=o.initialRunData));const l={type:n,setType:e=>{l.type=e,i(e)},isRunning:!1,runData:s,guiWasDetected:a,title:null,imperativeHandles:r};this.outputTabs[t]=l}(0,w.useEffect)((()=>{this.layoutModel.doActionWithIntercept(Ie.En.updateNodeAttributes(t,{config:{}}));const e=e=>{s(e)};this.hideTabTypeEvent.addHandler(e,!0);const n=e=>{l(e)};return this.iframeFileToRunEvent.addHandler(n,!0),()=>{this.hideTabTypeEvent.removeHandler(e),this.iframeFileToRunEvent.removeHandler(n),delete this.outputTabs[t]}}),[t]),(0,w.useEffect)((()=>{const e=this.outputTabs[t];switch(e.title=null,e.isRunning=!1,n!==Te.t.GUI&&(e.guiWasDetected=!1),e.runData&&(this.runOutputTab(e,e.runData),e.runData=null),t in this.outputTabTitles&&this.outputTabTitles[t].setContent(this.getTitleContent(e)),n){case Te.t.CHOOSING:this.layoutModel.doActionWithIntercept(Ie.En.updateNodeAttributes(t,{icon:"/static/images/icons/choose_output.png"}));break;case Te.t.CONSOLE:this.layoutModel.doActionWithIntercept(Ie.En.updateNodeAttributes(t,{icon:"fa-solid fa-align-left console-border-icon"}));break;case Te.t.SHELL:this.layoutModel.doActionWithIntercept(Ie.En.updateNodeAttributes(t,{icon:"/static/images/icons/output_shell.png"}));break;case Te.t.WEB_PAGE:this.layoutModel.doActionWithIntercept(Ie.En.updateNodeAttributes(t,{icon:"/static/images/icons/webpage.png"}));break;case Te.t.GUI:this.layoutModel.doActionWithIntercept(Ie.En.updateNodeAttributes(t,{icon:"fa-solid fa-display"}));break;case Te.t.TESTS:this.layoutModel.doActionWithIntercept(Ie.En.updateNodeAttributes(t,{icon:"fa-solid fa-clipboard-check"}))}this.onTabListChanged()}),[n,t]);const c=(0,w.useCallback)((e=>{this.outputTabs[t].setType(e)}),[t]),u=(0,w.useCallback)((()=>{const e=this.layoutModel.getNodeById(t).getParent();this.layoutModel.doActionWithIntercept(Ie.En.setActiveTabset(e.getId()))}),[t]),h=(0,w.useCallback)((e=>{t in this.outputTabs&&(this.outputTabs[t].title=e),t in this.outputTabTitles&&this.outputTabTitles[t].setContent(this.getTitleContent(this.outputTabs[t]))}),[t]),m=(0,w.useCallback)((e=>{n===Te.t.CONSOLE?this.consoleRunEvent.setData(e):n===Te.t.GUI?t in this.outputTabs&&(this.outputTabs[t].isRunning=e):n===Te.t.TESTS&&this.testRunEvent.setData(e)}),[n,t]);switch(n){case Te.t.CHOOSING:return w.createElement(Te.z,{onChoseType:c,hideTabData:a});case Te.t.CONSOLE:return w.createElement(ne.p,{ref:r,visibilityEvent:this.tabs[this.getTabIndex(t)].visibilityEvent,onTitleChange:h,onRunStateChange:m});case Te.t.SHELL:return w.createElement(ie.q,{ref:r,resizeEvent:this.tabs[this.getTabIndex(t)].resizeEvent,visibilityEvent:this.tabs[this.getTabIndex(t)].visibilityEvent,onTitleChange:h,runConfig:this.runConfig});case Te.t.WEB_PAGE:return w.createElement(oe,{ref:r,webDomain:this.webDomain,runConfig:this.runConfig,fileToRun:o,onIframeFocused:u,onTitleChange:h});case Te.t.GUI:return w.createElement(le.Z,{ref:r,onTitleChange:h,onRunStateChange:m});case Te.t.TESTS:return w.createElement(ye,{ref:r,canEdit:"edit"===window.CodePadGlobals.mode&&"lesson"!==window.CodePadGlobals.embeddedType,onRunStateChange:m})}}getTitleContent(e){if(!e)return"Output";if(null!=e.title)return e.title;switch(e.type){case Te.t.CHOOSING:return"Choose Output";case Te.t.CONSOLE:return"Console";case Te.t.SHELL:return"Shell";case Te.t.WEB_PAGE:return"Web Page";case Te.t.GUI:return"GUI";case Te.t.TESTS:return"Test Cases"}}getComponentTitle(e){super.getComponentTitle(e);const t=e.getId(),[n,i]=(0,w.useState)((()=>t in this.outputTabs?this.getTitleContent(this.outputTabs[t]):this.getTitleContent())),a=(0,w.useRef)(!1);if(!a.current)if(a.current=!0,t in this.outputTabTitles)this.outputTabTitles[t]._contentSetters.add(i);else{const e={_contentSetters:new Set([i]),setContent:n=>{this.layoutModel.getNodeById(t)&&this.layoutModel.doActionWithIntercept(Ie.En.updateNodeAttributes(t,{name:n}));for(const t of e._contentSetters)t(n)}};this.outputTabTitles[t]=e}return(0,w.useEffect)((()=>()=>{this.outputTabTitles[t]._contentSetters.delete(i),0===this.outputTabTitles[t]._contentSetters.size&&delete this.outputTabTitles[t]}),[t]),n}closingTab(){if(super.closingTab(),1===this.tabs.length){const e=this.outputTabs[this.tabs[0].id];return e.type!==Te.t.CHOOSING&&e.setType(Te.t.CHOOSING),!1}return!0}onTabListChanged(){1!==this.tabs.length||this.tabs[0].id in this.outputTabs&&this.outputTabs[this.tabs[0].id].type!==Te.t.CHOOSING?this.disabledCloseId&&(this.layoutModel.doActionWithIntercept(Ie.En.updateNodeAttributes(this.disabledCloseId,{enableClose:!0})),this.disabledCloseId=null):(this.disabledCloseId=this.tabs[0].id,this.layoutModel.doActionWithIntercept(Ie.En.updateNodeAttributes(this.disabledCloseId,{enableClose:!1})));let e=this.hideTabTypeEvent.getData();for(const t of Se)if((!this.runConfig.config.runInShell||t!==Te.t.CONSOLE)&&this.outputTypes.includes(t)){const n=this.getMostActiveTab((e=>this.outputTabs[e.id].type===t));e={...e,[t]:Boolean(n)}}this.hideTabTypeEvent.setData(e)}setRunnableFiles(e){let t="";for(const n of e.files){let e=(0,we.uQ)(n);if("html"===e||"php"===e){t=n;break}}let n=e.manualMainFile;t&&t==e.files[0]||(n=!1);const i={file:t,manualMainFile:n},a=this.iframeFileToRunEvent.getData();a.file===i.file&&a.manualMainFile===i.manualMainFile||this.iframeFileToRunEvent.setData(i)}createGUITab(){if(this.getMostActiveTab((e=>{const t=this.outputTabs[e.id];return t.type===Te.t.GUI&&t.isRunning})))return;let e=null;if(this.layoutModel.getMaximizedTabset()){const t=this.layoutModel.getMaximizedTabset().getChildren().find((e=>{const t=this.outputTabs[e.getId()];return t&&t.type===Te.t.GUI}));t&&(e=t.getId())}else{const t=this.getMostActiveTab((e=>this.outputTabs[e.id].type===Te.t.GUI));t&&(e=t.id)}if(e){const t=this.layoutModel.getNodeById(e);return t.getParent().getType()===Ie.ro.TYPE&&t.isVisible()||this.layoutModel.doActionWithIntercept(Ie.En.selectTab(e)),this.outputTabs[e].guiWasDetected=!0,void this.outputTabs[e].imperativeHandles.current.restartGUI()}let t=null;if(this.layoutModel.getMaximizedTabset()){const e=this.layoutModel.getMaximizedTabset().getChildren().find((e=>{const t=this.outputTabs[e.getId()];return t&&t.type===Te.t.CHOOSING}));e&&(t=e.getId())}else{const e=this.getMostActiveTab((e=>this.outputTabs[e.id].type===Te.t.CHOOSING));e&&(t=e.id)}if(t){const e=this.layoutModel.getNodeById(t);return e.getParent().getType()===Ie.ro.TYPE&&e.isVisible()||this.layoutModel.doActionWithIntercept(Ie.En.selectTab(t)),this.outputTabs[t].guiWasDetected=!0,void this.outputTabs[t].setType(Te.t.GUI)}if(this.layoutModel.getMaximizedTabset())this.addOutputTab(this.layoutModel.getMaximizedTabset().getId(),{initialType:Te.t.GUI,guiDetected:!0});else{const e=this.getMostActiveTab((e=>{const t=this.outputTabs[e.id];return t.type===Te.t.CONSOLE||t.type===Te.t.SHELL}));if(e){const t=this.layoutModel.getNodeById(e.id);this.addOutputTab(t.getParent().getId(),{initialType:Te.t.GUI,guiDetected:!0},Ie.$z.TOP)}else this.addOutputTab(null,{initialType:Te.t.GUI,guiDetected:!0})}}addOutputTab(e,t,n){e||(e=this.layoutModel.getNodeById(this.tabs[this.tabs.length-1].id).getParent().getId());let i=t||{};n||(n=Ie.$z.CENTER),this.layoutModel.doActionWithIntercept(Ie.En.addNode({type:"tab",name:"Output",component:"output",icon:"/static/images/icons/choose_output.png",config:i},e,n,-1))}prepareAndRunOutputType(e,t){const n=e=>{const t=this.layoutModel.getMaximizedTabset(),n=this.layoutModel.getNodeById(e);t&&n.getParent()!==t&&this.layoutModel.doActionWithIntercept(Ie.En.maximizeToggle(t.getId())),n.getParent().getType()===Ie.ro.TYPE&&n.isVisible()||this.layoutModel.doActionWithIntercept(Ie.En.selectTab(e))};let i=this.getMostActiveTab((t=>this.outputTabs[t.id].type===e));if(i)n(i.id),this.runOutputTab(this.outputTabs[i.id],t);else{const i=this.getMostActiveTab((e=>this.outputTabs[e.id].type===Te.t.CHOOSING));if(i)n(i.id),this.outputTabs[i.id].runData=t,this.outputTabs[i.id].setType(e);else{const n=this.layoutModel.getNodeById(this.tabs[this.tabs.length-1].id).getParent(),i=this.layoutModel.getMaximizedTabset();i&&n!==i&&this.layoutModel.doActionWithIntercept(Ie.En.maximizeToggle(i.getId())),this.addOutputTab(n.getId(),{initialType:e,initialRunData:t})}}}runFile(e){const t=(0,we.uQ)(e),n=(0,we.hA)(e),i={java:Te.t.CONSOLE,cpp:Te.t.CONSOLE,class:Te.t.CONSOLE,py:Te.t.CONSOLE,js:Te.t.CONSOLE,jsx:Te.t.CONSOLE,sh:Te.t.CONSOLE,html:Te.t.WEB_PAGE,php:Te.t.WEB_PAGE},a={Makefile:Te.t.CONSOLE};a.makefile=a.Makefile;let s=i[t]??a[n];s&&(s!==Te.t.CONSOLE||!this.runConfig.config.runInShell&&this.outputTypes.includes(Te.t.CONSOLE)||(s=Te.t.SHELL),this.prepareAndRunOutputType(s,e))}runTests(){this.prepareAndRunOutputType(Te.t.TESTS,!0)}stopConsole(){const e=this.getMostActiveTab((e=>this.outputTabs[e.id].type===Te.t.CONSOLE));e&&this.outputTabs[e.id].imperativeHandles.current.stop()}stopTests(){const e=this.getMostActiveTab((e=>this.outputTabs[e.id].type===Te.t.TESTS));e&&this.outputTabs[e.id].imperativeHandles.current.stop()}runOutputTab(e,t){e.type===Te.t.CONSOLE?e.imperativeHandles.current.runFile(this.runConfig,t):e.type===Te.t.SHELL?e.imperativeHandles.current.runFileInShell(t):e.type===Te.t.WEB_PAGE?e.imperativeHandles.current.runFile(t):e.type===Te.t.TESTS&&e.imperativeHandles.current.runAllTests()}addConsoleRunHandler(e){this.consoleRunEvent.addHandler(e)}removeConsoleRunHandler(e){this.consoleRunEvent.removeHandler(e)}addTestRunHandler(e){this.testRunEvent.addHandler(e)}removeTestRunHandler(e){this.testRunEvent.removeHandler(e)}}n(13609),n(61701);var Ne=function(){this.Diff_Timeout=1,this.Diff_EditCost=4},xe=-1;(Ne.Diff=function(e,t){this[0]=e,this[1]=t}).prototype.length=2,Ne.Diff.prototype.toString=function(){return this[0]+","+this[1]},Ne.prototype.diff_main=function(e,t,n,i){void 0===i&&(i=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var a=i;if(null==e||null==t)throw new Error("Null input. (diff_main)");if(e==t)return e?[new Ne.Diff(0,e)]:[];void 0===n&&(n=!0);var s=n,o=this.diff_commonPrefix(e,t),l=e.substring(0,o);e=e.substring(o),t=t.substring(o),o=this.diff_commonSuffix(e,t);var r=e.substring(e.length-o);e=e.substring(0,e.length-o),t=t.substring(0,t.length-o);var d=this.diff_compute_(e,t,s,a);return l&&d.unshift(new Ne.Diff(0,l)),r&&d.push(new Ne.Diff(0,r)),this.diff_cleanupMerge(d),d},Ne.prototype.diff_compute_=function(e,t,n,i){var a;if(!e)return[new Ne.Diff(1,t)];if(!t)return[new Ne.Diff(xe,e)];var s=e.length>t.length?e:t,o=e.length>t.length?t:e,l=s.indexOf(o);if(-1!=l)return a=[new Ne.Diff(1,s.substring(0,l)),new Ne.Diff(0,o),new Ne.Diff(1,s.substring(l+o.length))],e.length>t.length&&(a[0][0]=a[2][0]=xe),a;if(1==o.length)return[new Ne.Diff(xe,e),new Ne.Diff(1,t)];var r=this.diff_halfMatch_(e,t);if(r){var d=r[0],c=r[1],u=r[2],h=r[3],m=r[4],p=this.diff_main(d,u,n,i),f=this.diff_main(c,h,n,i);return p.concat([new Ne.Diff(0,m)],f)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,i):this.diff_bisect_(e,t,i)},Ne.prototype.diff_lineMode_=function(e,t,n){var i=this.diff_linesToChars_(e,t);e=i.chars1,t=i.chars2;var a=i.lineArray,s=this.diff_main(e,t,!1,n);this.diff_charsToLines_(s,a),this.diff_cleanupSemantic(s),s.push(new Ne.Diff(0,""));for(var o=0,l=0,r=0,d="",c="";o<s.length;){switch(s[o][0]){case 1:r++,c+=s[o][1];break;case xe:l++,d+=s[o][1];break;case 0:if(l>=1&&r>=1){s.splice(o-l-r,l+r),o=o-l-r;for(var u=this.diff_main(d,c,!1,n),h=u.length-1;h>=0;h--)s.splice(o,0,u[h]);o+=u.length}r=0,l=0,d="",c=""}o++}return s.pop(),s},Ne.prototype.diff_bisect_=function(e,t,n){for(var i=e.length,a=t.length,s=Math.ceil((i+a)/2),o=s,l=2*s,r=new Array(l),d=new Array(l),c=0;c<l;c++)r[c]=-1,d[c]=-1;r[o+1]=0,d[o+1]=0;for(var u=i-a,h=u%2!=0,m=0,p=0,f=0,g=0,b=0;b<s&&!((new Date).getTime()>n);b++){for(var v=-b+m;v<=b-p;v+=2){for(var E=o+v,y=(S=v==-b||v!=b&&r[E-1]<r[E+1]?r[E+1]:r[E-1]+1)-v;S<i&&y<a&&e.charAt(S)==t.charAt(y);)S++,y++;if(r[E]=S,S>i)p+=2;else if(y>a)m+=2;else if(h&&(T=o+u-v)>=0&&T<l&&-1!=d[T]&&S>=(C=i-d[T]))return this.diff_bisectSplit_(e,t,S,y,n)}for(var w=-b+f;w<=b-g;w+=2){for(var C,T=o+w,I=(C=w==-b||w!=b&&d[T-1]<d[T+1]?d[T+1]:d[T-1]+1)-w;C<i&&I<a&&e.charAt(i-C-1)==t.charAt(a-I-1);)C++,I++;if(d[T]=C,C>i)g+=2;else if(I>a)f+=2;else if(!h){var S;if((E=o+u-w)>=0&&E<l&&-1!=r[E])if(y=o+(S=r[E])-E,S>=(C=i-C))return this.diff_bisectSplit_(e,t,S,y,n)}}}return[new Ne.Diff(xe,e),new Ne.Diff(1,t)]},Ne.prototype.diff_bisectSplit_=function(e,t,n,i,a){var s=e.substring(0,n),o=t.substring(0,i),l=e.substring(n),r=t.substring(i),d=this.diff_main(s,o,!1,a),c=this.diff_main(l,r,!1,a);return d.concat(c)},Ne.prototype.diff_linesToChars_=function(e,t){var n=[],i={};function a(e){for(var t="",a=0,o=-1,l=n.length;o<e.length-1;){-1==(o=e.indexOf("\n",a))&&(o=e.length-1);var r=e.substring(a,o+1);(i.hasOwnProperty?i.hasOwnProperty(r):void 0!==i[r])?t+=String.fromCharCode(i[r]):(l==s&&(r=e.substring(a),o=e.length),t+=String.fromCharCode(l),i[r]=l,n[l++]=r),a=o+1}return t}n[0]="";var s=4e4,o=a(e);return s=65535,{chars1:o,chars2:a(t),lineArray:n}},Ne.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var i=e[n][1],a=[],s=0;s<i.length;s++)a[s]=t[i.charCodeAt(s)];e[n][1]=a.join("")}},Ne.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,i=Math.min(e.length,t.length),a=i,s=0;n<a;)e.substring(s,a)==t.substring(s,a)?s=n=a:i=a,a=Math.floor((i-n)/2+n);return a},Ne.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,i=Math.min(e.length,t.length),a=i,s=0;n<a;)e.substring(e.length-a,e.length-s)==t.substring(t.length-a,t.length-s)?s=n=a:i=a,a=Math.floor((i-n)/2+n);return a},Ne.prototype.diff_commonOverlap_=function(e,t){var n=e.length,i=t.length;if(0==n||0==i)return 0;n>i?e=e.substring(n-i):n<i&&(t=t.substring(0,n));var a=Math.min(n,i);if(e==t)return a;for(var s=0,o=1;;){var l=e.substring(a-o),r=t.indexOf(l);if(-1==r)return s;o+=r,0!=r&&e.substring(a-o)!=t.substring(0,o)||(s=o,o++)}},Ne.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0)return null;var n=e.length>t.length?e:t,i=e.length>t.length?t:e;if(n.length<4||2*i.length<n.length)return null;var a=this;function s(e,t,n){for(var i,s,o,l,r=e.substring(n,n+Math.floor(e.length/4)),d=-1,c="";-1!=(d=t.indexOf(r,d+1));){var u=a.diff_commonPrefix(e.substring(n),t.substring(d)),h=a.diff_commonSuffix(e.substring(0,n),t.substring(0,d));c.length<h+u&&(c=t.substring(d-h,d)+t.substring(d,d+u),i=e.substring(0,n-h),s=e.substring(n+u),o=t.substring(0,d-h),l=t.substring(d+u))}return 2*c.length>=e.length?[i,s,o,l,c]:null}var o,l,r,d,c,u=s(n,i,Math.ceil(n.length/4)),h=s(n,i,Math.ceil(n.length/2));return u||h?(o=h?u&&u[4].length>h[4].length?u:h:u,e.length>t.length?(l=o[0],r=o[1],d=o[2],c=o[3]):(d=o[0],c=o[1],l=o[2],r=o[3]),[l,r,d,c,o[4]]):null},Ne.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],i=0,a=null,s=0,o=0,l=0,r=0,d=0;s<e.length;)0==e[s][0]?(n[i++]=s,o=r,l=d,r=0,d=0,a=e[s][1]):(1==e[s][0]?r+=e[s][1].length:d+=e[s][1].length,a&&a.length<=Math.max(o,l)&&a.length<=Math.max(r,d)&&(e.splice(n[i-1],0,new Ne.Diff(xe,a)),e[n[i-1]+1][0]=1,i--,s=--i>0?n[i-1]:-1,o=0,l=0,r=0,d=0,a=null,t=!0)),s++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),s=1;s<e.length;){if(e[s-1][0]==xe&&1==e[s][0]){var c=e[s-1][1],u=e[s][1],h=this.diff_commonOverlap_(c,u),m=this.diff_commonOverlap_(u,c);h>=m?(h>=c.length/2||h>=u.length/2)&&(e.splice(s,0,new Ne.Diff(0,u.substring(0,h))),e[s-1][1]=c.substring(0,c.length-h),e[s+1][1]=u.substring(h),s++):(m>=c.length/2||m>=u.length/2)&&(e.splice(s,0,new Ne.Diff(0,c.substring(0,m))),e[s-1][0]=1,e[s-1][1]=u.substring(0,u.length-m),e[s+1][0]=xe,e[s+1][1]=c.substring(m),s++),s++}s++}},Ne.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),i=t.charAt(0),a=n.match(Ne.nonAlphaNumericRegex_),s=i.match(Ne.nonAlphaNumericRegex_),o=a&&n.match(Ne.whitespaceRegex_),l=s&&i.match(Ne.whitespaceRegex_),r=o&&n.match(Ne.linebreakRegex_),d=l&&i.match(Ne.linebreakRegex_),c=r&&e.match(Ne.blanklineEndRegex_),u=d&&t.match(Ne.blanklineStartRegex_);return c||u?5:r||d?4:a&&!o&&l?3:o||l?2:a||s?1:0}for(var n=1;n<e.length-1;){if(0==e[n-1][0]&&0==e[n+1][0]){var i=e[n-1][1],a=e[n][1],s=e[n+1][1],o=this.diff_commonSuffix(i,a);if(o){var l=a.substring(a.length-o);i=i.substring(0,i.length-o),a=l+a.substring(0,a.length-o),s=l+s}for(var r=i,d=a,c=s,u=t(i,a)+t(a,s);a.charAt(0)===s.charAt(0);){i+=a.charAt(0),a=a.substring(1)+s.charAt(0),s=s.substring(1);var h=t(i,a)+t(a,s);h>=u&&(u=h,r=i,d=a,c=s)}e[n-1][1]!=r&&(r?e[n-1][1]=r:(e.splice(n-1,1),n--),e[n][1]=d,c?e[n+1][1]=c:(e.splice(n+1,1),n--))}n++}},Ne.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,Ne.whitespaceRegex_=/\s/,Ne.linebreakRegex_=/[\r\n]/,Ne.blanklineEndRegex_=/\n\r?\n$/,Ne.blanklineStartRegex_=/^\r?\n\r?\n/,Ne.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,n=[],i=0,a=null,s=0,o=!1,l=!1,r=!1,d=!1;s<e.length;)0==e[s][0]?(e[s][1].length<this.Diff_EditCost&&(r||d)?(n[i++]=s,o=r,l=d,a=e[s][1]):(i=0,a=null),r=d=!1):(e[s][0]==xe?d=!0:r=!0,a&&(o&&l&&r&&d||a.length<this.Diff_EditCost/2&&o+l+r+d==3)&&(e.splice(n[i-1],0,new Ne.Diff(xe,a)),e[n[i-1]+1][0]=1,i--,a=null,o&&l?(r=d=!0,i=0):(s=--i>0?n[i-1]:-1,r=d=!1),t=!0)),s++;t&&this.diff_cleanupMerge(e)},Ne.prototype.diff_cleanupMerge=function(e){e.push(new Ne.Diff(0,""));for(var t,n=0,i=0,a=0,s="",o="";n<e.length;)switch(e[n][0]){case 1:a++,o+=e[n][1],n++;break;case xe:i++,s+=e[n][1],n++;break;case 0:i+a>1?(0!==i&&0!==a&&(0!==(t=this.diff_commonPrefix(o,s))&&(n-i-a>0&&0==e[n-i-a-1][0]?e[n-i-a-1][1]+=o.substring(0,t):(e.splice(0,0,new Ne.Diff(0,o.substring(0,t))),n++),o=o.substring(t),s=s.substring(t)),0!==(t=this.diff_commonSuffix(o,s))&&(e[n][1]=o.substring(o.length-t)+e[n][1],o=o.substring(0,o.length-t),s=s.substring(0,s.length-t))),n-=i+a,e.splice(n,i+a),s.length&&(e.splice(n,0,new Ne.Diff(xe,s)),n++),o.length&&(e.splice(n,0,new Ne.Diff(1,o)),n++),n++):0!==n&&0==e[n-1][0]?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,a=0,i=0,s="",o=""}""===e[e.length-1][1]&&e.pop();var l=!1;for(n=1;n<e.length-1;)0==e[n-1][0]&&0==e[n+1][0]&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),l=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),l=!0)),n++;l&&this.diff_cleanupMerge(e)},Ne.prototype.diff_xIndex=function(e,t){var n,i=0,a=0,s=0,o=0;for(n=0;n<e.length&&(1!==e[n][0]&&(i+=e[n][1].length),e[n][0]!==xe&&(a+=e[n][1].length),!(i>t));n++)s=i,o=a;return e.length!=n&&e[n][0]===xe?o:o+(t-s)},Ne.prototype.diff_prettyHtml=function(e){for(var t=[],n=/&/g,i=/</g,a=/>/g,s=/\n/g,o=0;o<e.length;o++){var l=e[o][0],r=e[o][1].replace(n,"&amp;").replace(i,"&lt;").replace(a,"&gt;").replace(s,"&para;<br>");switch(l){case 1:t[o]='<ins style="background:#e6ffe6;">'+r+"</ins>";break;case xe:t[o]='<del style="background:#ffe6e6;">'+r+"</del>";break;case 0:t[o]="<span>"+r+"</span>"}}return t.join("")},Ne.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},Ne.prototype.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==xe&&(t[n]=e[n][1]);return t.join("")},Ne.prototype.diff_levenshtein=function(e){for(var t=0,n=0,i=0,a=0;a<e.length;a++){var s=e[a][0],o=e[a][1];switch(s){case 1:n+=o.length;break;case xe:i+=o.length;break;case 0:t+=Math.max(n,i),n=0,i=0}}return t+Math.max(n,i)},Ne.prototype.diff_toDelta=function(e){for(var t=[],n=0;n<e.length;n++)switch(e[n][0]){case 1:t[n]="+"+encodeURI(e[n][1]);break;case xe:t[n]="-"+e[n][1].length;break;case 0:t[n]="="+e[n][1].length}return t.join("\t").replace(/%20/g," ")},Ne.prototype.diff_fromDelta=function(e,t){for(var n=[],i=0,a=0,s=t.split(/\t/g),o=0;o<s.length;o++){var l=s[o].substring(1);switch(s[o].charAt(0)){case"+":try{n[i++]=new Ne.Diff(1,decodeURI(l))}catch(e){throw new Error("Illegal escape in diff_fromDelta: "+l)}break;case"-":case"=":var r=parseInt(l,10);if(isNaN(r)||r<0)throw new Error("Invalid number in diff_fromDelta: "+l);var d=e.substring(a,a+=r);"="==s[o].charAt(0)?n[i++]=new Ne.Diff(0,d):n[i++]=new Ne.Diff(xe,d);break;default:if(s[o])throw new Error("Invalid diff operation in diff_fromDelta: "+s[o])}}if(a!=e.length)throw new Error("Delta length ("+a+") does not equal source text length ("+e.length+").");return n};const Me=Object.freeze({UP_TO_DATE:0,SAVING:1,CANT_SAVE:2}),Fe={ACKNOWLEDGE:0,ADDITION:1,DELETION:2};Object.freeze(Fe);const Ae=new TextEncoder,Oe=new TextDecoder;class ke{position;content;constructor(e,t){this.position=e,this.content=t}getLength(){return Ae.encode(this.content).length}}class Le{type;range;isUndo=!1;isRedo=!1;tiedToPrevious=!1;isRemoteModification=!1;constructor(e,t,n){this.type=e,this.range=null!=t?new ke(t,n):null}combineWith(e){if(null==this.range||null==e.range)return!1;if(this.type===e.type){const t=e.range;if(this.type===Fe.ADDITION){if(t.position>=this.range.position&&t.position<=this.range.position+this.range.getLength())return this.range.content=this.range.content.splice(t.position-this.range.position,0,t.content),!0}else if(this.type===Fe.DELETION&&this.range.position>=t.position&&this.range.position<=t.position+t.getLength())return this.range.content=t.content.splice(this.range.position-t.position,0,this.range.content),this.range.position=t.position,!0}return!1}transformAfter(e,t){let n=this.copy();if(null==e.range||null==n.range)return[n];const i=e.range,a=n.range;if(i.position<a.position||t&&i.position===a.position)if(e.type===Fe.ADDITION)a.position+=i.getLength();else if(a.position>i.position+i.getLength()-1)a.position-=i.getLength();else{if(this.type===Fe.DELETION){const e=Math.min(i.position+i.getLength()-a.position,a.getLength());if(a.content=a.content.substring(e),""===a.content)return[]}a.position=i.position}else if(a.position<=i.position&&this.type===Fe.DELETION&&i.position<a.position+a.getLength())if(e.type===Fe.ADDITION){if(a.position!=i.position){const e=a.position,t=a.content.substring(0,i.position-a.position);return a.content=a.content.substring(i.position-a.position),a.position=i.position+i.getLength(),[n,new Le(this.type,e,t)]}a.position+=i.getLength()}else{const e=Math.min(a.position+a.getLength()-i.position,i.getLength());if(a.content=a.content.splice(i.position-a.position,e,""),""===a.content)return[]}return[n]}getReversed(){let e=Fe.ADDITION;return this.type===Fe.ADDITION&&(e=Fe.DELETION),null!=this.range?new Le(e,this.range.position,this.range.content):new Le(e)}copy(){return null!=this.range?new Le(this.type,this.range.position,this.range.content):new Le(this.type)}applyToText(e){if(null!=this.range){let t=Ae.encode(e);t=t.subarray(0,this.range.position);const n=Oe.decode(t).length;this.type===Fe.ADDITION?e=e.splice(n,0,this.range.content):this.type===Fe.DELETION&&(e=e.splice(n,this.range.content.length,""))}return e}flatten(){return{type:this.type,position:this.range.position,content:this.range.content}}}function Re(e,t){const n=[];let i=e.map((e=>e.copy()));for(let e=0;e<t.length;e++){let a=[t[e].copy()];const s=[];for(let e=0;e<i.length;e++){const t=[];for(const n of a){const a=n.transformAfter(i[e],!0);t.push(...a)}let n=[i[e]];for(const e of a){const t=[];for(const i of n){const n=i.transformAfter(e,!1);t.push(...n)}n=t}a=t,i[e].tiedToPrevious&&n.length>0&&(n[0].tiedToPrevious=!0);for(let e=1;e<n.length;e++)n[e].tiedToPrevious=!0;s.push(...n)}i=s,t[e].tiedToPrevious&&a.length>0&&(a[0].tiedToPrevious=!0);for(let e=1;e<a.length;e++)a[e].tiedToPrevious=!0;n.push(...a)}return[i,n]}class _e{constructor(e,t,n,a,s){this.fileName=e,this.version=t,this.savedContent=n,this.localContent=n,this.upToDate=!0,this.autosave=a,this.changeSaveStateDelay=0,this.onSaveStateChange=s,this.modifications=[],this.cantSave=!1,this.unsentModificationIndex=0,this.modificationsSent=0,this.modificationSendDelay=0,this.sendCursorCooldown=!1,this.sendCursorWhenPossible=!1,this.dontCombine=!1,this.wsDisconnectHandler=()=>{this.cantSave=!0,this.modificationsSent=0,this.modificationSendDelay&&(clearTimeout(this.modificationSendDelay),this.modificationSendDelay=0),this.sendCursorWhenPossible=!1,this.onSaveStateChange(this.fileName,this.getSaveStatus())},this.wsConnectHandler=()=>{this.cantSave=!1,a&&this.sendModifications(400,!1),this.onSaveStateChange(this.fileName,this.getSaveStatus()),this.sendCursorData()},i.registerDisconnectHandler(this.wsDisconnectHandler),i.registerConnectHandler(this.wsConnectHandler)}addModification(e){let t=!1;if(!e.isUndo&&!e.isRedo&&!this.dontCombine){let n=this.modifications.length-1;for(;n>=0&&this.modifications[n].isRemoteModification;)n--;if(n>=0){const i=this.modifications[n];i.isUndo||i.isRedo||(i.type===e.type&&n>=this.unsentModificationIndex+this.modificationsSent&&(t=i.combineWith(e)),t||(e.tiedToPrevious=!0))}}t||this.modifications.push(e),this.dontCombine=!1;let n=!0;null==e.range&&this.modifications.length-this.unsentModificationIndex==1?(n=!1,this.unsentModificationIndex++):this.autosave&&this.sendModifications(400,!1),this.trimModificationHistory(),this.changeSaveStateDelay&&(clearTimeout(this.changeSaveStateDelay),this.changeSaveStateDelay=0),this.upToDate&&n&&(this.upToDate=!1,this.onSaveStateChange(this.fileName,this.getSaveStatus()))}trimModificationHistory(){if(this.modifications.length>11e3){let e=Math.min(this.modifications.length-1e4,this.unsentModificationIndex);for(;e<this.unsentModificationIndex&&this.modifications[e].isRemoteModification;)e++;this.modifications.splice(0,e),this.unsentModificationIndex-=e}}sendModifications(e,t){if(this.modificationSendDelay&&t&&(clearTimeout(this.modificationSendDelay),this.modificationSendDelay=0),!this.cantSave&&0===this.modificationSendDelay&&0===this.modificationsSent&&this.unsentModificationIndex<this.modifications.length){const t=()=>{this.modificationSendDelay=0;const e=[];for(let t=this.unsentModificationIndex;t<this.modifications.length;t++)null!=this.modifications[t].range&&e.push(this.modifications[t].flatten());i.sendMessage("FILE:MODIFICATION",{fileName:this.fileName,version:this.version,modifications:e}),this.modificationsSent=this.modifications.length-this.unsentModificationIndex};e?this.modificationSendDelay=setTimeout(t,e):t()}}resendModifications(){if(this.modificationsSent>0){const e=this.unsentModificationIndex+this.modificationsSent;e<this.modifications.length&&this.modifications[e].tiedToPrevious&&this.modifications[e-1].combineWith(this.modifications[e])&&this.modifications.splice(e,1),this.modificationsSent=0}this.sendModifications(300,!0)}sendCursorData(){if(!this.cantSave)if(this.sendCursorCooldown)this.sendCursorWhenPossible=!0;else{let e=this.getCursorSelections();if(e){const t=[];for(let e=this.modifications.length-1;e>=this.unsentModificationIndex;e--)t.push(this.modifications[e].getReversed());e=this.transformCursorSelections(t,e,!0),i.sendMessage("FILE:UPDATE_CURSOR",this.fileName,e),this.sendCursorCooldown=!0,setTimeout((()=>{this.sendCursorCooldown=!1,this.sendCursorWhenPossible&&(this.sendCursorWhenPossible=!1,this.sendCursorData())}),350)}}}transformCursorSelections(e,t,n){const i=[];for(let a=0;a<t.length;a++){const s=" ".repeat(Math.abs(t[a].end-t[a].start));let o=new Le(Fe.DELETION,Math.min(t[a].start,t[a].end),s);for(const t of e){const e=o.transformAfter(t,n);if(0===e.length)o=new Le(Fe.DELETION,Math.min(o.range.position,t.range.position),"");else if(e.length>1){const t=e[0].range.position+e[0].range.getLength(),n=e[e.length-1].range.position,i=" ".repeat(t-n);o=new Le(Fe.DELETION,n,i)}else o=e[0]}const l=o.range;t[a].start>t[a].end?i.push({start:l.position+l.getLength(),end:l.position}):i.push({start:l.position,end:l.position+l.getLength()})}return i}getCursorSelections(){return null}remoteModification(e,t){if(this.version=e,0===t.length)return;if(t[0].type===Fe.ACKNOWLEDGE){for(let e=this.unsentModificationIndex;e<this.unsentModificationIndex+this.modificationsSent;e++)this.savedContent=this.modifications[e].applyToText(this.savedContent);if(this.modifications[this.unsentModificationIndex].tiedToPrevious){const e=this.modifications[this.unsentModificationIndex-1];!e.isRemoteModification&&e.combineWith(this.modifications[this.unsentModificationIndex])&&(this.modifications.splice(this.unsentModificationIndex,1),this.modificationsSent--)}this.unsentModificationIndex+=this.modificationsSent,this.modificationsSent=0,this.autosave&&this.sendModifications(400,!1),this.sendCursorData()}else{for(const e of t)e.isRemoteModification=!0,this.savedContent=e.applyToText(this.savedContent);let e=t;if(this.modifications.length>0){if(this.unsentModificationIndex<this.modifications.length){const n=this.modifications.splice(this.unsentModificationIndex,this.modifications.length-this.unsentModificationIndex),[i,a]=Re(t,n);this.modifications.push(...t,...a),this.unsentModificationIndex+=t.length,this.resendModifications(),e=i}else this.modifications.push(...t),this.unsentModificationIndex+=t.length;this.trimModificationHistory()}this.applyModifications(e)}const n=this.unsentModificationIndex>=this.modifications.length;if(this.upToDate!=n&&!this.changeSaveStateDelay){const e=()=>{this.upToDate=n,this.onSaveStateChange(this.fileName,this.getSaveStatus())};this.autosave?this.changeSaveStateDelay=setTimeout(e,500):e()}}_prepareUndoRedo(e){let t=[];const n=this.modifications[e].getReversed();null!=n.range&&t.push(n);let i=!0;for(let n=e+1;n<this.modifications.length&&i;n++){const e=this.modifications[n];if(e.isRemoteModification){const[n,i]=Re([e],t);t=i}else if(i)if(e.tiedToPrevious){const n=e.getReversed();t.length>0&&n.combineWith(t[0])?t[0]=n:t.unshift(n)}else{i=!1;let e=[];for(let t=this.modifications.length-1;t>=n;t--)if(this.modifications[t].isRemoteModification)e.unshift(this.modifications[t]);else{const n=this.modifications[t].getReversed(),[i,a]=Re(e,[n]);e=i}const[a,s]=Re(e,t);t=s}}return t}performUndo(){let e=0,t=-1;for(let n=this.modifications.length-1;n>=0;n--)if(!this.modifications[n].isRemoteModification&&!this.modifications[n].tiedToPrevious)if(this.modifications[n].isUndo)e++;else{if(!(e>0)){t=n;break}e--}if(t>=0){const e=this._prepareUndoRedo(t);if(0===e.length){const e=new Le(Fe.ADDITION);return e.isUndo=!0,this.addModification(e),[]}e[0].isUndo=!0,this.addModification(e[0]);for(let t=1;t<e.length;t++)e[t].tiedToPrevious=!0,e[t].isUndo=!0,this.addModification(e[t]);return this.applyModifications(e),e}return null}performRedo(){let e=0,t=-1;for(let n=this.modifications.length-1;n>=0;n--)if(!this.modifications[n].isRemoteModification&&!this.modifications[n].tiedToPrevious)if(this.modifications[n].isRedo)e++;else{if(!this.modifications[n].isUndo)break;if(!(e>0)){t=n;break}e--}if(t>=0){const e=this._prepareUndoRedo(t);if(0===e.length){const e=new Le(Fe.ADDITION);return e.isRedo=!0,this.addModification(e),[]}e[0].isRedo=!0,this.addModification(e[0]);for(let t=1;t<e.length;t++)e[t].isRedo=!0,e[t].tiedToPrevious=!0,this.addModification(e[t]);return this.applyModifications(e),e}return null}resync(e,t){const n=new Ne;n.Diff_Timeout=.5;const i=n.diff_main(this.savedContent,t);n.diff_cleanupSemantic(i);let a=0;const s=[];for(const e of i)0===e[0]?a+=e[1].length:e[0]===xe?s.push(new Le(Fe.DELETION,a,e[1])):1===e[0]&&(s.push(new Le(Fe.ADDITION,a,e[1])),a+=e[1].length);this.remoteModification(e,s)}applyModifications(e){for(const t of e)this.localContent=t.applyToText(this.localContent)}getSaveStatus(){return this.upToDate?Me.UP_TO_DATE:this.cantSave?Me.CANT_SAVE:Me.SAVING}getLocalContent(){return this.localContent}changeFileName(e){this.fileName=e,this.version+=1,this.sendCursorData(),(this.autosave||this.modificationsSent>0)&&this.resendModifications()}setAutosave(e){e!=this.autosave&&(this.autosave=e,e&&!this.upToDate&&this.sendModifications(0,!0))}close(){i.removeDisconnectHandler(this.wsDisconnectHandler),i.removeConnectHandler(this.wsConnectHandler)}codeUnitToByteIndex(e){const t=this.localContent.substring(0,e);return Ae.encode(t).length}byteToCodeUnitIndex(e){let t=Ae.encode(this.localContent);return t=t.subarray(0,e),Oe.decode(t).length}}class $e extends _e{constructor(e,t,i,a,s){super(e,t,i,a,s),this.editor=null,this.ignoreArtificialChanges=!1,this.ignoreLSPChanges=!1,this.oldDecorations=[],this.listeners=[],this.monaco=null,this.connectEditorWhenReady=null,Promise.all([n.e(3765),n.e(628),n.e(5140),n.e(9058)]).then(n.bind(n,10642)).then((e=>{this.monaco=e,this.connectEditorWhenReady&&(this.connectEditor(this.connectEditorWhenReady.editor,this.connectEditorWhenReady.callback),this.connectEditorWhenReady=null)}))}connectEditor(e,t){this.monaco?(this.editor=e,this.editor.createFileInstance(this.fileName,this.localContent).then((()=>{const e=this.editor.getEditorInstance();if(this.dontCombine=!0,!e.getOption(this.monaco.editor.EditorOptions.readOnly.id)){this.disposeUndoStopListener=this.editor.addUndoStopListener((()=>{this.dontCombine=!0})),this.listeners.push({dispose:this.disposeUndoStopListener});const t=this.editor.addDocumentChangeInterceptor((()=>this.ignoreLSPChanges));this.listeners.push({dispose:t});const n=this.editor.addSelectionChangeListener((()=>{setTimeout((()=>{this.sendCursorData()}),0)}));this.listeners.push({dispose:n}),this.listeners.push(e.onDidChangeModelContent((e=>{this.ignoreArtificialChanges||this.localModification(e)}))),this.listeners.push(e.onDidFocusEditorText((()=>{this.sendCursorData()}))),this.listeners.push(e.onKeyDown((e=>{if(!e.ctrlKey||e.altKey||e.metaKey||e.shiftKey||"56"!=e.keyCode){if(e.ctrlKey&&!e.altKey&&!e.metaKey&&!e.shiftKey&&"55"==e.keyCode||e.ctrlKey&&!e.altKey&&!e.metaKey&&e.shiftKey&&"56"==e.keyCode){e.stopPropagation(),e.preventDefault();const t=this.performRedo();t&&t.length>0&&this.moveCursorAfter(t[t.length-1])}}else{e.stopPropagation(),e.preventDefault();const t=this.performUndo();t&&t.length>0&&this.moveCursorAfter(t[t.length-1])}})))}this.listeners.push(e.onMouseMove((e=>{const t=e.event.posx,n=e.event.posy,i=document.body.style.getPropertyValue("--remote-selection-cursor-size"),a=parseFloat(i.slice(0,i.length-2));$(".remote-selection-cursor").each(((e,i)=>{const s=$(i).offset();t>=s.left-10*a&&t<=s.left+10*a&&n>=s.top-15*a&&n<=s.top+25*a?$(i).addClass("remote-selection-cursor-show-name"):$(i).removeClass("remote-selection-cursor-show-name")}))}))),t&&t()}))):this.connectEditorWhenReady={editor:e,callback:t}}disconnectEditor(){if(this.editor){this.editor.deleteFileInstance();for(const e of this.listeners)e.dispose();this.listeners=[],this.connectEditorWhenReady=null,this.editor=null}}remoteModification(e,t){this.ignoreLSPChanges=!0,setTimeout((()=>{this.ignoreLSPChanges=!1}),0),super.remoteModification(e,t)}localModification(e){for(const t of e.changes){const e=t.rangeOffset,n=t.rangeLength,i=this.codeUnitToByteIndex(e),a=[];if(n>0){const t=new Le(Fe.DELETION,i,this.localContent.substring(e,e+n));this.addModification(t),a.push(t)}if(t.text){const e=new Le(Fe.ADDITION,i,t.text);this.addModification(e),a.push(e)}for(const e of a)this.localContent=e.applyToText(this.localContent)}}applyModifications(e){if(this.editor){this.ignoreArtificialChanges=!0,setTimeout((()=>{this.ignoreArtificialChanges=!1}),0);const t=this.editor.getEditorInstance();for(const n of e){const e=this.byteToCodeUnitIndex(n.range.position),i=t.getModel().getPositionAt(e);if(n.type===Fe.ADDITION){const e={forceMoveMarkers:!0,range:new this.monaco.Range(i.lineNumber,i.column,i.lineNumber,i.column),text:n.range.content};t.getModel().applyEdits([e])}else{const a=t.getModel().getPositionAt(e+n.range.content.length),s={forceMoveMarkers:!0,range:new this.monaco.Range(i.lineNumber,i.column,a.lineNumber,a.column),text:""};t.getModel().applyEdits([s])}super.applyModifications([n])}}else super.applyModifications(e)}sendCursorData(){this.editor&&super.sendCursorData()}getCursorSelections(){const e=this.editor.getEditorInstance(),t=[];for(const n of e.getSelections()){let i=e.getModel().getOffsetAt({column:n.selectionStartColumn,lineNumber:n.selectionStartLineNumber});i=this.codeUnitToByteIndex(i);let a=e.getModel().getOffsetAt(n.getPosition());a=this.codeUnitToByteIndex(a),t.push({start:i,end:a})}return t}moveCursorAfter(e){let t=this.byteToCodeUnitIndex(e.range.position);e.type===Fe.ADDITION&&(t+=e.range.content.length);const n=this.editor.getEditorInstance();n.setPosition(n.getModel().getPositionAt(t))}clearCursorDecorations(){this.editor&&(this.editor.getEditorInstance().getModel().deltaDecorations(this.oldDecorations,[]),this.oldDecorations=[])}renderCursorDecorations(e,t,n){if(this.editor){e=this.transformCursorSelections(this.modifications.slice(this.unsentModificationIndex),e,!0);const i=this.editor.getEditorInstance().getModel();this.createCursorClasses(t,n);for(const a of e){let e,s;a.start<=a.end?(s="remote-selection-cursor remote-selection-name-"+n+" remote-selection-color-"+t,e=null):(s=null,e="remote-selection-cursor remote-selection-name-"+n+" remote-selection-color-"+t);const o=i.getPositionAt(this.byteToCodeUnitIndex(a.start)),l=i.getPositionAt(this.byteToCodeUnitIndex(a.end)),r={range:new this.monaco.Range(o.lineNumber,o.column,l.lineNumber,l.column),options:{className:"remote-selection-color-"+t,afterContentClassName:s,beforeContentClassName:e,stickiness:this.monaco.editor.TrackedRangeStickiness.GrowsOnlyWhenTypingAfter,zIndex:10}};this.oldDecorations.push(i.deltaDecorations([],[r])[0])}}}createCursorClasses(e,t){let n=$("#monaco-color-styles");0==n.length&&(n=$('<style id="monaco-color-styles" type="text/css"></style>'),$("head").append(n));let i=!1,a=!1;for(const s of n[0].sheet.cssRules)i|=s.selectorText.startsWith(".remote-selection-color-"+e),a|=s.selectorText.startsWith(".remote-selection-name-"+t);i||n.html((n.html()||"")+`\n.remote-selection-color-${e} {\n\tbackground-color: #${e}26 !important;\n\tcolor: #${e};\n}\n.remote-selection-color-${e}::after {\n\tbackground-color: #${e};\n}`),a||n.html((n.html()||"")+`\n.remote-selection-name-${t}::after {\n\tcontent: '${t}' !important;\n}`)}close(){super.close(),this.disconnectEditor()}}class je extends _e{constructor(e,t,i,a,s){super(e,t,i,a,s),this.editor=null,this.extensionsCompartment=null,this.peerDecorationData=[],this.peerDecorationCache=null,this.refreshingDecorations=!1,this.artificialModificationAnnotation=null,this.disposableListeners=[],this.codemirror=null,this.connectEditorWhenReady=null,Promise.all([n.e(8213).then(n.bind(n,36898)),n.e(8213).then(n.bind(n,31638))]).then((e=>{this.codemirror={view:e[0],state:e[1]},this.connectEditorWhenReady&&(this.connectEditor(this.connectEditorWhenReady.editor,this.connectEditorWhenReady.callback),this.connectEditorWhenReady=null)}))}connectEditor(e,t){this.codemirror?(this.editor=e,this.editor.createFileInstance(this.fileName,this.localContent).then((()=>{const e=this.editor.getEditorInstance();this.dontCombine=!0,this.artificialModificationAnnotation=this.codemirror.state.Annotation.define();const n=[];if(!e.state.readOnly){this.disposableListeners.push(this.editor.addUndoStopListener((()=>{this.dontCombine=!0}))),this.disposableListeners.push(this.editor.addSelectionChangeListener((()=>{setTimeout((()=>{this.sendCursorData()}),0)}))),n.push(this.codemirror.state.EditorState.changeFilter.of((e=>{e.docChanged&&this.localModification(e)})));const e=()=>{const e=this.performRedo();e&&e.length>0&&(this.moveCursorAfter(e[e.length-1]),this.refreshDecorations())};n.push(this.codemirror.view.keymap.of([{key:"Ctrl-z",run:()=>{const e=this.performUndo();e&&e.length>0&&(this.moveCursorAfter(e[e.length-1]),this.refreshDecorations())},shift:e,preventDefault:!0,stopPropagation:!0},{key:"Ctrl-y",run:e,preventDefault:!0,stopPropagation:!0}]))}const i=e=>{$(".remote-selection-cursor").each(((t,n)=>{const i=$(n).offset();e.pageX>=i.left-20&&e.pageX<=i.left+20&&e.pageY>=i.top-15&&e.pageY<=i.top+25?$(n).addClass("remote-selection-cursor-show-name"):$(n).removeClass("remote-selection-cursor-show-name")}))};$(this.editor.getDom()).on("mousemove",i),this.disposableListeners.push((()=>{$(this.editor.getDom()).off("mousemove",i)})),n.push(this.codemirror.view.EditorView.decorations.of((()=>{if(!this.peerDecorationCache){this.refreshingDecorations=!1;let e=[];for(const t of this.peerDecorationData){let n=[];for(const e of t.selections)n.push({...e});n=this.transformCursorSelections(this.modifications.slice(this.unsentModificationIndex),n,!1);for(const i of n){const n=this.byteToCodeUnitIndex(i.start),a=this.byteToCodeUnitIndex(i.end);if(n-a!=0){const s=i.start>i.end,o={attributes:{style:`background-color: #${t.color}26 !important;`},inclusiveStart:!s,inclusiveEnd:s};let l=this.codemirror.view.Decoration.mark(o);l=s?l.range(a,n):l.range(n,a),e.push(l)}const s=He(this.codemirror.view.WidgetType);let o=this.codemirror.view.Decoration.widget({widget:new s(t.color,t.username),side:-1e3}).range(a);e.push(o)}}this.peerDecorationCache=e}const t=e.state.doc.length,n=[];for(const e of this.peerDecorationCache)n.push({from:Math.min(e.from,t),to:Math.min(e.to,t),value:e.value});return this.codemirror.view.Decoration.set(n)}))),n.length>0&&(this.extensionsCompartment=new this.codemirror.state.Compartment,e.dispatch({effects:this.codemirror.state.StateEffect.appendConfig.of(this.extensionsCompartment.of(n))})),t&&t()}))):this.connectEditorWhenReady={editor:e,callback:t}}disconnectEditor(){if(this.editor){this.editor.deleteFileInstance(),this.extensionsCompartment&&(this.editor.getEditorInstance().dispatch({effects:this.extensionsCompartment.reconfigure([])}),this.extensionsCompartment=null);for(const e of this.disposableListeners)e();this.disposableListeners=[],this.connectEditorWhenReady=null,this.editor=null}}localModification(e){if(!e.annotation(this.artificialModificationAnnotation)){const t=[];e.changes.iterChanges(((e,n,i,a,s)=>{const o=this.codeUnitToByteIndex(e);if(n-e>0){let i=[new Le(Fe.DELETION,o,this.editor.getEditorInstance().state.sliceDoc(e,n))];for(const e of t){const t=[];for(const n of i)t.push(...n.transformAfter(e,!0));i=t}for(const e of i)this.addModification(e),this.localContent=e.applyToText(this.localContent),t.push(e)}let l=s.toString();if(l){let e=[new Le(Fe.ADDITION,o,l)];for(const n of t){const t=[];for(const i of e)t.push(...i.transformAfter(n,!0));e=t}for(const n of e)this.addModification(n),this.localContent=n.applyToText(this.localContent),t.push(n)}})),this.refreshDecorations()}}applyModifications(e){if(this.editor){const t=[];for(const n of e){const e=this.byteToCodeUnitIndex(n.range.position);n.type===Fe.ADDITION?t.push({changes:{from:e,to:e,insert:n.range.content},annotations:this.artificialModificationAnnotation.of(!0),sequential:!0}):t.push({changes:{from:e,to:e+n.range.content.length,insert:""},annotations:this.artificialModificationAnnotation.of(!0),sequential:!0}),super.applyModifications([n])}this.editor.getEditorInstance().dispatch(...t)}else super.applyModifications(e)}sendCursorData(){this.editor&&super.sendCursorData()}getCursorSelections(){const e=[];for(const t of this.editor.getEditorInstance().state.selection.ranges){let n=this.codeUnitToByteIndex(t.anchor),i=this.codeUnitToByteIndex(t.head);e.push({start:n,end:i})}return e}moveCursorAfter(e){let t=this.byteToCodeUnitIndex(e.range.position);e.type===Fe.ADDITION&&(t+=e.range.content.length),this.editor.getEditorInstance().dispatch({selection:{anchor:t}})}clearCursorDecorations(){this.editor&&(this.peerDecorationData=[],this.refreshDecorations())}renderCursorDecorations(e,t,n){this.editor&&$(this.editor.getDom()).is(":visible")&&(this.peerDecorationData.push({selections:e,color:t,username:n}),this.refreshDecorations())}refreshDecorations(){this.refreshingDecorations||(this.refreshingDecorations=!0,this.peerDecorationCache=null,setTimeout((()=>{this.editor.getEditorInstance().update([])}),0))}close(){super.close(),this.disconnectEditor()}}let Ge=null;function He(e){return Ge||(Ge=class extends e{constructor(e,t){super(),this.color=e,this.username=t}toDOM(){return $(`<span class="remote-selection-cursor" style="color: #${this.color}; background-color: #${this.color};" data-peer-name="${this.username}"></span>`)[0]}}),Ge}class Ue{constructor(e,t,n,a){this.editorType=e,this.sendActiveFile=t,this.onSaveStatusChange=n,this.onPeerFilesChange=a,this.wsPipelineConnected=!0,this.filePipelines={},this.activeFile=null,this.peers={},this.cursorColorsUsed={f30000:0,f39900:0,dcdf13:0,"05f300":0,"00e4e3":0,"0049e6":0,aa1fff:0,f000ef:0},this.autosaveChangeListeners=[],this.autosavePreference=!0,this.lockAutosave=!1,i.registerDisconnectHandler((()=>{this.wsPipelineConnected=!1,this.onPeerFilesChange(null),this.peers={};for(const e of Object.keys(this.cursorColorsUsed))this.cursorColorsUsed[e]=0;this.markPeerCursors()})),i.registerConnectHandler((()=>{if(this.wsPipelineConnected=!0,i.sendMessage("FILE:SYNC_PRESENCING",(e=>{this.updatePresenceData(e)})),this.activeFile){const e=this.activeFile;this.activeFile=null,this.updateActiveFile(e)}})),i.registerEventHandler("FILE:MODIFICATION",(e=>{e.fileName in this.filePipelines&&this.filePipelines[e.fileName].remoteModification(e.version,function(e){const t=[];for(const n of e)t.push(new Le(n.type,n.position,n.content));return t}(e.modifications))})),i.registerEventHandler("FILE:EXTERNAL_MODIFICATION",((e,t)=>{e in this.filePipelines&&this.filePipelines[e].resync(this.filePipelines[e].version+1,t)})),i.registerEventHandler("FILE:PRESENCE",(e=>{this.updatePresenceData(e)})),window.addEventListener("beforeunload",(e=>{for(const t of Object.values(this.filePipelines))if(!t.upToDate)return e.preventDefault(),e.returnValue="Are you sure you want to leave? Unsaved changes may be lost.","Are you sure you want to leave? Unsaved changes may be lost."}))}getRandomColor(){let e=[],t=-1;for(const[n,i]of Object.entries(this.cursorColorsUsed))-1==t||i<t?(t=i,e=[n]):i==t&&e.push(n);const n=Math.floor(Math.random()*e.length);return this.cursorColorsUsed[e[n]]++,e[n]}updatePresenceData(e){for(const[t,n]of Object.entries(e))if(t in this.peers||(0==Object.keys(this.peers).length&&(this.lockAutosave=!0,this.autosavePreference||this.#i(!0)),this.peers[t]={color:this.getRandomColor(),username:null,activeFile:null,cursors:{}}),n){if("username"in n&&(this.peers[t].username=n.username),"cursors"in n)for(const[e,i]of Object.entries(n.cursors))null==i?delete this.peers[t].cursors[e]:this.peers[t].cursors[e]=i;"activeFile"in n&&n.activeFile!==this.peers[t].activeFile&&(this.peers[t].activeFile&&this.onPeerFilesChange(this.peers[t].activeFile,t,null),this.peers[t].activeFile=n.activeFile,this.peers[t].activeFile&&this.onPeerFilesChange(this.peers[t].activeFile,t,{username:this.peers[t].username,color:this.peers[t].color}))}else this.peers[t].activeFile&&this.onPeerFilesChange(this.peers[t].activeFile,t,null),this.cursorColorsUsed[this.peers[t].color]--,delete this.peers[t],0==Object.keys(this.peers).length&&(this.lockAutosave=!1,this.autosavePreference||this.#i(!1));this.markPeerCursors()}updateActiveFile(e){this.activeFile!==e&&(this.sendActiveFile&&this.wsPipelineConnected&&i.sendMessage("FILE:ACTIVE_FILE",e),this.activeFile=e)}openFile(e,t,n,a){if(e in this.filePipelines){const i=this.filePipelines[e];n()&&i.connectEditor(t,(()=>{this.markPeerCursors(e)}))}else this.wsPipelineConnected?i.sendMessage("FILE:SYNC_FILE",e,(i=>{if("ERROR"===i.status)a(1);else{const a=(e,t)=>{e in this.filePipelines?this.onSaveStatusChange(e,t):setTimeout((()=>{this.onSaveStatusChange(e,t)}),0)};let s=null;"monaco"==this.editorType?(s=new $e(e,i.version,i.content,this.autosavePreference||this.lockAutosave,a.bind(this)),this.filePipelines[e]=s):"codemirror"==this.editorType&&(s=new je(e,i.version,i.content,this.autosavePreference||this.lockAutosave,a.bind(this)),this.filePipelines[e]=s),n()&&s.connectEditor(t,(()=>{this.markPeerCursors(e)}))}})):a(0)}disconnectFileEditor(e){e in this.filePipelines&&this.filePipelines[e].disconnectEditor()}resyncFiles(e){let t=Object.keys(this.filePipelines).length;if(t>0){const n=[];for(const a of Object.keys(this.filePipelines))i.sendMessage("FILE:SYNC_FILE",a,(i=>{"ERROR"===i.status?(n.push(a),this.filePipelines[a].close(),delete this.filePipelines[a]):this.filePipelines[a].resync(i.version,i.content),t--,0==t&&e(n)}))}else e([])}registerAutosaveChangeListener(e){this.autosaveChangeListeners.push(e),e(this.autosavePreference||this.lockAutosave)}removeAutosaveChangeListener(e){const t=this.autosaveChangeListeners.indexOf(e);t>-1&&this.autosaveChangeListeners.splice(t,1)}setAutosave(e){e!=this.autosavePreference&&(this.autosavePreference=e,this.lockAutosave||this.#i(e))}#i(e){for(const t of Object.values(this.filePipelines))t.setAutosave(e);for(const t of this.autosaveChangeListeners)t(e)}forceSave(e){if(void 0!==e)e in this.filePipelines&&!this.filePipelines[e].upToDate&&this.filePipelines[e].sendModifications(0,!0);else for(const e of Object.values(this.filePipelines))e.upToDate||e.sendModifications(0,!0)}pathDeleted(e,t){const n=[{path:e,isDir:t}];for(const e of Object.keys(this.filePipelines))(0,we.JJ)(n,e)&&(this.wsPipelineConnected&&i.sendMessage("FILE:DISCONNECT",e),this.filePipelines[e].close(),delete this.filePipelines[e]);this.activeFile&&(0,we.JJ)(n,this.activeFile)&&this.updateActiveFile(null)}pathChanged(e,t,n){const i=[{path:e,isDir:n}];for(const n of Object.keys(this.filePipelines))if((0,we.JJ)(i,n)){this.disconnectFileEditor(n);const i=n.replace(e,t),a=this.filePipelines[n];this.filePipelines[i]=a,a.changeFileName(i),delete this.filePipelines[n]}if(this.activeFile&&(0,we.JJ)(i,this.activeFile)){const n=this.activeFile.replace(e,t);this.updateActiveFile(n)}}getSaveStatus(e){return e in this.filePipelines?this.filePipelines[e].getSaveStatus():Me.UP_TO_DATE}markPeerCursors(e){if(e){if(!(e in this.filePipelines))return;this.filePipelines[e].clearCursorDecorations()}else for(const e of Object.values(this.filePipelines))e.clearCursorDecorations();for(const[t,n]of Object.entries(this.peers))for(const[i,a]of Object.entries(n.cursors)){let n=this.peers[t].username;n||(n="Anonymous"),(i===e||!e&&i in this.filePipelines)&&this.filePipelines[i].renderCursorDecorations(a,this.peers[t].color,n)}}}const Be=["Hey.","You.","Yes, you.","Read the message below.","What are you doing? I already said that I can't display anything!","Ow, don't click me like that. It hurts!","I said stop clicking me!","JUST STOP!","OWWW!","Are you trying to get me to do something?!","Because if it's displaying a file, I physically can't do that.","OK, fine. I can, but it's... a secret. Discovered by the ancient Codepaland rulers, over 3000 years ago.","No, I can't give it to you. They'd delete me if that happens!","I ALREADY SAID NO!!! But I can do a cool dance if you'd like!","Bruhhhh..."],We=(0,w.memo)((function(){const e=(0,w.useRef)(0),t=(0,w.useRef)(!1);return w.createElement("h1",{className:"display-4 mb-4 mt-5 the-funny-file",style:{position:"relative"}},w.createElement("button",{className:"far fa-file btn btn-link",onClick:n=>{if(alert(Be[e.current]),13==e.current&&!t.current){const i=$(n.currentTarget.parentElement);t.current=!0,i.animate({left:70},500,(function(){i.animate({left:-70,top:-40},500,(function(){i.animate({top:20},500,(function(){i.animate({top:0,left:0},500,(function(){t.current=!1,alert("Okay.... yeah, that wasn't really impressive. But it was the best I could do!"),e.current++}))}))}))}))}t.current||e.current++,e.current==Be.length&&(e.current=0)},style:{fontSize:"inherit",boxShadow:"none"}}))})),ze=Object.freeze({NO_CONNECTION:0,NOT_EDITABLE:1,FILE_DELETED:2,OPEN_FILE_PROMPT:3,FILE:4});class Ve{constructor(e,t="",n=0){if(!(e in Object.values(ze)))throw new Error(`Invalid type '${e}' supplied to EditorContent constructor.`);this.type=e,this.file=t,this.delay=n}}const Je={[ze.NO_CONNECTION]:w.createElement(w.Fragment,null,w.createElement(We,null),w.createElement("h2",null,"Not connected to the server"),w.createElement("p",null,"Try checking your wifi connection or reloading the page.")),[ze.NOT_EDITABLE]:w.createElement(w.Fragment,null,w.createElement(We,null),w.createElement("h2",null,"This file is not editable"),w.createElement("p",null,"so CodePad doesn't know how to display this file."),w.createElement("i",{style:{fontSize:"10pt"}},"(if you really do want it to be displayed, maybe"," ",w.createElement("a",{href:"https://github.com/CodePadSite/codepad-issues/issues",rel:"noreferrer",target:"_blank"},"report this on GitHub!"),")")),[ze.FILE_DELETED]:w.createElement(w.Fragment,null,w.createElement(We,null),w.createElement("h2",null,"Uh oh, this file has been deleted :(")),[ze.OPEN_FILE_PROMPT]:w.createElement(w.Fragment,null,w.createElement("h2",{className:"px-3 mt-5"},w.createElement("i",{className:"fa-solid fa-arrow-left-long me-3"}),"Select a file or create one to start coding!"))},Ke=(0,w.memo)((function(){const[e,t]=(0,w.useState)(!1);return(0,w.useEffect)((()=>{const e=setTimeout((()=>{t(!0)}),175);return()=>{clearTimeout(e)}}),[]),e?w.createElement("div",{className:"editor-loading-icon"}):null})),Ye=(0,w.memo)((function({file:e}){const[t,n]=(0,w.useState)(!1),[i,a]=(0,w.useState)(100),[s,o]=(0,w.useState)(null),l=e=>{let t=-1;e&&(t=1);let n=i+t,a=20;return n>100&&n<200?a=25:n>200&&n<300?a=50:n>300&&(a=100),t*a};(0,w.useEffect)((()=>{o(null),n(!1)}),[e]);const r=(0,we.a)((0,we.uQ)(e));let d=null;if("audio"===r)d=w.createElement("div",{className:"media-display-outer"},w.createElement("div",{className:"media-display-inner"},w.createElement("audio",{controls:!0,onLoadedData:()=>{n(!0)}},w.createElement("source",{src:"/api/vfs/load_media?projectId="+window.CodePadGlobals.projectData.id+"&file="+e}))));else{let t=null;"img"===r?t=w.createElement("img",{onLoad:e=>{o({width:e.currentTarget.width,height:e.currentTarget.height}),n(!0)},src:"/api/vfs/load_media?projectId="+window.CodePadGlobals.projectData.id+"&file="+e,height:s?s.height*(i/100):"",alt:"Image: "+e}):"video"===r&&(t=w.createElement("video",{controls:!0,onLoadedMetadata:e=>{o({width:e.currentTarget.videoWidth,height:e.currentTarget.videoHeight})},onLoadedData:()=>{n(!0)},height:s?s.height*(i/100):""},w.createElement("source",{src:"/api/vfs/load_media?projectId="+window.CodePadGlobals.projectData.id+"&file="+e})));const c=()=>{a((e=>e>20?e+l(!1):e))},u=()=>{a((e=>e<500?e+l(!0):e))};d=w.createElement(w.Fragment,null,w.createElement("div",{className:"flex-grow-1 overflow-auto"},w.createElement("div",{className:"media-display-outer",onKeyDown:e=>{!e.ctrlKey||e.shiftKey||e.altKey||e.metaKey||("equal"===e.code.toLowerCase()?(e.stopPropagation(),e.preventDefault(),u()):"minus"===e.code.toLowerCase()&&(e.stopPropagation(),e.preventDefault(),c()))},tabIndex:-1},w.createElement("div",{className:"media-display-inner"},t))),w.createElement("div",{className:"editor-footer"},w.createElement("div",null,w.createElement("button",{className:"btn btn-sm btn-transparent",onClick:c,title:"Ctrl -",disabled:i<=20},w.createElement("i",{className:"fa-solid fa-minus"})),w.createElement("button",{className:"btn btn-sm btn-transparent",onClick:()=>{a(100)},style:{opacity:1},disabled:100==i},i,"%"),w.createElement("button",{className:"btn btn-sm btn-transparent",onClick:u,title:"Ctrl =",disabled:i>=500},w.createElement("i",{className:"fa-solid fa-plus"}))),s?s.width+" x "+s.height:""))}return w.createElement(w.Fragment,null,t?null:w.createElement(Ke,null),w.createElement("div",{className:"w-100 h-100 d-flex flex-column",style:{display:t?"":"none !important"}},d))})),qe=(0,w.memo)((function({collabManager:e,editor:t,content:n,autosaveEnabled:i,onNotConnected:a,onNotEditable:s}){const o=(0,y.Vo)(e),l=(0,y.Vo)(a),r=(0,y.Vo)(s),[d,c]=(0,w.useState)(!1),[u,h]=(0,w.useState)("Line 1, Col 1");(0,w.useEffect)((()=>{let e=!1,i=!1,a=null;return c(!1),t&&o.current.openFile(n.file,t,(()=>!e&&(a=t.addSelectionChangeListener((e=>{let t="";if(e.length>1){t=e.length+" selections";let n=0;for(const t of e)n+=t.charLength;n>0&&(t+=" ("+n+" characters selected)")}else t="Line "+e[0].endLine+", Col "+e[0].endColumn,e[0].charLength>0&&(t+=" ("+e[0].charLength+" selected)");h(t)})),i=!0,c(!0),!0)),(t=>{e||(0===t?l.current():1==t&&r.current())})),()=>{e=!0,i&&(a(),o.current.disconnectFileEditor(n.file))}}),[t,n,o,l,r]);const m=(0,w.useCallback)((e=>(e.appendChild(t.getDom()),t.resize(),()=>{})),[t]);return d?w.createElement("div",{className:"w-100 h-100 d-flex flex-column"},w.createElement("div",{className:"flex-grow-1 overflow-hidden",ref:m}),w.createElement("div",{className:"editor-footer"},w.createElement("div",null,w.createElement("button",{className:"btn btn-sm btn-transparent",onClick:()=>{t.executeFind()},title:"Find in file (Ctrl+F)"},w.createElement("i",{className:"fa-solid fa-search me-2"}),"Find"),w.createElement("button",{className:"btn btn-sm btn-transparent transition-visibility "+(i?"visibility-hidden":""),onClick:()=>{i||e.forceSave(n.file)},title:"Save file (Ctrl+S)"},w.createElement("i",{className:"fa-solid fa-save me-2"}),"Save")),u)):w.createElement(Ke,null)})),Xe=(0,w.memo)((function({content:e}){const[t,n]=(0,w.useState)(!0);return(0,w.useEffect)((()=>{let t=0;return e.delay>0&&(n(!1),t=setTimeout((()=>{n(!0)}),e.delay)),()=>{t&&clearTimeout(t)}}),[e]),t?w.createElement("div",{className:"text-center"},Je[e.type]):null})),Ze=(0,w.memo)((function({editorType:e,configWatcher:t,collabManager:i,resizeEvent:a,visibilityEvent:s,onRunFile:o,onNotConnected:l,onNotEditable:r,content:d}){const c=(0,y.Vo)(e),u=(0,y.Vo)(t),h=(0,y.Vo)(o),[m,p]=(0,w.useState)(null),[f,g]=(0,w.useState)(!0),b=(0,w.useCallback)((()=>{f||d.type!==ze.FILE||i.forceSave(d.file)}),[f,d,i]),v=(0,y.Vo)(b);(0,w.useEffect)((()=>{const e=e=>{g(e)};return i.registerAutosaveChangeListener(e),()=>{i.removeAutosaveChangeListener(e)}}),[i]),(0,w.useEffect)((()=>{const e=()=>{d.type===ze.FILE&&m&&setTimeout((()=>{m.resize()}),0)};return a.addHandler(e),()=>{a.removeHandler(e)}}),[a,d,m]),(0,w.useEffect)((()=>{const e=e=>{e.visible&&d.type===ze.FILE&&m&&setTimeout((()=>{m.resize(),i.markPeerCursors(d.file)}),0)};return s.addHandler(e),()=>{s.removeHandler(e)}}),[s,i,d,m]),(0,w.useEffect)((()=>{let e=null,t=!1;return async function(e){if("codemirror"===e){const{CodeMirrorWrapper:e}=await Promise.all([n.e(8213),n.e(8644),n.e(3701)]).then(n.bind(n,53701));return e}if("monaco"===e){const{MonacoWrapper:e}=await Promise.all([n.e(3765),n.e(628),n.e(5140),n.e(9058),n.e(9367),n.e(1347),n.e(530)]).then(n.bind(n,30530));return e}}(c.current).then((n=>{const i=new n(u.current,(()=>{h.current()}),(()=>{v.current()}));i.whenInitialized((()=>{t?i.dispose():(e=i,p(i))}))})),()=>{e&&(e.dispose(),e=null),t=!0}}),[u,c,h,v]);const E=(0,we.a)((0,we.uQ)(d.file));return d.type!==ze.FILE?w.createElement(Xe,{content:d}):"img"==E||"audio"==E||"video"==E?w.createElement(Ye,{file:d.file}):w.createElement(qe,{collabManager:i,editor:m,content:d,autosaveEnabled:f,onNotConnected:l,onNotEditable:r})}));function Qe(e){return e!==ze.OPEN_FILE_PROMPT&&e!==ze.FILE_DELETED}const et=Object.freeze({FILE_OPEN:0,FILE_SAVE:1,FILE_MARKER:2,FILE_LIST_CHANGE:3});class tt extends Ce{constructor(e,t,n,a,s){super(),this.layoutModel=e,this.editorType=t,this.configWatcher=n,this.onEditingEvent=a,this.onRunFile=s,this.editorTabs={},this.editorTabTitles={},this.disabledCloseId=null,this.activeTooltip=null,this.tooltipDeleteDelay=0,this.createTooltipCallback=null,this.fileMarkerData={},this.collabManager=new Ue(this.editorType,"edit"===window.CodePadGlobals.mode,((e,t)=>{this.onEditingEvent(et.FILE_SAVE,e,t);for(const[t,n]of Object.entries(this.editorTabs))n.content.file===e&&n.content.type===ze.FILE&&t in this.editorTabTitles&&this.editorTabTitles[t].setContent(this.getTitleContent(n.content))}),((e,t,n)=>{if(e){e in this.fileMarkerData||(this.fileMarkerData[e]={}),n?this.fileMarkerData[e][t]=n:t in this.fileMarkerData[e]&&delete this.fileMarkerData[e][t];const i=Object.keys(this.fileMarkerData[e]).map((t=>({id:t,...this.fileMarkerData[e][t]})));this.onEditingEvent(et.FILE_MARKER,e,i)}else{for(const e of Object.keys(this.fileMarkerData))this.onEditingEvent(et.FILE_MARKER,e,[]);this.fileMarkerData={}}})),i.registerEventHandler("FILE_SYSTEM:REMOVED",((e,t)=>{this.pathDeleted(e,t)})),i.registerEventHandler("FILE_SYSTEM:ADDED",((e,t)=>{t||this.filePathAdded(e)})),i.registerEventHandler("FILE_SYSTEM:RENAMED",((e,t,n)=>{this.pathDeleted(t,n),this.pathChanged(e,t,n),n||this.filePathAdded(t)})),i.registerConnectHandler((()=>{this.collabManager.resyncFiles((e=>{for(const t of Object.values(this.editorTabs))t.content.type===ze.FILE&&e.includes(t.content.file)?t.setContent(new Ve(ze.FILE_DELETED,t.content.file)):t.content.type===ze.NO_CONNECTION&&t.setContent(new Ve(ze.FILE,t.content.file))}))})),$(document).keydown((e=>{!e.ctrlKey||e.shiftKey||e.altKey||e.metaKey||83!=e.which||(e.stopPropagation(),e.preventDefault()),!e.ctrlKey||e.shiftKey||e.altKey||e.metaKey||82!=e.which||(e.stopPropagation(),e.preventDefault())})),this.loadPreferences(this.configWatcher.config,{}),this.configWatcher.registerChangeHandler(this.loadPreferences.bind(this))}getComponent(e){super.getComponent(e);const t=e.getId(),[n,i]=(0,w.useState)((()=>{if(e.getConfig()&&e.getConfig().initialFile){const t=e.getConfig().initialFile;return new Ve(ze.FILE,t)}return new Ve(ze.OPEN_FILE_PROMPT)})),a=(0,w.useRef)(!1);if(!a.current){a.current=!0;const e={content:n,setContent:t=>{e.content=t,i(t)}};this.editorTabs[t]=e}(0,w.useEffect)((()=>(this.layoutModel.doActionWithIntercept(Ie.En.updateNodeAttributes(t,{config:{}})),()=>{delete this.editorTabs[t]})),[t]);const s=(0,w.useCallback)((()=>{n.type===ze.FILE&&this.onRunFile(n.file)}),[n]),o=(0,w.useCallback)((()=>{const e=this.editorTabs[t];e.content.type===ze.FILE&&n.type===ze.FILE&&n.file===e.content.file&&e.setContent(new Ve(ze.NO_CONNECTION,n.file,750))}),[n,t]),l=(0,w.useCallback)((()=>{const e=this.editorTabs[t];e.content.type===ze.FILE&&n.type===ze.FILE&&n.file===e.content.file&&e.setContent(new Ve(ze.NOT_EDITABLE,n.file))}),[n,t]);return(0,w.useEffect)((()=>{let e=!1;return Qe(n.type)&&(e=!0,this.onEditingEvent(et.FILE_OPEN,n.file,!0)),t in this.editorTabTitles&&this.editorTabTitles[t].setContent(this.getTitleContent(n)),this.onTabListChanged(),()=>{e&&(e=!1,this.onEditingEvent(et.FILE_OPEN,n.file,!1))}}),[n,t]),w.createElement(Ze,{editorType:this.editorType,configWatcher:this.configWatcher,collabManager:this.collabManager,visibilityEvent:this.tabs[this.getTabIndex(t)].visibilityEvent,resizeEvent:this.tabs[this.getTabIndex(t)].resizeEvent,onRunFile:s,onNotConnected:o,onNotEditable:l,content:n})}getTitleContent(e){if(e&&e.type!==ze.OPEN_FILE_PROMPT){let t=-2,n="";return e.type===ze.FILE?t=this.collabManager.getSaveStatus(e.file):e.type===ze.FILE_DELETED&&(t=-1),t===Me.CANT_SAVE&&(n="Can't save: disconnected"),{title:(0,we.am)(e.file),tooltip:n,status:t}}return{title:"Editor",tooltip:"",status:0}}getComponentTitle(e){super.getComponentTitle(e);const t=e.getId(),[n,i]=(0,w.useState)((()=>{let e=null;return t in this.editorTabs&&(e=this.editorTabs[t].content),this.getTitleContent(e)})),a=(0,w.useRef)(null),s=(0,w.useRef)(!1);s.current||(s.current=!0,t in this.editorTabTitles?this.editorTabTitles[t]._contentSetters.add(i):this.editorTabTitles[t]={_contentSetters:new Set([i]),setContent:e=>{this.layoutModel.getNodeById(t)&&this.layoutModel.doActionWithIntercept(Ie.En.updateNodeAttributes(t,{name:e.title}));for(const n of this.editorTabTitles[t]._contentSetters)n(e)}}),(0,w.useEffect)((()=>()=>{this.editorTabTitles[t]._contentSetters.delete(i),0===this.editorTabTitles[t]._contentSetters.size&&delete this.editorTabTitles[t]}),[t]),(0,w.useEffect)((()=>{a.current&&(n.tooltip?(a.current.enable(),a.current.setContent({".tooltip-inner":n.tooltip})):(a.current.hide(),a.current.disable()))}),[n]);let o=null;switch(n.status){case-2:case Me.UP_TO_DATE:o=w.createElement(w.Fragment,null,n.title);break;case Me.SAVING:o=w.createElement("span",{style:{color:"var(--saving-color)"}},n.title);break;case Me.CANT_SAVE:o=w.createElement("span",{className:"text-danger"},n.title);break;case-1:o=w.createElement("s",{className:"text-danger"},n.title)}return w.createElement(y.O2,{tag:"span",title:"_",ref:a},o)}closingTab(){if(super.closingTab(),1===this.tabs.length){const e=this.editorTabs[this.tabs[0].id];return e.content.type!==ze.OPEN_FILE_PROMPT&&e.setContent(new Ve(ze.OPEN_FILE_PROMPT)),!1}return!0}onTabListChanged(){1===this.tabs.length&&this.editorTabs[this.tabs[0].id].content.type===ze.OPEN_FILE_PROMPT?(this.disabledCloseId=this.tabs[0].id,this.layoutModel.doActionWithIntercept(Ie.En.updateNodeAttributes(this.disabledCloseId,{enableClose:!1}))):this.disabledCloseId&&(this.layoutModel.doActionWithIntercept(Ie.En.updateNodeAttributes(this.disabledCloseId,{enableClose:!0})),this.disabledCloseId=null);const e=this.getMostActiveTab((e=>Qe(this.editorTabs[e.id].content.type)));e?this.collabManager.updateActiveFile(this.editorTabs[e.id].content.file):this.collabManager.updateActiveFile(null);const t=this.tabs.reduce(((e,t)=>{const n=this.editorTabs[t.id];return Qe(n.content.type)&&e.unshift(n.content.file),e}),[]);this.onEditingEvent(et.FILE_LIST_CHANGE,t)}initiatedPathDeletes(e){const t=[];for(const n of this.tabs){const i=this.editorTabs[n.id];(0,we.JJ)(e,i.content.file)&&t.push(n)}if(t.length===this.tabs.length){const e=this.editorTabs[t.pop().id];e.content.type!==ze.OPEN_FILE_PROMPT&&e.setContent(new Ve(ze.OPEN_FILE_PROMPT))}for(const e of t)this.layoutModel.doActionWithIntercept(Ie.En.deleteTab(e.id))}openFile(e){let t=null;for(let n=this.tabs.length-1;n>=0;n--){const i=this.tabs[n],a=this.editorTabs[i.id];if(a.content.file===e){const e=this.layoutModel.getNodeById(i.id);return void(e.getParent().getType()===Ie.ro.TYPE&&e.isVisible()||this.layoutModel.doActionWithIntercept(Ie.En.selectTab(i.id)))}t||Qe(a.content.type)||(t=i.id)}if(t){const n=this.layoutModel.getNodeById(t),i=this.layoutModel.getMaximizedTabset();i&&n.getParent()!==i&&this.layoutModel.doActionWithIntercept(Ie.En.maximizeToggle(i.getId())),this.editorTabs[t].setContent(new Ve(ze.FILE,e));const a=this.layoutModel.getNodeById(t);a.getParent().getType()===Ie.ro.TYPE&&a.isVisible()||this.layoutModel.doActionWithIntercept(Ie.En.selectTab(t))}else{let t=null;t=this.layoutModel.getMaximizedTabset()?this.layoutModel.getMaximizedTabset().getId():this.layoutModel.getNodeById(this.tabs[this.tabs.length-1].id).getParent().getId(),this.layoutModel.doActionWithIntercept(Ie.En.addNode({type:"tab",name:"Editor",component:"editor",icon:"fa-solid fa-file-pen",config:{initialFile:e}},t,Ie.$z.CENTER,-1))}}saveAllFiles(){this.collabManager.forceSave()}pathDeleted(e,t){this.collabManager.pathDeleted(e,t);const n=[{path:e,isDir:t}];for(const t of Object.values(this.editorTabs))Qe(t.content.type)&&(0,we.JJ)(n,t.content.file)&&t.setContent(new Ve(ze.FILE_DELETED,e))}filePathAdded(e){for(const t of Object.values(this.editorTabs))t.content.type===ze.FILE_DELETED&&t.content.file===e&&t.setContent(new Ve(ze.FILE,e))}pathChanged(e,t,n){this.collabManager.pathChanged(e,t,n);const i=[{path:e,isDir:n}];for(const n of Object.values(this.editorTabs))if(Qe(n.content.type)&&(0,we.JJ)(i,n.content.file)){const i=n.content.file.replace(e,t);for(const e of this.tabs)this.editorTabs[e.id].content.file===i&&this.layoutModel.doActionWithIntercept(Ie.En.deleteTab(e.id));n.setContent(new Ve(ze.FILE,i))}}loadPreferences(e,t){e.fontSize!==t.fontSize&&this.changeFontSize(e.fontSize),e.epicMode!==t.epicMode&&this.applyEpicMode(e.epicMode),e.autosave!==t.autosave&&this.applyAutosaveSetting(e.autosave)}applyEpicMode(e){e?($("#epicmode").show(),$("#navbar-icon-actions .fa-solid").addClass("rainbow"),$("#profile-dropdown").addClass("rainbow"),$("#codepad-brand").addClass("rainbow")):($("#epicmode").hide(),$("#navbar-icon-actions .fa-solid").removeClass("rainbow"),$("#profile-dropdown").removeClass("rainbow"),$("#codepad-brand").removeClass("rainbow"))}applyAutosaveSetting(e){e?this.collabManager.setAutosave(!0):this.collabManager.setAutosave(!1)}changeFontSize(e){const t=Math.max(1,e/9);document.body.style.setProperty("--remote-selection-cursor-size",t+"px")}}var nt=n(9762),it=n(75655);async function at(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t={};e&&(t.basePaths=e);const n=await fetch(`/api/vfs/list/${window.CodePadGlobals.projectData.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok){const e=await n.text();return alert("Failed to get list of files!\n"+e),[]}return await n.json()}n(13579),n(14603),n(47566),n(98721);let st=null,ot=0;async function lt(e,t){"edit"===window.CodePadGlobals.mode&&(st&&st.path==e&&st.isManualMainFile==t||(st={path:e,isManualMainFile:t},ot&&(clearTimeout(ot),ot=0),ot=setTimeout((async()=>{const e=await fetch("/api/projects/save_main_file",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({mainfile:st.path,manualMainFile:st.isManualMainFile,projectId:window.CodePadGlobals.projectData.id})});e.ok||404!=e.status&&alert(await e.text())}),250)))}async function rt(e,t){const n=await fetch("/api/vfs/move",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({projectId:window.CodePadGlobals.projectData.id,oldPath:e,newPath:t})});if(!n.ok){const e=await n.text();alert("Error moving file: "+n.status+"\n"+e)}}async function dt(e){const t=await fetch("/api/vfs/duplicate",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({projectId:window.CodePadGlobals.projectData.id,path:e})});if(!t.ok){const n=await t.text();alert("Could not duplicate: "+e+"\n"+n)}}async function ct(e){const t=await fetch("/api/vfs/delete",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({projectId:window.CodePadGlobals.projectData.id,path:e})});if(!t.ok){const n=await t.text();alert("Failed to delete: "+e+"\n"+n)}}function ut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=e=>{const t=document.createElement("a");t.href="/api/vfs/download?projectId="+window.CodePadGlobals.projectData.id,e&&(t.href+="&path="+e),t.target="_blank",t.download="",t.click()};if(null!=e)for(const n of e)t(n.data.fullPath);else t()}const ht="ROOT";function mt(e){return e.replace(/^(\/|\s)+|(\/|\s)+$/g,"").replace(/\/+/g,"/")}let pt=0;function ft(){return pt++,`ITEM_${pt}`}class gt{static get DORMANT(){return 1}static get SYNCING(){return 2}#a=(()=>gt.DORMANT)();#s=null;#o=null;constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gt.DORMANT;this.#a=e}set state(e){e!=gt.SYNCING&&this.#o?(this.#o(),this.#s=null,this.#o=null):e!=gt.SYNCING||this.#s||(this.#s=new Promise((e=>{this.#o=e}))),this.#a=e}get state(){return this.#a}whenLoaded(){return this.#s?this.#s:Promise.resolve()}}class bt extends gt{static get UNLOADED(){return gt.DORMANT}static get LOADING(){return gt.SYNCING}static get LOADED(){return 3}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:bt.UNLOADED)}}const vt={fileName:{makefile:{value:"/static/images/icons/makefile.svg",isUrl:!0},Makefile:{value:"/static/images/icons/makefile.svg",isUrl:!0}},ext:{html:{value:"/static/images/icons/html.png",isUrl:!0},css:{value:"/static/images/icons/css.png",isUrl:!0},js:{value:"/static/images/icons/javascript.png",isUrl:!0},jsx:{value:"/static/images/icons/jsx.svg",isUrl:!0},php:{value:"/static/images/icons/php.png",isUrl:!0},py:{value:"/static/images/icons/python.png",isUrl:!0},java:{value:"/static/images/icons/java.png",isUrl:!0},txt:{value:"fa-solid fa-file-alt",isUrl:!1},yaml:{value:"/static/images/icons/yaml.png",isUrl:!0},json:{value:"/static/images/icons/json.png",isUrl:!0},lol:{value:"/static/images/icons/lol_out_loud.png",isUrl:!0},sh:{value:"/static/images/icons/file_shell.png",isUrl:!0},cpp:{value:"/static/images/icons/cpp.svg",isUrl:!0},h:{value:"/static/images/icons/h.svg",isUrl:!0},hpp:{value:"/static/images/icons/h.svg",isUrl:!0}},img:{value:"fa-regular fa-image",isUrl:!1},audio:{value:"fa-solid fa-music",isUrl:!1},video:{value:"fa-solid fa-video",isUrl:!1},zip:{value:"fa-solid fa-file-archive",isUrl:!1},file:{value:"fa-regular fa-file",isUrl:!1}};function Et(e){const t=(0,we.uQ)(e),n=(0,we.hA)(e),i={java:["java","class"],python:["py"],htmlmixed:["html"],php:["php","html"],cpp:["cpp"]}[window.CodePadGlobals.projectData.lang]??[],a={cpp:["Makefile","makefile"]}[window.CodePadGlobals.projectData.lang]??[];return i.includes(t)||a.includes(n)}function yt(e){const t=(0,we.uQ)(e);return["png","jpg","jpeg","jfif","pjpeg","pjp","svg","tif","tiff","webp","apng","bmp","ico","cur","gif"].includes(t)?vt.img:["mp3","ogg","wav","wma"].includes(t)?vt.audio:["mp4","mov","m4v","avi","wmv"].includes(t)?vt.video:["zip","rar","7z","tar","gz","tgz"].includes(t)?vt.zip:e in vt.fileName?vt.fileName[e]:t in vt.ext?vt.ext[t]:vt.file}class wt{constructor(e,t,n){n.includes("/")&&console.error(`ItemData name cannot contain a slash! (base: ${t}, name: ${n})`),t=mt(t);const i="edit"===window.CodePadGlobals.mode;this.index=e,this.canMove=i,this.canRename=i,this.children=[],this.data={basePath:t,name:n,get fullPath(){return this.basePath?this.basePath+"/"+this.name:this.name}}}}class Ct extends wt{constructor(){super(ht,"",""),this.isFolder=!0,this.canMove=!1,this.canRename=!1,this.data.loading=new bt(bt.LOADED)}}class Tt extends wt{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(ft(),e,t),this.isFolder=!1,this.data.isCreating=!1,this.data.syncing=new gt,this.data.isManualMainFile=n,this.data.isRunning=!1,this.data.style={color:null,bold:!1,markerData:[]};let i=yt(this.data.name),a=this.data.name;Object.defineProperty(this.data,"icon",{get:()=>(a!=this.data.name&&(i=yt(this.data.name),a=this.data.name),i)})}}class It extends wt{constructor(e,t){super(ft(),e,t),this.isFolder=!0,this.data.isCreating=!1,this.data.loading=new bt}}class St{constructor(e){this.data={[ht]:new Ct},this.naturalMainFileId=null,this.manualMainFileId=null,this.runningFile=null,this.changeListeners=[],this.reloadingFilesListeners=[],this.preemptiveOperations=[],i.registerEventHandler("FILE_SYSTEM:REMOVED",(e=>{e=mt(e);const t=this.preemptiveOperations.findIndex((t=>t.old===e&&!t.new));if(t>=0)return void this.preemptiveOperations.splice(t,1);const n=this.getItemFromPath(e);if(n){const e=this.getItemFromPath(n.data.basePath);this.executeDeleteItem(e,n),this._resaveMainFile()}})),i.registerEventHandler("FILE_SYSTEM:ADDED",((e,t)=>{e=mt(e);const n=this.getItemFromPath(e),i=this.preemptiveOperations.findIndex((t=>!t.old&&t.new===e));if(i>=0)return n.isFolder||(n.data.syncing.state=gt.DORMANT),void this.preemptiveOperations.splice(i,1);const a=e.lastIndexOf("/");let s="";a>=0&&(s=e.substring(0,a));const o=this.getItemFromPath(s);o&&o.isFolder&&o.data.loading.state==bt.LOADED&&(n?console.error(`Trying to add item(${e}) but it already exists!`):this.injectItems(this.data[ht],[{path:e,isDir:t}]))})),i.registerEventHandler("FILE_SYSTEM:RENAMED",((e,t,n)=>{e=mt(e),t=mt(t);const i=this.preemptiveOperations.findIndex((n=>n.old===e&&n.new===t)),a=this.getItemFromPath(t);if(i>=0)return a.isFolder||(a.data.syncing.state=gt.DORMANT),void this.preemptiveOperations.splice(i,1);const s=this.getItemFromPath(e),o=t.lastIndexOf("/");let l=this.data[ht],r=t;if(o>=0&&(l=this.getItemFromPath(t.substring(0,o)),r=t.substring(o+1)),l&&!l.isFolder)return void console.error("Moving into path='"+l.data.fullPath+"' but it's not a folder!");const d=l&&l.data.loading.state==bt.LOADED;if(s){const e=this.getItemFromPath(s.data.basePath);d?(a&&this.executeDeleteItem(l,a),this.executeMoveItem(e,l,s),this.executeRename(s,r),this._resaveMainFile()):(this.executeDeleteItem(e,s),this.loadAllParents(t).then((e=>{const t=this.getItemFromPath(r,e[e.length-1]);if(t){t.data.isManualMainFile=s.data.isManualMainFile,t.data.isRunning=s.data.isRunning,t.data.style=s.data.style,this.manualMainFileId==s.index&&(this.manualMainFileId=t.index),this.naturalMainFileId==s.index&&(this.naturalMainFileId=t.index),this.runningFile==s.index&&(this.runningFile=t.index);for(const e of this.changeListeners)e([t.index])}this._resaveMainFile()})))}else d&&this.injectItems(l,[{path:r,isDir:n}])}));let t=!0;this.injectItems(this.data[ht],e),i.registerConnectHandler((()=>{if(t)return void(t=!1);const e=[];for(const t of this.reloadingFilesListeners)e.push(t());this.setNaturalMainFile(null),this.setManualMainFile(null),this.runningFile=null;const n={};n[ht]=this.data[ht],n[ht].children=[],this.data=n,this.preemptiveOperations=[],at().then((t=>{this.injectItems(this.data[ht],t[""]);for(const e of this.changeListeners)e([ht]);for(const t of e)t()}))}))}onReloadFiles(e){return this.reloadingFilesListeners.push(e),{dispose:()=>{const t=this.reloadingFilesListeners.indexOf(e);t>=0&&this.reloadingFilesListeners.splice(t,1)}}}onDidChangeTreeData(e){return this.changeListeners.push(e),{dispose:()=>{const t=this.changeListeners.indexOf(e);t>=0&&this.changeListeners.splice(t,1)}}}getTreeItem(e){return this.getTreeItems([e])[0]}getTreeItems(e){const t=[],n={};for(const i of e)if(i in this.data){const e=this.data[i];t.push(e),e.isFolder&&e.data.loading.state==bt.UNLOADED&&(e.data.loading.state=bt.LOADING,n[e.data.fullPath]=e)}return Object.keys(n).length>0&&at(Object.keys(n)).then((e=>{for(const[t,i]of Object.entries(n))i.data.loading.state=bt.LOADED,this.injectItems(i,e[t])})),t}onRenameItem(e,t){if(e.data.isCreating){e.data.isCreating=!1,this.executeRename(e,t);const n=this._nextAvailableFileName(e);this.executeRename(e,n);const i=e.data.fullPath,a={old:null,new:i};this.preemptiveOperations.push(a),e.isFolder||(e.data.syncing.state=gt.SYNCING),async function(e,t){const n=await fetch("/api/vfs/"+(t?"mkdir":"mkfile"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({projectId:window.CodePadGlobals.projectData.id,file:e})});if(!n.ok){const i=await n.text();return alert("Failed to create "+(t?"folder: ":"file: ")+e+"\n"+i),!1}return 201==n.status}(i,e.isFolder).then((t=>{if(!t){const t=this.preemptiveOperations.indexOf(a);t>=0&&this.preemptiveOperations.splice(t,1),e.isFolder||(e.data.syncing.state=gt.DORMANT);const n=this.getItemFromPath(e.data.basePath);this.executeDeleteItem(n,e)}}))}else if(e.data.name!=t){const n=e.data.fullPath;this.executeRename(e,t);const i=this._nextAvailableFileName(e);this.executeRename(e,i);const a=e.data.fullPath;this.preemptiveOperations.push({old:n,new:a}),e.isFolder||(e.data.syncing.state=gt.SYNCING),rt(n,a),this._resaveMainFile()}}onChangeItemChildren(){}onDropItem(e,t){let n=this.data[ht],i=null;"item"===t.targetType?n=this.data[t.targetItem]:"between-items"===t.targetType&&(n=this.data[t.parentItem],i=t.childIndex),null==i&&(i=n.children.length);for(let t=e.length-1;t>=0;t--){const a=e[t];if(!a.canMove)continue;const s=this.getItemFromPath(a.data.basePath);if(s===n){const e=s.children.findIndex((e=>e==a.index));e<i&&i--,s.children.splice(e,1),s.children.splice(i,0,a.index)}else{const e=a.data.fullPath;this.executeMoveItem(s,n,a,i);let t=this._nextAvailableFileName(a);this.executeRename(a,t);const o=a.data.fullPath;this.preemptiveOperations.push({old:e,new:o}),a.isFolder||(a.data.syncing.state=gt.SYNCING),rt(e,o)}}this._resaveMainFile()}onDuplicateItems(e){for(const t of e)dt(t.data.fullPath)}onDeleteItems(e){for(const t of e){const e=this.getItemFromPath(t.data.basePath);e&&(this.preemptiveOperations.push({old:t.data.fullPath,new:null}),this.executeDeleteItem(e,t),ct(t.data.fullPath))}this._resaveMainFile()}onCreateItem(e,t){t||(t=this.data[ht]);let n=null;n=e?new It(t.data.fullPath,"New Folder"):new Tt(t.data.fullPath,"New File"),n.data.isCreating=!0,t.children.push(n.index),this.data[n.index]=n;for(const e of this.changeListeners)e([t.index]);return n}modifyFileStyle(e,t){const n=this.getItemFromPath(e);if(n&&!n.isFolder){n.data.style={...n.data.style,...t};for(const e of this.changeListeners)e([n.index])}}executeDeleteItem(e,t){const n=t.index,i=[n];for(;i.length>0;){const e=i.pop();i.push(...this.data[e].children),delete this.data[e]}const a=e.children.indexOf(n);a>=0&&e.children.splice(a,1);for(const t of this.changeListeners)t([e.index])}executeMoveItem(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(e===t)return;e.children=e.children.filter((e=>e!=n.index)),null!=i?t.children.splice(i,0,n.index):t.children.push(n.index);const a=n.data.fullPath;n.data.basePath=t.data.fullPath;const s=n.data.fullPath;this._updateChildrenBasePath(a,s,n);for(const n of this.changeListeners)n([e.index,t.index])}executeRename(e,t){if(e.data.name===t)return;const n=e.data.fullPath;e.data.name=t;const i=e.data.fullPath;this._updateChildrenBasePath(n,i,e);for(const t of this.changeListeners)t([e.index])}_resaveMainFile(){this.naturalMainFileId in this.data||this.setNaturalMainFile(null),this.manualMainFileId in this.data||this.setManualMainFile(null),this.manualMainFileId?lt(this.data[this.manualMainFileId].data.fullPath,!0):this.naturalMainFileId?lt(this.data[this.naturalMainFileId].data.fullPath,!1):lt("",!1)}_updateChildrenBasePath(e,t,n){if(n.isFolder)for(const i of n.children){const n=this.data[i];n.data.basePath=n.data.basePath.replace(e,t),this._updateChildrenBasePath(e,t,n)}}_nextAvailableFileName(e){const t=this.getItemFromPath(e.data.basePath),n=n=>t.children.some((t=>t!=e.index&&this.data[t].data.name==n));let i=(0,we.uQ)(e.data.name);i&&(i="."+i);let a=e.data.name;for(i&&(a=a.slice(0,a.length-i.length));n(a+i);){let e=a;const t=e.match(/\d+$/);if(null==t)e+="2";else{const n=parseInt(t[0]);n>=100?e+="-2":e=e.slice(0,t.index)+(n+1)}a=e}return a+i}injectItems(e,t){if(e&&e.isFolder){for(const n of t){const t=mt(n.path);let i=e;if(this.getItemFromPath(t,i)){console.error(`Trying to inject "${t}" from base item "${i.data.fullPath}" but it already exists!`);continue}const a=t.split("/");let s="";for(const[o,l]of Object.entries(a)){const r=n.isDir||o<a.length-1,d=this.getItemFromPath(l,i);if(d){if(d.isFolder!==r){console.error(`Injecting item path="${t}", expected file/folder but not found!`);break}i=d}else{let t=null;t=r?new It(e.data.fullPath+"/"+s,l):new Tt(e.data.fullPath+"/"+s,l),i.children.push(t.index),this.data[t.index]=t,i=t}s?s+="/"+l:s=l}}for(const t of this.changeListeners)t([e.index])}else console.error(`Base path="${e.data.fullPath}" of injected data is not a valid folder!`)}setNaturalMainFile(e){if(e!=this.naturalMainFileId){if(!this.manualMainFileId){let t="";e&&(t=this.data[e].data.fullPath),lt(t,!1)}this.naturalMainFileId=e}}setManualMainFile(e){if(e==this.manualMainFileId)return;const t=[];if(this.manualMainFileId&&this.manualMainFileId in this.data&&(this.data[this.manualMainFileId].data.isManualMainFile=!1,t.push(this.manualMainFileId)),e)this.data[e].data.isManualMainFile=!0,t.push(e),lt(this.data[e].data.fullPath,!0);else{let e="";this.naturalMainFileId&&this.naturalMainFileId in this.data&&(e=this.data[this.naturalMainFileId].data.fullPath),lt(e,!1)}this.manualMainFileId=e;for(const e of this.changeListeners)e(t)}setRunningFile(e){let t=null;if(e&&(t=this.getItemFromPath(e)?.index),t===this.runningFile)return;const n=[];this.runningFile&&this.runningFile in this.data&&(this.data[this.runningFile].data.isRunning=!1,n.push(this.runningFile),this.runningFile=null),t&&(this.data[t].data.isRunning=!0,n.push(t),this.runningFile=t);for(const e of this.changeListeners)e(n)}getMainFile(){return this.manualMainFileId?this.data[this.manualMainFileId]:this.naturalMainFileId?this.data[this.naturalMainFileId]:null}getItemFromPath(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t=t||this.data[ht],!(e=mt(e)))return t;const n=e.split("/");let i=0,a=t;for(;i<n.length;){let t=null;for(const s of a.children)if(this.data[s].data.name===n[i]){if(i<n.length-1&&!this.data[s].isFolder)return console.error(`Searching for item with path="${e}" but intermediate item was not folder!`),null;t=this.data[s];break}if(!t)return null;a=t,i++}return a}async loadAllParents(e){e=mt(e);const t=this.getItemFromPath(e);let n,i={};if(t)n=t.data.basePath.split("/");else{if(i=await async function(e){let t=`/api/vfs/list_until/${window.CodePadGlobals.projectData.id}/${e}`;const n=await fetch(t);if(!n.ok){if(404!=n.status){const t=await n.text();alert("Failed to load content of dirs! Searching for path: "+e+"\n"+t)}return null}return await n.json()}(e),!i)return null;n=Object.keys(i).sort(((e,t)=>e.length-t.length)).map((e=>{const t=e.lastIndexOf("/");return t>=0?e.substring(t+1):e}))}let a=this.data[ht];const s=[];for(const t of n){const n=this.getItemFromPath(t,a);if(!n||!n.isFolder)return console.error("Trying to load all parents for path="+e+" but could not find dir="+t),null;const o=n.data.fullPath;n.data.loading.state===bt.UNLOADED&&o in i?(n.data.loading.state=bt.LOADED,this.injectItems(n,i[o])):n.data.loading.state===bt.LOADING&&await n.data.loading.whenLoaded(),s.push(n),a=n}return s}}var Dt=n(67241);class Pt extends Dt.y{constructor(){super({canInvokePrimaryActionOnItemContainer:!1})}createInteractiveElementProps(e,t,n,i){const a=super.createInteractiveElementProps(e,t,n,i);return a.onDoubleClick=()=>{n.focusItem(),n.selectItem(),e.isFolder&&n.toggleExpandedState()},a}}function Nt(){return Nt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Nt.apply(null,arguments)}const xt=(0,w.memo)((function({data:e}){const[t,n]=(0,w.useState)(!1),[i,a]=(0,w.useState)({x:0,y:0}),s=(0,w.useRef)(null),o=(0,w.useRef)(null),l=()=>{n(!0)},r=()=>{n(!1)};(0,w.useLayoutEffect)((()=>{if(s.current&&o.current){const e=s.current.getBoundingClientRect(),t=o.current.getBoundingClientRect();a({x:e.x-2,y:Math.max(0,e.y-(t.bottom-t.top)-4)})}}),[t]);let d=null;if(e.length<=2){const t=e.map(((e,t)=>{let n="none";return e.username&&(n=e.username),w.createElement("img",{key:e.id,src:`/profilepic/${n}?`,alt:e.username||"Anonymous",style:{position:"relative",borderRadius:"50%",transform:`translateX(${-70*t}%)`,border:`#${e.color} 2px solid`,width:"calc(var(--rct-item-height) * 0.9)",height:"calc(var(--rct-item-height) * 0.9)"}})}));d=w.createElement("div",{className:"profile-pic-holder",style:{width:`calc(var(--rct-item-height) * (0.9 + ${e.length-1} * 0.27))`},onMouseEnter:l,onMouseLeave:r,ref:s},t)}else d=w.createElement("div",{className:"profile-pic-holder",style:{width:"var(--rct-item-height)"},onMouseEnter:l,onMouseLeave:r,ref:s},w.createElement("div",{className:"number-circle border-2"},e.length));const c=e.map((e=>e.username?w.createElement("a",{key:e.id,className:"peer-popup-profile hoverable",href:"/user/"+e.username,rel:"noreferrer",target:"_blank"},w.createElement("img",{className:"peer-popup-picture",src:"/profilepic/"+e.username,alt:e.username,style:{border:`#${e.color} 2px solid`}}),w.createElement("div",{className:"peer-popup-name"},e.username)):w.createElement("div",{key:e.id,className:"peer-popup-profile hoverable"},w.createElement("img",{className:"peer-popup-picture",src:"/profilepic/none",alt:"Anonymous",style:{border:`#${e.color} 2px solid`}}),w.createElement("div",{className:"peer-popup-name"},"Anonymous"))));return w.createElement(w.Fragment,null,w.createElement("div",{className:"peer-popup-outer "+(t?"":"peer-popup-outer-hidden"),style:{top:i.y+"px",left:i.x+"px"},ref:o,onMouseEnter:l,onMouseLeave:r},w.createElement("div",{className:"peer-popup"},c)),d)})),Mt=(0,w.memo)((function({item:e,depth:t,children:n,title:i,context:a,arrow:s,mouseEnter:o,mouseLeave:l,clickedOptions:r,onDropFiles:d}){const c=a.isRenaming?"div":"button",u=a.isRenaming?void 0:"button",[h,m]=(0,w.useState)(!1),p=(0,w.useRef)(null),f=t=>`rct-tree-${t} `+(e.isFolder?`rct-tree-${t}-isFolder `:"")+(a.isSelected?`rct-tree-${t}-selected `:"")+(a.isExpanded?`rct-tree-${t}-expanded `:"")+(a.isFocused?`rct-tree-${t}-focused `:"")+(a.isDraggingOver?`rct-tree-${t}-dragging-over `:"")+(a.isSearchMatching?`rct-tree-${t}-search-match `:"");let g=null;!e.isFolder&&e.data.isManualMainFile&&(g=w.createElement("span",{className:"fe-manual-main-file-marker"},w.createElement("svg",{viewBox:"0 0 14 26",xmlns:"http://www.w3.org/2000/svg"},w.createElement("path",{d:"m0,0 v26 h7 L14,13 L7,0"}))));let b=null;b=e.isFolder?a.isExpanded?w.createElement("span",{className:"fe-item-icon fa-regular fa-folder-open"}):w.createElement("span",{className:"fe-item-icon fa-regular fa-folder-closed"}):e.data.icon.isUrl?w.createElement("img",{className:"fe-item-icon",src:e.data.icon.value,alt:"file icon"}):w.createElement("span",{className:"fe-item-icon "+e.data.icon.value});let v=null;a.isRenaming||(v=w.createElement("button",{className:"rct-tree-item-inline-btn fe-item-options",onClick:r,title:"More options"},w.createElement("i",{className:"fa-solid fa-ellipsis-vertical"})));let E=null;return!e.isFolder&&e.data.style.markerData.length>0&&(E=w.createElement(xt,{data:e.data.style.markerData})),w.createElement("li",Nt({},a.itemContainerWithChildrenProps,{className:f("item-li")+(h?"item-drop-possible":""),onDragEnter:t=>{t.preventDefault(),e.isFolder&&t.target.closest(".rct-tree-item-li-isFolder")==p.current&&t.dataTransfer.types.includes("Files")&&(a.expandItem(),m(!0))},onDragLeave:t=>{t.preventDefault(),e.isFolder&&h&&t.relatedTarget.closest(".rct-tree-item-li-isFolder")!=p.current&&m(!1)},onDragOver:e=>{e.preventDefault(),h&&(e.dataTransfer.dropEffect="copy")},onDrop:t=>{t.preventDefault(),e.isFolder&&h&&(m(!1),d(t.dataTransfer.items))},ref:p}),g,E,w.createElement("div",Nt({},a.itemContainerWithoutChildrenProps,{style:{"--depthOffset":20*t+"px"},className:f("item-title-container")+(!e.isFolder&&e.data.isRunning?"fe-running-file-bg":""),onMouseEnter:o,onMouseLeave:l}),s,w.createElement(c,Nt({type:u},a.interactiveElementProps,{className:f("item-button")}),b,i),v),n)})),Ft=(0,w.memo)((function({title:e,item:t}){let n="span";const i={};return t.isFolder||(t.data.style.color&&(i.color=t.data.style.color),t.data.style.bold&&(n="b")),w.createElement(n,{style:i},e)})),At=(0,w.memo)((function({item:e,context:t}){let n=["rct-tree-item-inline-btn","tree-arrow"];e.isFolder&&n.push("rct-tree-item-inline-btn-isFolder"),t.isExpanded&&n.push("tree-arrow-expanded");let i=null;return e.isFolder&&(i=w.createElement("svg",{viewBox:"0 0 16 16",role:"img"},w.createElement("path",{d:"M10.71 7.29l-4-4a1.003 1.003 0 00-1.42 1.42L8.59 8 5.3 11.29c-.19.18-.3.43-.3.71a1.003 1.003 0 001.71.71l4-4c.18-.18.29-.43.29-.71 0-.28-.11-.53-.29-.71z",fillRule:"evenodd"}))),w.createElement("button",{className:n.join(" "),onClick:()=>{e.isFolder&&t.toggleExpandedState()}},i)})),Ot=(0,w.memo)((function({onAbort:e,inputProps:t,inputRef:n,submitButtonProps:i,submitButtonRef:a,formProps:s}){return w.createElement("form",Nt({},s,{onSubmit:t=>{t.target[0].value.trim()?s.onSubmit&&s.onSubmit(t):(t.preventDefault(),e())},className:"rct-tree-item-renaming-form"}),w.createElement("input",Nt({},t,{defaultValue:t.value,value:void 0,onChange:e=>{t.onChange&&t.onChange({target:{value:e.target.value.trim()}})},onBlur:e=>{e.relatedTarget&&e.relatedTarget===a.current||e.currentTarget.form.requestSubmit()},ref:n,className:"rct-tree-item-renaming-input"})),w.createElement("input",Nt({},i,{onClick:e=>{e.currentTarget.form.requestSubmit()},ref:a,type:"submit",className:"rct-tree-item-renaming-submit-button",value:"ðŸ—¸"})))})),kt=Object.freeze({NONE:0,MORE_OPTIONS_BTN:1,PAD:2,ITEM:3,RUNNABLE_ITEM:4,MAIN_FILE:5}),Lt=(0,w.memo)((function({target:e,isManualMainFile:t,onClose:n,position:a,onAddFile:s,onAddFolder:o,onDuplicateItem:l,onDuplicatePad:r,onDownloadItem:d,onDownloadPad:c,onRename:u,onDelete:h,onRunFile:m,onSetMainFile:p}){const[f,g]=(0,w.useState)(!1),[b,v]=(0,w.useState)(0),E=(0,w.useRef)(null),C=(0,w.useRef)(null),T=e=>e?{display:"block"}:{display:"none"};(0,w.useEffect)((()=>{const e=()=>{n()};return document.addEventListener("contextmenu",e),document.addEventListener("click",e),()=>{document.removeEventListener("contextmenu",e),document.removeEventListener("click",e)}}),[n]),(0,w.useLayoutEffect)((()=>{const e=()=>{g(!0)};i.registerReadyHandler(e);const t=()=>{g(!1)};return i.registerDisconnectHandler(t),()=>{i.removeReadyHandler(e),i.removeDisconnectHandler(t)}}),[]),(0,w.useEffect)((()=>{C.current&&(f?(C.current.hide(),C.current.disable()):C.current.enable())}),[f]),(0,w.useLayoutEffect)((()=>{if(E.current){const e=E.current.getBoundingClientRect();v(e.height)}}),[a]);let I=null;return"edit"===window.CodePadGlobals.mode&&(I=w.createElement(w.Fragment,null,w.createElement("button",{className:"dropdown-item",style:{...T(e>=kt.PAD)},onClick:s},w.createElement("span",{className:"fe-context-menu-icon"},w.createElement("i",{className:"fa-solid fa-file"}),w.createElement("span",{style:{paddingLeft:"1px"}},"+")),"Add file"),w.createElement("button",{className:"dropdown-item",style:{...T(e>=kt.PAD)},onClick:o},w.createElement("span",{className:"fe-context-menu-icon"},w.createElement("i",{className:"fa-solid fa-folder"}),w.createElement("span",{style:{paddingLeft:"1px"}},"+")),"Add folder"),w.createElement("div",{className:"dropdown-divider",style:T(e>=kt.PAD)}),w.createElement("button",{className:"dropdown-item",style:{...T(e>=kt.ITEM)},onClick:l},w.createElement("span",{className:"fe-context-menu-icon"},w.createElement("i",{className:"fa-solid fa-copy"})),"Duplicate"),w.createElement("button",{className:"dropdown-item",style:{...T(e<=kt.PAD)},onClick:r},w.createElement("span",{className:"fe-context-menu-icon"},w.createElement("i",{className:"fa-solid fa-copy"})),"Duplicate pad"),w.createElement("button",{className:"dropdown-item",style:{...T(e>=kt.ITEM)},onClick:d},w.createElement("span",{className:"fe-context-menu-icon"},w.createElement("i",{className:"fa-solid fa-arrow-down-long"})),"Download"),w.createElement("button",{className:"dropdown-item",style:{...T(e<=kt.PAD)},onClick:c},w.createElement("span",{className:"fe-context-menu-icon"},w.createElement("i",{className:"fa-solid fa-arrow-down-long"})),"Download pad"),w.createElement("div",{className:"dropdown-divider",style:T(e>=kt.ITEM)}),w.createElement("button",{className:"dropdown-item",style:{...T(e>=kt.ITEM)},onClick:u},w.createElement("span",{className:"fe-context-menu-icon"}),"Rename"),w.createElement("button",{className:"dropdown-item text-danger",style:{...T(e>=kt.ITEM)},onClick:h},w.createElement("span",{className:"fe-context-menu-icon"},w.createElement("i",{className:"fa-solid fa-trash"})),"Delete"),w.createElement("div",{className:"dropdown-divider",style:T(e>=kt.RUNNABLE_ITEM)}))),!I&&e<kt.MAIN_FILE?null:w.createElement("div",{className:"dropdown-menu dropdown-menu-sm fe-context-menu",style:{display:"block",position:"fixed",top:Math.min(a.y,window.innerHeight-b-2)+"px",left:a.x+"px"},onContextMenu:e=>{e.preventDefault(),e.stopPropagation()},ref:E},I,w.createElement(y.O2,{tag:"div",title:"Not connected to server","data-bs-toggle":"tooltip","data-bs-placement":"right","data-bs-boundary":"window",ref:C},w.createElement("button",{className:"dropdown-item",style:{...T(e>=kt.RUNNABLE_ITEM)},onClick:m,disabled:!f},w.createElement("span",{className:"fe-context-menu-icon"},w.createElement("i",{className:"fa-solid fa-play"})),"Run File")),w.createElement("button",{className:"dropdown-item",style:{...T(e>=kt.MAIN_FILE)},onClick:p},w.createElement("span",{className:"fe-context-menu-icon"}),t?"Clear Main File":"Set Main File"))}));var Rt=n(23224);let _t=[],$t=0,jt=null,Gt=null;function Ht(){0==$("#upload-dialog").length&&(_t=[],$t=0,jt=null,Gt=null,$(document.body).append('\n<div class="modal fade" id="upload-dialog" tabindex="-1" role="dialog" aria-labelledby="uploader-title" aria-hidden="true">\n    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">\n        <div class="modal-content" id="item-uploader-draggable">\n            <div id="upload-dialog-background" class="w-100 h-100" style="position: absolute; z-index: -3;"></div>\n            <div class="modal-header">\n                <h4 id="uploader-title" class="modal-title">Upload Items</h4>\n                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n            </div>\n            <form action="/api/vfs/upload" method="POST" enctype="multipart/form-data" id="upload-form">\n                <div class="modal-body text-center" id="upload-dialog-body">\n                    <input type="file" id="file-to-load" style="display: none" multiple>\n                    <input type="file" id="folder-to-load" style="display: none" webkitdirectory mozdirectory msdirectory odirectory directory>\n                    <div style="display: inline-block; width: 85%;">\n                        <a id="clear-item-uploader" class="float-end link-underline-opacity-0 link-underline-opacity-0-hover" href="javascript:">Clear</a>\n                    </div>\n                    <div class="border border-bottom-0 mx-auto mb-3" style="width: 85%;">\n                        <div id="item-uploader-list" class="border-bottom"></div>\n                        <div class="border-bottom p-2 d-flex justify-content-center align-items-center gap-3">\n                            <button id="item-uploader-add-file" class="btn btn-transparent" onclick="$(\'#file-to-load\').click()" type="button"><i class="fa-solid fa-plus"></i> Add Files</button>\n                            <button id="item-uploader-add-folder" class="btn btn-transparent" onclick="$(\'#folder-to-load\').click()" type="button"><i class="fa-solid fa-plus"></i> Add Folder</button>\n                        </div>\n                    </div>\n                    <div class="form-check form-switch d-flex justify-content-center gap-2">\n                        <input type="checkbox" role="switch" class="form-check-input" id="item-uploader-overwrite-files" checked>\n                        <label class="form-check-label" for="item-uploader-overwrite-files">Overwrite existing files</label>\n                    </div>    \n                </div>\n                <div class="modal-footer justify-content-center">\n                    <button id="item-uploader-submit" class="btn btn-primary" id="openbtn" type="submit">Done</button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>'),$("#upload-form").submit((e=>{e.stopPropagation(),e.preventDefault(),0!==_t.length&&0===$t?($("#clear-item-uploader").css("visibility","hidden"),$("#item-uploader-submit").text("Done"),$("#item-uploader-add-file").addClass("upload-button-disabled"),$("#item-uploader-add-folder").addClass("upload-button-disabled"),$("#item-uploader-overwrite-files").attr("disabled",!0),Yt(_t,"")):bootstrap.Modal.getOrCreateInstance("#upload-dialog").hide()})),$("#clear-item-uploader").click((()=>{Bt()})),$("#item-uploader-draggable").on("dragover",(e=>{!function(e){e.preventDefault(),e.dataTransfer.types.includes("Files")&&(e.dataTransfer.dropEffect="copy")}(e.originalEvent)})),$("#item-uploader-draggable").on("drop",(e=>{!function(e){e.preventDefault(),Gt=null,$("#upload-dialog-background").removeClass("item-drop-possible"),Wt(e.dataTransfer.items)}(e.originalEvent)})),$("#item-uploader-draggable").on("dragenter",(e=>{!function(e){!Gt&&e.dataTransfer.types.includes("Files")&&$("#upload-dialog-background").addClass("item-drop-possible"),Gt=e.target}(e.originalEvent)})),$("#item-uploader-draggable").on("dragleave",(e=>{!function(e){e.target===Gt&&($("#upload-dialog-background").removeClass("item-drop-possible"),Gt=null)}(e.originalEvent)})),$("#file-to-load").change((()=>{!function(){0==_t.length&&($("#clear-item-uploader").css("visibility",""),$("#item-uploader-submit").text("Upload"));for(const e of $("#file-to-load")[0].files)_t.push(e),Jt(e,"#item-uploader-list",_t.length-1);$("#file-to-load").val("")}()})),$("#folder-to-load").change((()=>{!function(){if($("#folder-to-load")[0].files.length>0){let e=$("#folder-to-load")[0].files;if(e.length>0){0==_t.length&&($("#clear-item-uploader").css("visibility",""),$("#item-uploader-submit").text("Upload"));const t=e[0].webkitRelativePath.split("/")[0];e=Vt(t,Array.from(e),"#item-uploader-list",_t.length),_t.push(e)}}$("#folder-to-load").val("")}()})))}function Ut(e,t){Ht(),bootstrap.Modal.getOrCreateInstance("#upload-dialog").show(),0===$t&&(Bt(),null==e&&(e=""),jt=e,jt?(jt.endsWith("/")||(jt+="/"),$("#uploader-title").html(`Upload Items to <b>${jt}</b>`)):$("#uploader-title").html("Upload Items"),null!=t&&Wt(t))}function Bt(){document.getElementById("item-uploader-overwrite-files").disabled=!1,$("#item-uploader-list").empty(),$("#item-uploader-add-file").removeClass("upload-button-disabled"),$("#item-uploader-add-folder").removeClass("upload-button-disabled"),$("#clear-item-uploader").css("visibility","hidden"),$("#item-uploader-submit").text("Done"),_t=[]}function Wt(e){for(let t of e)if(t="getAsEntry"in t?t.getAsEntry():t.webkitGetAsEntry(),t){const e=()=>{$("#item-uploader-list-placeholder").hide(),$("#clear-item-uploader").css("visibility",""),$("#item-uploader-submit").text("Upload")};if(t.isFile)t.file((t=>{0==_t.length&&e(),_t.push(t),Jt(t,"#item-uploader-list",_t.length-1)}));else if(t.isDirectory){const n=t.name;zt(t).then((t=>{t.length>0&&(0==_t.length&&e(),t=Vt(n,Array.from(t),"#item-uploader-list",_t.length),_t.push(t))}))}}}async function zt(e){const t=[];if(e.isFile){const n=await new Promise(((t,n)=>{e.file(t,n)}));n.realPath=e.fullPath,n.realPath.startsWith("/")&&(n.realPath=n.realPath.substring(1)),t.push(n)}else if(e.isDirectory){const n=e.createReader();let i=await new Promise(((e,t)=>{n.readEntries(e,t)}));for(;i.length>0;){for(const e of i)t.push(...await zt(e));i=await new Promise(((e,t)=>{n.readEntries(e,t)}))}}return t}function Vt(e,t,n,i){const a="folder-"+String(i).replaceAll(".","-"),s=e.split("/").pop(),o=$(`\n<div data-item-upload-address="${i}">\n    <div class="border-bottom item-uploader-item">\n        <div class="upload-progress-bar"></div>\n        <button class="ms-2 upload-item-button tree-arrow collapsed" type="button" data-bs-toggle="collapse" href="#${a}-expandable" aria-expanded="false" aria-controls="${a}-expandable">\n            <svg viewBox="0 0 16 16" role="img">\n                <path\n                    d="M10.71 7.29l-4-4a1.003 1.003 0 00-1.42 1.42L8.59 8 5.3 11.29c-.19.18-.3.43-.3.71a1.003 1.003 0 001.71.71l4-4c.18-.18.29-.43.29-.71 0-.28-.11-.53-.29-.71z"\n                    fillRule="evenodd"\n                ></path>\n            </svg>\n        </button>\n        <i class="fa-regular fa-folder-closed ms-1" style="width: 18px;"></i>\n        <span class="item-upload-name mx-2">${s}</span>\n        <button class="me-2 upload-item-button cancel-upload-button" type="button">\n            <i class="fa-regular fa-x text-danger"></i>\n        </button>\n    </div>\n    <div id="${a}-expandable" class="collapse" style="margin-left: 28px;"></div>\n</div>`);$(n).append(o),o.find(".cancel-upload-button").click((e=>{Kt(e.currentTarget.parentElement.parentElement)}));const l=o.find(".collapse")[0],r=o.find(".tree-arrow"),d=o.find(".fa-folder-closed");l.addEventListener("show.bs.collapse",(e=>{e.target===l&&(r.addClass("tree-arrow-expanded"),d.addClass("fa-folder-open").removeClass("fa-folder-closed"))})),l.addEventListener("hide.bs.collapse",(e=>{e.target===l&&(r.removeClass("tree-arrow-expanded"),d.removeClass("fa-folder-open").addClass("fa-folder-closed"))}));const c=[],u={};for(const n of t){const t=new RegExp("^("+e+"/)"),s=(n.realPath||n.webkitRelativePath).replace(t,"").split("/");if(s.length>1){const t=e+"/"+s[0];t in u?u[t].push(n):u[t]=[n]}else Jt(n,`#${a}-expandable`,i+"."+c.length),c.push(n)}for(const[e,t]of Object.entries(u))c.push(Vt(e,t,`#${a}-expandable`,i+"."+c.length));return c}function Jt(e,t,n){const i=$(`\n<div class="border-bottom item-uploader-item" data-item-upload-address="${n}">\n    <div class="upload-progress-bar"></div>\n    <button class="ms-2 upload-item-button invisible" type="button" disabled></button>\n    <span class="fa-regular fa-file ms-1"></span>\n    <span class="item-upload-name mx-2">${e.name}</span>\n    <button class="me-2 upload-item-button cancel-upload-button" type="button">\n        <span class="fa-regular fa-x text-danger"></span>\n    </button>\n</div>`);$(t).append(i),i.find(".cancel-upload-button").click((e=>{Kt(e.currentTarget.parentElement)}))}function Kt(e){let t=e.dataset.itemUploadAddress.split("."),n=_t;for(let e=0;e<t.length-1;e++)n=n[t[e]];let i=t[t.length-1];if(4!=n[i].readyState&&n[i].abort){n[i].abort(),$(e).find(".upload-progress-bar").css("background-color","rgba(237, 160, 87, 0.4)"),$(e).find(".upload-progress-bar").css("width","100%");const t=$(e).find(".item-upload-name");t.text(t.text().substring(0,t.text().length-12)+" - Canceled"),$(e).find(".cancel-upload-button").remove()}else n[i]=void 0,0===n.filter((e=>null!=e)).length?n===_t?Bt():Kt(e.parentElement.parentElement):e.remove()}function Yt(e,t){for(let n=0;n<e.length;n++)if(e[n])if(e[n]instanceof Array)$(`div[data-item-upload-address='${t+n}']>.item-uploader-item>.cancel-upload-button`).remove(),Yt(e[n],t+n+".");else{$t++;const i=$(`.item-uploader-item[data-item-upload-address='${t+n}']`),a=i.find(".item-upload-name");a.text(a.text()+" - Uploading");const s=i.find(".upload-progress-bar"),o=new FormData;o.append("projectId",window.CodePadGlobals.projectData.id),o.append("file",e[n]),o.append("overwrite",document.getElementById("item-uploader-overwrite-files").checked);let l=e[n].realPath||e[n].webkitRelativePath;""==l&&(l=e[n].name),o.append("path",jt+l);const r=$.ajax({method:"POST",url:"/api/vfs/upload",data:o,processData:!1,contentType:!1,xhr:function(){const e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",(function(e){e.lengthComputable&&s.css("width",e.loaded/e.total*100+"%")}),!1),e},success:function(){a.text(a.text().substring(0,a.text().length-12)+" - Uploaded"),i.find(".cancel-upload-button").remove(),$t--,0===$t&&($("#clear-item-uploader").css("visibility",""),_t=[])},error:function(e,t){"abort"!==t&&(s.css("width","100%"),s.css("background-color","rgba(var(--bs-danger-rgb), 0.3)"),i.find(".cancel-upload-button").remove(),413===e.status?a.text(a.text().substring(0,a.text().length-12)+" - File Too Large (20mb limit)"):a.text(a.text().substring(0,a.text().length-12)+" - Upload Failed")),$t--,0===$t&&($("#clear-item-uploader").css("visibility",""),_t=[])}});e[n]=r}}function qt(){return qt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},qt.apply(null,arguments)}const Xt="file-explorer",Zt=(0,w.memo)((function({dataProvider:e,initialFileState:t,canRunFile:n,onRunFile:i,onInitiateDelete:a,onClickFile:s}){const o=(0,w.useContext)(y.jq);(0,w.useEffect)((()=>{document.documentElement.style.setProperty("--editor-font-size",`${o.size}pt`)}),[o]);const[l,r]=(0,w.useState)({type:kt.NONE,item:null}),[d,c]=(0,w.useState)({x:0,y:0}),[u,h]=(0,w.useState)(!1),m=(0,w.useRef)(null),p=(0,w.useRef)(null),f=(0,w.useCallback)((()=>{if(p.current){const t=p.current.viewState[Xt].selectedItems;return e.getTreeItems(t)}return[]}),[e]),g=(0,w.useRef)(null),b=(0,w.useRef)(null),v=(e,t,i=!1)=>{let a=kt.PAD,s=null;i?a=kt.MORE_OPTIONS_BTN:g.current&&(s=g.current,a=kt.ITEM,s.isFolder||(n(s.data.fullPath)&&(a=kt.RUNNABLE_ITEM),Et(s.data.fullPath)&&(a=kt.MAIN_FILE))),r({type:a,item:s}),c({x:e,y:t})},E=(0,w.useCallback)((()=>{let e="",t=f();if(t.length>0){e=t[t.length-1].data.basePath;for(let n=t.length-1;n>=0;n--)if(t[n].isFolder){e=t[n].data.fullPath;break}}Ut(e)}),[f]),C=t=>{const n=t.filter((e=>!t.some((t=>!(e===t||!t.isFolder)&&e.data.fullPath.startsWith(t.data.fullPath+"/")))));!function(e,t){0==$("#delete-dialog").length&&$(document.body).append('\n<div class="modal fade" id="delete-dialog" tabindex="-1" role="dialog" aria-labelledby="delete-dialog-title" aria-hidden="true">\n    <div class="modal-dialog modal-dialog-centered" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h5 id="delete-dialog-title" class="modal-title">Delete File</h5>\n                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n            </div>\n            <div class="modal-body text-center">\n                Are you sure you want to permanently delete the following?\n                <div id="delete-dialog-items" class="mt-1">\n                </div>\n            </div>\n            <div class="modal-footer">\n                <button id="confirm-delete" type="button" class="btn btn-danger" data-bs-dismiss="modal">Delete</button>\n                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>\n            </div>\n        </div>\n    </div>\n</div>'),bootstrap.Modal.getOrCreateInstance("#delete-dialog").show(),$("#delete-dialog-items").empty();for(const t of e)$("#delete-dialog-items").append($(`<div><b>${t}</b></div>`));$("#confirm-delete").off("click"),$("#confirm-delete").click((()=>{t()}))}(n.map((e=>{let t=e.data.fullPath;return e.isFolder&&(t+="/"),t})),(()=>{a(n.map((e=>({path:e.data.fullPath,isDir:e.isFolder})))),e.onDeleteItems(n)}))},T=(t,n)=>{n&&(n.isFolder||(n=e.getItemFromPath(n.data.basePath)),m.current.expandItem(n.index));const i=e.onCreateItem(t,n);setTimeout((()=>{m.current.startRenamingItem(i.index)}),0)},I=t=>{if(t.data.isCreating){const n=e.getItemFromPath(t.data.basePath);e.executeDeleteItem(n,t)}};(0,w.useEffect)((()=>{const e=e=>{e.ctrlKey&&"keyo"==e.code.toLowerCase()&&"edit"===window.CodePadGlobals.mode&&(e.preventDefault(),e.stopPropagation(),E())};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[E]),(0,w.useEffect)((()=>{const t=e.onReloadFiles((()=>{const t=e.getMainFile(),n=t?t.data.fullPath:null,i=!!t&&t.data.isManualMainFile,a=f().map((e=>e.data.fullPath));return()=>{const t=[e.loadAllParents(n)];for(const n of a)t.push(e.loadAllParents(n));Promise.all(t).then((t=>{const s=new Set,o=[];if(t[0]){const t=e.getItemFromPath(n);i&&e.setManualMainFile(t.index),e.setNaturalMainFile(t.index)}for(let n=1;n<t.length;n++){const i=t[n];if(i){const t=e.getItemFromPath(a[n-1]);o.push(t.index);for(const e of i)s.add(e.index)}}m.current.selectItems(o),m.current.expandSubsequently(Array.from(s))}))}}));return()=>{t.dispose()}}),[e,f]),(0,w.useEffect)((()=>{const n=async(e,t)=>{const n=e.map((e=>e.index));p.current.expandSubsequently(Xt,n),p.current.selectItems([t.index],Xt)},i=(async()=>{const n=await e.loadAllParents(t.mainFile);if(n){const i=e.getItemFromPath(t.mainFile);return t.manualMainFile&&e.setManualMainFile(i.index),e.setNaturalMainFile(i.index),[n,i]}return null})();t.fileToLoadCandidate?e.loadAllParents(t.fileToLoadCandidate).then((a=>{if(a){const s=e.getItemFromPath(t.fileToLoadCandidate);n(a,s),i.then((()=>{Et(s.data.fullPath)&&e.setNaturalMainFile(s.index)}))}})):i.then((e=>{e&&n(e[0],e[1])}))}),[e,t]);let S=null;l.type!=kt.NONE&&(S=w.createElement(Lt,{target:l.type,isManualMainFile:l.item&&l.item.data.isManualMainFile,onClose:()=>{r({type:kt.NONE,item:null})},position:d,onAddFile:()=>{T(!1,l.item)},onAddFolder:()=>{T(!0,l.item)},onDuplicateItem:()=>{const t=f();t.length<=1?l.item&&e.onDuplicateItems([l.item]):e.onDuplicateItems(t)},onDuplicatePad:()=>{(0,Rt.z)(window.CodePadGlobals.projectData)},onDownloadItem:()=>{const e=f();e.length<=1?l.item&&ut([l.item]):ut(e)},onDownloadPad:()=>{ut()},onRename:()=>{l.item&&m.current.startRenamingItem(l.item.index)},onDelete:()=>{const e=f();e.length<=1?l.item&&C([l.item]):C(e)},onRunFile:()=>{l.item&&i(l.item.data.fullPath)},onSetMainFile:()=>{l.item&&(l.item.data.isManualMainFile?e.setManualMainFile(null):e.setManualMainFile(l.item.index))}}));let D=null;return"edit"===window.CodePadGlobals.mode&&(D=w.createElement("div",{className:"mt-1 btn-group btn-group-sm justify-content-center flex-wrap",role:"group","aria-label":"File explorer options"},w.createElement(y.O2,{tag:"button",className:"fe-top-btn btn btn-transparent","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-boundary":"window",title:"New file",onClick:()=>{const e=f();let t=null;e.length>0&&(t=e[e.length-1]),T(!1,t)}},w.createElement("i",{className:"fa-solid fa-file"}),"+"),w.createElement(y.O2,{tag:"button",className:"fe-top-btn btn btn-transparent","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-boundary":"window",title:"New folder",onClick:()=>{const e=f();let t=null;e.length>0&&(t=e[e.length-1]),T(!0,t)}},w.createElement("i",{className:"fa-solid fa-folder"}),"+"),w.createElement(y.O2,{tag:"button",className:"fe-top-btn btn btn-transparent","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-boundary":"window",title:"Upload",onClick:()=>{E()}},w.createElement("i",{className:"fa-solid fa-upload"})),w.createElement(y.O2,{tag:"button",className:"fe-top-btn btn btn-transparent","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-boundary":"window",title:"More options",onClick:e=>{e.stopPropagation(),v(e.clientX+3,e.clientY+3,!0)}},w.createElement("i",{className:"fa-solid fa-ellipsis-vertical"})))),w.createElement(w.Fragment,null,S,w.createElement("div",{className:"w-100 h-100 d-flex flex-column",onContextMenu:e=>{e.preventDefault(),e.stopPropagation(),v(e.clientX,e.clientY)},onKeyDown:e=>{if("delete"==e.code.toLowerCase()&&!m.current.isRenaming){e.preventDefault(),e.stopPropagation();const t=f();t.length>=1&&C(t)}},onDragEnter:e=>{e.preventDefault(),b.current.contains(e.target)&&!e.target.closest(".rct-tree-item-li-isFolder")&&e.dataTransfer.types.includes("Files")&&h(!0)},onDragLeave:e=>{if(e.preventDefault(),u){const t=e.relatedTarget.closest(".rct-tree-item-li-isFolder");b.current.contains(e.relatedTarget)&&!t||h(!1)}},onDragOver:e=>{e.preventDefault(),u&&(e.dataTransfer.dropEffect="copy")},onDrop:e=>{e.preventDefault(),u&&(h(!1),Ut("",e.dataTransfer.items))},tabIndex:-1,ref:b},D,w.createElement("div",{className:"overflow-auto flex-grow-1 "+(u?"item-drop-possible":"")},w.createElement(nt.h,{dataProvider:e,viewState:{[Xt]:{}},getItemTitle:e=>e.data.name,canDragAndDrop:!0,canDropOnFolder:!0,canDropBelowOpenFolders:!0,canDropOnNonFolder:!1,canReorderItems:!0,canSearch:!1,canRename:!0,onPrimaryAction:t=>{t.data.syncing.whenLoaded().then((()=>{Et(t.data.fullPath)&&e.setNaturalMainFile(t.index),s(t.data.fullPath)}))},onDrop:e.onDropItem.bind(e),onAbortRenamingItem:I,defaultInteractionMode:new Pt,renderDepthOffset:20,renderItem:e=>w.createElement(Mt,qt({},e,{mouseEnter:()=>{g.current=e.item},mouseLeave:()=>{e.item.index===g.current.index&&(g.current=null)},clickedOptions:e=>{e.stopPropagation(),v(e.clientX+3,e.clientY+3)},onDropFiles:t=>{e.item.isFolder&&Ut(e.item.data.fullPath,t)}})),renderItemTitle:e=>w.createElement(Ft,e),renderItemArrow:e=>w.createElement(At,e),renderRenameInput:e=>w.createElement(Ot,qt({},e,{onAbort:()=>{I(e.item),m.current.abortRenamingItem()}})),ref:p},w.createElement(it.P,{treeId:Xt,rootItem:ht,treeLabel:"File Explorer",ref:m})))))}));let Qt=null,en=null,tn=null;async function nn(e){return"dark"===e?(en||(en=(await n.e(4125).then(n.bind(n,74125))).default),en):(Qt||(Qt=(await n.e(1229).then(n.bind(n,11229))).default),Qt)}function an(e){return["Dark","Epic","Hacker Green","Midnight Coder","Ruby Blue","Spooky","SuperDark","PROgrammer"].includes(e)?"dark":"light"}var sn=n(5338),on=n(26779);function ln(e,t){const n={java:["java","class","html","sh"],python:["py","html","sh"],htmlmixed:["html","sh"],php:["php","html"],cpp:["cpp","html","sh"]};t&&t.config.customWebServer&&n.htmlmixed.push("js","jsx","java","class","py");const i=(0,we.uQ)(e),a=(0,we.hA)(e),s=n[window.CodePadGlobals.projectData.lang]??[],o={cpp:["Makefile","makefile"]}[window.CodePadGlobals.projectData.lang]??[];return s.includes(i)||o.includes(a)}Ie.bP.prototype.setEventListener=function(e,t,n=!0){n||void 0===this.listeners[e]?this.listeners[e]=[t]:this.listeners[e].push(t)},Ie.bP.prototype.removeEventListener=function(e,t){if(void 0!==this.listeners[e])if(t){const n=this.listeners[e].indexOf(t);-1!==n&&this.listeners[e].splice(n,1)}else this.listeners[e]=[]},Ie.bP.prototype.fireEvent=function(e,t){if(void 0!==this.listeners[e])for(const n of this.listeners[e])n(t)};const rn=(0,w.memo)((function({model:e,fileDataProvider:t,initialFileState:n,editorConfig:i,canRunFile:a,onRunFile:s,onInitiateDelete:o,onClickFile:l,onModelChange:r,getAppropriateTabManager:d}){const[c,u]=(0,w.useState)((()=>an(i.config.theme))),[h,m]=(0,w.useState)((()=>({family:i.config.fontFamily,size:i.config.fontSize}))),p=(0,w.useRef)(!1);return p.current||(p.current=!0,i.registerChangeHandler(((e,t)=>{if(e.theme!==t.theme&&(un(e.theme),u(an(e.theme))),e.fontFamily!==t.fontFamily||e.fontSize!==t.fontSize){const t={family:e.fontFamily,size:e.fontSize};m(t)}}))),w.createElement(y.Dx,{value:c},w.createElement(y.jq,{value:h},w.createElement(Ie.PE,{model:e,factory:e=>{if("files"===e.getComponent())return w.createElement(Zt,{dataProvider:t,initialFileState:n,canRunFile:a,onRunFile:s,onInitiateDelete:o,onClickFile:l});if("cody-chat"===e.getComponent())return w.createElement(H,null);if("live-chat"===e.getComponent())return w.createElement(te,{node:e});{let t=d(e.getComponent());if(t)return w.createElement(dn,{tabManager:t,node:e})}},onAction:t=>cn(e,d,t),onAuxMouseClick:(t,n)=>{!function(e,t,n){t.getType()===Ie.MZ.TYPE&&1===n.button&&t.isEnableClose()&&e.doActionWithIntercept(Ie.En.deleteTab(t.getId()))}(e,t,n)},onRenderTabSet:(e,t)=>{!function(e,t,n){if(t.getSelectedNode()){const i=e(t.getSelectedNode().getComponent());i&&n.stickyButtons.push(...i.getStickyButtons(t))}}(d,e,t)},onRenderTab:(e,t)=>{!function(e,t,n){if(t.getParent().getType()===Ie.ro.TYPE){const e=t.getName();if(t.getIcon().startsWith("fa-"))n.leading=w.createElement(y.O2,{tag:"span",title:e,"data-bs-toggle":"tooltip","data-bs-placement":"right"},w.createElement("i",{className:"border-icon "+t.getIcon(),style:{display:"none",fontSize:"24px"}}));else{let i=t.getIcon();n.leading=w.createElement(y.O2,{tag:"span",title:e,"data-bs-toggle":"tooltip","data-bs-placement":"right"},w.createElement("img",{className:"border-icon border-icon-hover-bw",width:28,src:i,style:{display:"none"}}))}n.content=null}else{n.leading=null;const i=e(t.getComponent());i&&(n.content=i.getComponentTitle(t))}}(d,e,t)},onModelChange:()=>{r()}})))}));function dn({tabManager:e,node:t}){return e.getComponent(t)}function cn(e,t,n){let i=null;if(n.type===Ie.En.SET_ACTIVE_TABSET?i=e.getNodeById(n.data.tabsetNode).getSelectedNode():n.type===Ie.En.DELETE_TAB?i=e.getNodeById(n.data.node):n.type===Ie.En.MOVE_NODE?e.getNodeById(n.data.fromNode).getType()===Ie.MZ.TYPE&&(i=e.getNodeById(n.data.fromNode)):n.type===Ie.En.SELECT_TAB?i=e.getNodeById(n.data.tabNode):n.type===Ie.En.MAXIMIZE_TOGGLE&&(i=e.getNodeById(n.data.node).getSelectedNode()),i){let a=t(i.getComponent());if(a)if(n.type===Ie.En.SET_ACTIVE_TABSET){if(!a.activateTab(i.getId()))return}else if(n.type===Ie.En.DELETE_TAB){if(!a.closingTab(i.getId()))return}else n.type===Ie.En.MOVE_NODE?setTimeout((()=>{a.activateTab(i.getId())}),0):n.type===Ie.En.SELECT_TAB&&a.activateTab(i.getId());if(n.type===Ie.En.MAXIMIZE_TOGGLE){const n=!i.getParent().isMaximized();let s=[],o=[];e.visitNodes((e=>{if(e.getType()===Ie.CU.TYPE&&e!==i.getParent()){const n=e.getSelectedNode(),i=t(n.getComponent());if(i){const e=s.indexOf(i);e>=0?o[e].push(n.getId()):(s.push(i),o.push([n.getId()]))}}})),setTimeout((()=>{let e=!1;for(let t=0;t<s.length;t++)a===s[t]?(e=!0,s[t].maximizeToggle(i.getId(),o[t],n)):s[t].maximizeToggle(null,o[t],n);e||a.maximizeToggle(i.getId(),[],n)}),0)}}return n}function un(e){const t=an(e);!async function(e){if(e!==tn){const t=await nn(e);tn&&(await nn(tn)).unuse(),t.use(),tn=e}}(t),"dark"===t?document.documentElement.setAttribute("data-bs-theme","dark"):document.documentElement.removeAttribute("data-bs-theme"),fetch("/api/school_admin/get_navbar_hue").then((e=>e.json())).then((e=>{(0,on.M)(e.navbarHue)})).catch((e=>{console.error("Failed to fetch navbar settings:",e)})),"Hacker Green"==e?($("#codepad-brand").css("font-family","monospace").addClass("lime-color"),$(".output-run-btn").filter(".btn-primary").removeClass("btn-primary").addClass("btn-success"),$(".output-run-btn").filter(".btn-outline-primary").removeClass("btn-outline-primary").addClass("btn-outline-success")):($("#codepad-brand").css("font-family","").removeClass("lime-color"),$(".output-run-btn").filter(".btn-success").removeClass("btn-success").addClass("btn-primary"),$(".output-run-btn").filter(".btn-outline-success").removeClass("btn-outline-success").addClass("btn-outline-primary")),"Meme"==e&&$("#codepad-brand").css("font-family",'"Comic Sans MS", comic')}var hn=n(62126),mn=n(9453),pn=n(35600),fn=n(18704);function gn(e,t){0==$("#delete-package-dialog").length&&$("body").append('\n<div class="modal fade" id="delete-package-dialog" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-dialog-centered" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h4 class="modal-title">Remove Python Package</h4>\n                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n            </div>\n            <div class="modal-body">\n                <p>Are you sure you want to remove <b id="package-name-bold"></b>? This will remove the package from your account and may affect other projects.</p>\n            </div>\n            <div class="modal-footer">\n                <button class="btn btn-danger" id="package-delete-button" data-bs-dismiss="modal">Remove</button>\n                <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>\n            </div>\n        </div>\n    </div>\n</div>'),bootstrap.Modal.getOrCreateInstance("#delete-package-dialog").show(),$("#package-name-bold").text(e),$("#package-delete-button").off("click"),$("#package-delete-button").click((function(){t()}))}function bn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";0===$("#notifications").length&&$("body").append('<div id="notifications" class="toast-container position-fixed top-0 end-0 p-3"></div>');const n=$(`\n<div class="toast align-items-center text-bg-${t}" role="alert" aria-live="assertive" aria-atomic="true">\n    <div class="d-flex">\n        <div class="toast-body">\n            ${e}\n        </div>\n        <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n    </div>\n</div>`);$("#notifications").append(n),new bootstrap.Toast(n[0],{delay:5e3}).show()}let vn=[];function En(){const e=document.getElementById("python-packages-list");if(e)if(0!==vn.length){e.innerHTML="";for(const t of vn){const n=$(`\n<div class="python-package-item" data-package-name="${t.packageName}">\n    <div class="python-package-info">\n        <div class="python-package-name">${wn(t.packageName)}</div>\n        <div class="python-package-version">${wn(t.packageVersion)}</div>\n    </div>\n    <div class="python-package-actions">\n        <button class="btn btn-danger btn-sm">\n            Remove\n        </button>\n    </div>\n</div>`);n.find("button").on("click",(()=>{var e,n,i;e=t.packageName,n=t.packageVersion,i=t.pythonVersion,gn(wn(e),(async()=>{try{const t=await fetch(`/api/accounts/python_packages/${encodeURIComponent(e)}/${encodeURIComponent(n)}/${encodeURIComponent(i)}`,{method:"DELETE"});if(vn=vn.filter((t=>t.packageName!==e)),En(),t.ok)bn("Python package removed successfully","success");else{bn(await t.text(),"danger")}}catch(e){console.error("Failed to remove Python package:",e),bn("Failed to remove package. Please try again.","danger")}}))})),e.appendChild(n[0])}}else e.innerHTML='<div class="python-packages-empty">Add packages below to make them available in your Python code.</div>'}async function yn(){const e=document.getElementById("add-python-package-btn"),t=document.getElementById("python-package-name"),n=document.getElementById("python-package-version");if(!e||!t||!n)return;let i=t.value.trim();const a=n.value.trim()||"latest";if(i=function(e){let t=e.toLowerCase();return t=t.replace(/[-_]+/g,"-"),t=t.replace(/^-+|-+$/g,""),t}(i),!/^[a-z0-9-]+$/.test(i)||0===i.length)return bn("Package name can only contain letters, numbers, and hyphens.","danger"),void t.focus();if(vn.some((e=>(e.packageName||e.name).toLowerCase()===i.toLowerCase())))return bn("This package has already been added","warning"),void t.focus();if("latest"!==a&&a&&!/^[a-zA-Z0-9._-]+$/.test(a))return bn("Invalid packet version format","danger"),void n.focus();e.disabled=!0,e.textContent="Adding...";try{const s=await fetch("/api/accounts/python_packages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({packageName:i,packageVersion:a})});if(s.ok){const i=await s.json();vn.push(i),En(),t.value="",n.value="",e.disabled=!0,bn("Python package added successfully","success")}else bn(await s.text(),"danger")}catch(e){console.error("Failed to add Python package:",e),bn("Failed to add package. Please try again.","danger")}finally{e.disabled=!1,e.textContent="Add Package"}}function wn(e){return e.replace(/[^a-zA-Z0-9._-]/g,"")}var Cn=n(45479);function Tn(){if(window.CodePadGlobals.projectData=new s.w(window.CodePadGlobals.projectData),"#remixmsg"==window.location.hash?(history.replaceState("",document.title,window.location.pathname+window.location.search),$("#remix-msg").show(),$("#remix-msg").fadeOut(4e3)):"#accessmsg"==window.location.hash?(history.replaceState("",document.title,window.location.pathname+window.location.search),$("#access-msg").show(),$("#access-msg").fadeOut(4e3)):"#submit"==window.location.hash?(history.replaceState("",document.title,window.location.pathname+window.location.search),$("#assignment-submit-msg").show(),$("#assignment-submit-msg").fadeOut(4e3)):"#unsubmit"==window.location.hash&&(history.replaceState("",document.title,window.location.pathname+window.location.search),$("#assignment-submit-msg-inner").text("Assignment unsubmitted!"),$("#assignment-submit-msg").show(),$("#assignment-submit-msg").fadeOut(4e3)),$("#open-new-project-dialog").click((()=>{window.CodePadGlobals.isOwner?(0,o.w)(window.CodePadGlobals.projectData.parentId):(0,o.w)()})),window.CodePadGlobals.projectData.registerDeleteHandler((()=>{"lesson"==window.CodePadGlobals.embeddedType?window.top.location.reload():"project"==window.CodePadGlobals.embeddedType?window.top.location.href="":location.href=""})),window.CodePadGlobals.assignmentData&&!window.CodePadGlobals.hasTeacherAccess){const e=window.CodePadGlobals.assignmentData.submissionTime;e&&new Date>new Date(e)&&($("#submit-assignment-btn").prop("disabled",!0),new bootstrap.Tooltip(document.getElementById("submit-assignment-outer"),{title:"Assignment submission time has passed",placement:"bottom"}),window.CodePadGlobals.assignmentStatus!==fn.I.SUBMITTED)&&new Cn.E("assignment-submission-time-passed","Submission Time Passed","<p>Assignment submission time has passed. You can keep working on it, but you won't be able to submit.</p>").show(),window.CodePadGlobals.assignmentStatus==fn.I.SUBMITTED&&($("#submit-assignment-btn").addClass("btn-secondary"),$("#submit-text").text("Unsubmit")),$("#submit-assignment-btn").click((()=>{const e=window.CodePadGlobals.assignmentStatus!==fn.I.SUBMITTED;(0,pn.G)({name:window.CodePadGlobals.assignmentData.name,id:window.CodePadGlobals.assignmentData.id},e,(()=>{window.location.hash=e?"submit":"unsubmit",window.location.reload()}))}))}if("edit"===window.CodePadGlobals.mode){$("#project-name").on("blur",(async()=>{let e=$("#project-name").val();""==e&&(e="Untitled");const t=new FormData;t.append("projectId",window.CodePadGlobals.projectData.id),t.append("newname",e);const n=await fetch("/api/projects/change_details",{method:"POST",body:t});if(n.ok)window.CodePadGlobals.projectData.name=e;else{const e=await n.text();alert(`Failed to rename project: ${n.status}\n${e}`)}})),window.CodePadGlobals.projectData.registerChangeHandler((e=>{"name"===e&&("Untitled"==window.CodePadGlobals.projectData.name?($("#project-name").val(""),document.title="Untitled pad - CodePad"):($("#project-name").val(window.CodePadGlobals.projectData.name),document.title=window.CodePadGlobals.projectData.name+" - CodePad"))})),document.getElementById("settings-modal").addEventListener("show.bs.modal",(()=>{$("#settings-modal-details-form")[0].initializeForm(window.CodePadGlobals.projectData);const e=$("#custom-web-server-port-input");e.length>0&&window.CodePadGlobals.runSettings&&e.val(window.CodePadGlobals.runSettings.customWebServerPort)}));let e=!1;if($("#settings-modal").on("hide.bs.modal",(t=>{e&&(t.preventDefault(),e=!1)})),$("#settings-modal-ok").click((()=>{const t=$("#custom-web-server-port-input")[0];if(t){if(!t.checkValidity())return e=!0,$("#run-settings-btn").click(),t.focus(),void t.reportValidity();t.disabled||(window.CodePadGlobals.runSettings.customWebServerPort=parseInt(t.value,10))}bootstrap.Modal.getInstance("#settings-modal").hide(),$("#settings-modal-details-form")[0].saveSettings()})),$("#settings-modal-save-details").click((()=>{$("#settings-modal-details-form")[0].saveSettings()})),$("#settings-modal-revert-details").click((()=>{$("#settings-modal-details-form")[0].initializeForm(window.CodePadGlobals.projectData)})),window.CodePadGlobals.projectData.ownerName){const e=()=>{$("#share-btn").length>0&&(window.CodePadGlobals.projectData.linkShareMode==s.P.PUBLIC?($("#more-share-btn-text").text("Shared"),$("#share-btn").removeClass("btn-success"),$("#share-btn").addClass("btn-secondary")):window.CodePadGlobals.projectData.linkShareMode==s.P.UNLISTED?($("#more-share-btn-text").text("Unlisted"),$("#share-btn").removeClass("btn-success"),$("#share-btn").addClass("btn-secondary")):($("#more-share-btn-text").text("Share"),$("#share-btn").addClass("btn-success"),$("#share-btn").removeClass("btn-secondary")))};e(),$("#share-btn").click((()=>{(0,l.x)(window.CodePadGlobals.projectData)})),window.CodePadGlobals.projectData.registerChangeHandler((t=>{"linkShareMode"===t&&e()}))}else if(window.CodePadGlobals.showAnonymousBanner){$("#anonymous-banner").show();const e=new Date(window.CodePadGlobals.projectData.created).getTime(),t=new Date(e+864e5);$("#anonymous-banner-time").text(t.toLocaleString("en-US",{dateStyle:"medium",timeStyle:"short"})),$("#anonymous-banner-close").click((()=>{$("#anonymous-banner").hide()})),$("#anonymous-banner-signup").click((()=>{(0,r.f)()}))}}else{$("#remix-btn").click((()=>{window.CodePadGlobals.userId?location.href="/api/projects/remix_pad/"+window.CodePadGlobals.projectData.id:(0,r.f)("Create an account to remix this pad.")})),(0,mn.l)((e=>{e&&($("#remix-btn").addClass("disabled"),$("#remix-btn-tooltip").attr("data-bs-title","Verify your email to remix more pads."),$("#remix-btn-tooltip").attr("data-bs-toggle","tooltip"),new bootstrap.Tooltip(document.getElementById("remix-btn-tooltip")))})),$("#putcreatedatehere").text(new Date(window.CodePadGlobals.projectData.created).toLocaleString("en-US",{dateStyle:"medium"})),$("#putmoddatehere").text(new Date(window.CodePadGlobals.projectData.modified).toLocaleString("en-US",{dateStyle:"medium"}));const e=$("#pad-details-description");e.length>0&&e.html((0,hn.Gc)(window.CodePadGlobals.projectData.description))}"text"!=window.CodePadGlobals.projectData.lang&&($("#run-settings-tab").show(),$("#run-dropdown-run-settings").click((()=>{bootstrap.Modal.getOrCreateInstance("#settings-modal").show(),$("#run-settings-tab button").click()}))),"text"!==window.CodePadGlobals.projectData.lang&&"edit"===window.CodePadGlobals.mode&&(function(){const e=document.getElementById("add-python-package-btn"),t=document.getElementById("python-package-name"),n=document.getElementById("python-package-version");e&&(e.disabled=!0,e.addEventListener("click",(()=>{yn()}))),t&&(t.addEventListener("input",(()=>{e.disabled=0===t.value.trim().length})),t.addEventListener("keypress",(e=>{"Enter"===e.key&&yn()}))),n&&n.addEventListener("keypress",(e=>{"Enter"===e.key&&yn()}))}(),$("#python-packages-tab").show(),document.getElementById("settings-modal").addEventListener("shown.bs.modal",(()=>{!async function(){try{const e=await fetch("/api/accounts/python_packages");e.ok?(vn=await e.json(),En()):404===e.status&&(vn=[],En())}catch(e){console.error("Failed to load Python packages:",e),vn=[],En()}}()}))),document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach((e=>{new bootstrap.Tooltip(e)})),window.CodePadGlobals.projectData.registerAccessUpdatedHandler((()=>{location.href=location.protocol+"//"+location.host+location.pathname+location.search+"#accessmsg",location.reload()})),i.enable(window.CodePadGlobals.projectData.id),i.registerEventHandler("PROJECT:ACCESS_LEVEL_UPDATED",(e=>{window.CodePadGlobals.projectData.triggerAccessUpdatedEvent(e)})),i.registerEventHandler("PROJECT:DETAILS_UPDATED",(e=>{window.CodePadGlobals.projectData.applyNewData(e)})),i.registerEventHandler("PROJECT:DELETED",(()=>{window.CodePadGlobals.projectData.triggerDeleteEvent()})),"java"!=window.CodePadGlobals.projectData.lang&&"python"!=window.CodePadGlobals.projectData.lang&&"cpp"!=window.CodePadGlobals.projectData.lang||((0,a.M)(),ue()),i.registerEventHandler("CHAT:MESSAGE",V),i.registerEventHandler("CHAT:JOINED_PAD",J),i.registerEventHandler("CHAT:LEFT_PAD",K);const{webDomain:e}=window.CodePadGlobals,{mainFile:t,manualMainFile:n,...c}=window.CodePadGlobals.runSettings,u=new URLSearchParams(window.location.search);let h=null;(u.get("f")||u.get("selected-file"))&&(h=u.get("f")||u.get("selected-file"));const m=(window.CodePadGlobals.mobile||window.CodePadGlobals.embeddedType)&&"true"!==u.get("show-files")||"false"===u.get("show-files"),p=(window.CodePadGlobals.mobile||window.CodePadGlobals.embeddedType)&&"true"!==u.get("side-by-side")||"false"===u.get("side-by-side");let f=null;"text"!=window.CodePadGlobals.projectData.lang&&(f={runConfig:new d.M(window.CodePadGlobals.projectData,c,"edit"===window.CodePadGlobals.mode,"python"===window.CodePadGlobals.projectData.lang,null!=window.CodePadGlobals.userId,!window.CodePadGlobals.isOwner),runBtn:new b});const v=new g(window.CodePadGlobals.preferences,window.CodePadGlobals.tabChar,window.CodePadGlobals.tabSize);let E="monaco";window.CodePadGlobals.mobile&&(E="codemirror"),function(e,t,n,i,a,s,o,l,r){un(r.config.theme);const d={openFiles:[],manualMainFileName:""};let c=()=>{},u=null,h=null,m=new St(window.CodePadGlobals.projectFiles);const p=()=>{if(l){const e=function(e,t){const n={files:[],manualMainFile:!1};e.manualMainFileName&&(n.files.push(e.manualMainFileName),n.manualMainFile=!0);for(let i=0;i<e.openFiles.length;i++){const a=e.openFiles[i];!n.files.includes(a)&&ln(a,t)&&n.files.push(a)}return n}(d,l.runConfig);l.runBtn.setRunnableFiles(e),u&&u.setRunnableFiles(e)}};l&&m.onDidChangeTreeData((()=>{let e="";const t=m.getMainFile();t&&t.data.isManualMainFile&&(e=t.data.fullPath),e!==d.manualMainFileName&&(d.manualMainFileName=e,p())}));const f={global:{tabEnableRename:!1,borderEnableAutoHide:!0},borders:[{type:"border",location:"left",size:220,selected:s?-1:0,children:[{type:"tab",name:"Files",component:"files",icon:"fa-regular fa-folder-open",enableClose:!1}]},{type:"border",location:"right",size:300,selected:-1,children:[]}],layout:{type:"row",weight:100,children:[]}};let g=f.layout.children;if(a&&(f.layout.children.push({type:"row",weight:100,children:[]}),g=f.layout.children[0].children),g.push({type:"tabset",weight:60,selected:0,children:[{type:"tab",name:"Editor",component:"editor",icon:"fa-solid fa-file-pen",config:{initialFile:i??t}}]}),l){let e={type:"tabset",weight:40,selected:0,children:[{type:"tab",name:"Output",component:"output",icon:"/static/images/icons/choose_output.png"}]};"java"==window.CodePadGlobals.projectData.lang||"python"==window.CodePadGlobals.projectData.lang||"cpp"==window.CodePadGlobals.projectData.lang?l.runConfig.config.runInShell?e.children[0].config={initialType:Te.t.SHELL}:e.children[0].config={initialType:Te.t.CONSOLE}:"htmlmixed"!=window.CodePadGlobals.projectData.lang&&"php"!=window.CodePadGlobals.projectData.lang||(e.children[0].config={initialType:Te.t.WEB_PAGE}),g.push(e),"edit"===window.CodePadGlobals.mode&&window.CodePadGlobals.codyAIEnabled&&f.borders[0].children.push({type:"tab",name:"Cody AI",component:"cody-chat",icon:"fa-solid fa-robot",enableClose:!1,borderWidth:400}),"edit"!==window.CodePadGlobals.mode&&"view"!==window.CodePadGlobals.mode||f.borders[0].children.push({type:"tab",name:"Live Chat",component:"live-chat",icon:"fa-regular fa-comment",enableClose:!1,borderWidth:400,className:"live-chat-tab"})}const b=Ie.Kx.fromJson(f);if(h=new tt(b,o,r,((e,t,n)=>{e===et.FILE_OPEN?n?m.modifyFileStyle(t,{bold:!0}):m.modifyFileStyle(t,{bold:null}):e===et.FILE_SAVE?n===Me.UP_TO_DATE?m.modifyFileStyle(t,{color:null}):n===Me.SAVING?m.modifyFileStyle(t,{color:"var(--saving-color)"}):n===Me.CANT_SAVE&&m.modifyFileStyle(t,{color:"var(--bs-danger-rgb)"}):e===et.FILE_MARKER?m.modifyFileStyle(t,{markerData:n}):e===et.FILE_LIST_CHANGE&&(d.openFiles=t,p())}),(e=>{c(e)})),l){"java"==window.CodePadGlobals.projectData.lang||"python"==window.CodePadGlobals.projectData.lang||"cpp"==window.CodePadGlobals.projectData.lang?u=new Pe(b,[Te.t.CONSOLE,Te.t.SHELL,Te.t.WEB_PAGE,Te.t.GUI,Te.t.TESTS],e,l.runConfig):"htmlmixed"!=window.CodePadGlobals.projectData.lang&&"php"!=window.CodePadGlobals.projectData.lang||(u=new Pe(b,[Te.t.SHELL,Te.t.WEB_PAGE],e,l.runConfig)),u.addConsoleRunHandler((e=>{m.setRunningFile(e),e?l.runBtn.showStopButton():l.runBtn.showRunButton()}));let t=!1;u.addTestRunHandler((e=>{t=e,e?($("#run-tests-btn").removeClass("btn-info").addClass("btn-danger"),$("#run-tests-text").text("Cancel Tests")):($("#run-tests-btn").removeClass("btn-danger").addClass("btn-info"),$("#run-tests-text").text("Start Tests"))})),$("#run-tests-btn").click((()=>{t?u.stopTests():u.runTests()})),c=e=>{u&&(h.saveAllFiles(),u.runFile(e))},l.runConfig.registerChangeHandler(((e,t)=>{t.customWebServer!==e.customWebServer&&p()})),l.runBtn.setOnRun((e=>{c(e)})),l.runBtn.setOnStop((()=>{u&&u.stopConsole()})),$("#run-dropdown-output-tab").click((()=>{u.addOutputTab()}))}const v=e=>"editor"===e?h:"output"===e?u:null;b.doActionWithIntercept=e=>{const t=cn(b,v,e);t&&b.doAction(t)},(0,sn.createRoot)(document.getElementById("flexlayout-holder")).render(w.createElement(rn,{model:b,fileDataProvider:m,initialFileState:{fileToLoadCandidate:i,mainFile:t,manualMainFile:n},editorConfig:r,canRunFile:e=>l&&ln(e,l.runConfig),onRunFile:c,onInitiateDelete:e=>{h.initiatedPathDeletes(e)},onClickFile:e=>{h.openFile(e)},onModelChange:()=>{},getAppropriateTabManager:v}))}(e,t,n,h,p,m,E,f,v)}String.prototype.splice=function(e,t,n){return this.slice(0,e)+n+this.slice(e+Math.abs(t))}},18704:(e,t,n)=>{n.d(t,{I:()=>a,O:()=>i}),n(44114),n(17642),n(58004),n(33853),n(45876),n(32475),n(15024),n(31698);class i{#l;#r;#d;#c;#u;#h;#m;#p;static convertArray(e){const t=[];for(const n of e)t.push(new i(n));return t}constructor(e){this.changeHandlers=[],this.deleteHandlers=[],this.accessHandlers=[],this.existingFields=new Set,"string"==typeof e&&(e=JSON.parse(e)),this.#l=this.readField(e,"name",!0),this.#r=this.readField(e,"id",!0),this.#d=this.readField(e,"ownerId",!0),this.#c=this.readField(e,"ownerName",!0),this.#u=this.readField(e,"ownerRealName",!0),this.#h=this.readField(e,"section"),this.#m=this.readField(e,"thumbnail"),this.#p=this.readField(e,"archive")}readNewData(e){this.#l=this.readField(e,"name"),this.#r=this.readField(e,"id"),this.#d=this.readField(e,"ownerId"),this.#c=this.readField(e,"ownerName"),this.#u=this.readField(e,"ownerRealName"),this.#h=this.readField(e,"section"),this.#m=this.readField(e,"thumbnail"),this.#p=this.readField(e,"archive")}readField(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t in e)return this.existingFields.add(t),e[t];if(n)throw new Error('Data is missing field "'+t+'"!');return this.existingFields.has(t)?this[t]:void 0}get id(){return this.#r}get name(){return this.#l}set name(e){if(e!=this.#l){const t=this.#l;this.#l=e,this.triggerChangeEvent("name",t)}}get section(){return this.existingFields.has("section")||console.warn("Accessing ClassroomData.section but it was never loaded from server"),this.#h}set section(e){if(e!=this.#h){const t=this.#h;this.#h=e,this.triggerChangeEvent("section",t)}}get ownerId(){return this.#d}get ownerName(){return this.#c}get ownerRealName(){return this.#u}get thumbnail(){return this.#m}set thumbnail(e){if(e!=this.#m){const t=this.#m;this.#m=e,this.triggerChangeEvent("thumbnail",t)}}forceThumbnailChange(){this.triggerChangeEvent("thumbnail",this.#m)}get archive(){return this.existingFields.has("archive")||console.warn("Accessing ClassroomData.archive but it was never loaded from server"),this.#p}set archive(e){if(e!=this.#p){const t=this.#p;this.#p=e,this.triggerChangeEvent("archive",t)}}registerChangeHandler(e){this.changeHandlers.push(e)}removeChangeHandler(e){const t=this.changeHandlers.indexOf(e);t>=0&&this.changeHandlers.splice(t,1)}triggerChangeEvent(e,t){for(const n of this.changeHandlers)n(e,t)}registerDeleteHandler(e){this.deleteHandlers.push(e)}removeDeleteHandler(e){const t=this.deleteHandlers.indexOf(e);t>=0&&this.deleteHandlers.splice(t,1)}triggerDeleteEvent(){for(const e of this.deleteHandlers)e()}registerAccessUpdatedHandler(e){this.accessHandlers.push(e)}removeAccessUpdatedHandler(e){const t=this.accessHandlers.indexOf(e);t>=0&&this.accessHandlers.splice(t,1)}triggerAccessUpdatedEvent(e){for(const t of this.accessHandlers)t(e)}}class a{static get NOT_STARTED(){return 0}static get IN_PROGRESS(){return 1}static get SUBMITTED(){return 2}}},26779:(e,t,n)=>{n.d(t,{M:()=>a,Z:()=>i});const i=210;function a(e){if(e)if("dark"===document.documentElement.getAttribute("data-bs-theme")){const t=.25,n=.18;document.documentElement.style.setProperty("--navbar-bg",`hsl(${e}, ${100*t}%, ${100*n}%)`)}else{const t=.3,n=.85;document.documentElement.style.setProperty("--navbar-bg",`hsl(${e}, ${100*t}%, ${100*n}%)`)}else document.documentElement.style.removeProperty("--navbar-bg")}},31567:(e,t,n)=>{var i=n(58987),a=n(35086);$("#signup-button").click((()=>{(0,i.f)()})),$("#login-button").click((()=>{(0,a._)()})),$("#logout-link").click((()=>{sessionStorage.clear()}))},35600:(e,t,n)=>{function i(e,t,n){0==$("#confirm-submit-assignment").length&&$("body").append('\n<div class="modal fade" id="confirm-submit-assignment" tabindex="-1" role="dialog">\n    <div class="modal-dialog modal-dialog-centered" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h4 class="modal-title" id="assignment-modal-title"></h4>\n                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n            </div>\n            <div class="modal-body" id="assignment-modal-message"></div>\n            <div class="modal-footer">\n                <button class="btn btn-primary" id="assignment-submit-button" data-bs-dismiss="modal">Submit Assignment</button>\n                <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>\n            </div>\n        </div>\n    </div>\n</div>'),document.querySelectorAll(".modal").forEach((e=>{bootstrap.Modal.getOrCreateInstance(e).hide()})),bootstrap.Modal.getOrCreateInstance("#confirm-submit-assignment").show(),$("#assignment-name-bold").text(e.name),t?($("#assignment-modal-title").text("Submit Assignment"),$("#assignment-submit-button").text("Submit"),$("#assignment-modal-message").html(`<p>Are you sure you want to submit <b>${e.name}</b>?</p>\n            <p>You won't be able to make further changes unless you unsubmit it.</p>`)):($("#assignment-modal-title").text("Unsubmit Assignment"),$("#assignment-submit-button").text("Unsubmit"),$("#assignment-modal-message").html(`<p>Are you sure you want to unsubmit <b>${e.name}</b>?</p>\n            <p>You'll be able to continue working on it.</p>`)),$("#assignment-submit-button").off("click"),$("#assignment-submit-button").click((async function(){try{const t=await fetch("/api/classrooms/toggle_submission",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({assignmentId:e.id})});if(!t.ok)throw new Error(`Response status: ${t.status}`);const i=await t.json();n&&n(i)}catch(e){console.error("Error toggling assignment submission:",e),alert("Failed to update assignment status. Please try again.")}}))}n.d(t,{G:()=>i}),n(18111),n(7588)},75121:e=>{e.exports=0},95863:(e,t,n)=>{n.d(t,{w:()=>a}),n(18111),n(7588);var i=n(9453);function a(e,t,n){0==$("#new-project").length&&$("body").append('\n<div class="modal fade" id="new-project" tabindex="-1" role="dialog" aria-labelledby="new-project-title" aria-hidden="true">\n    <div class="modal-dialog modal-dialog-centered" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h4 class="modal-title" id="new-project-title">New Pad</h4>\n                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n            </div>\n            <form id="new-project-form">\n                <div class="modal-body">\n                    <input id="new-project-parent" name="parent" type="hidden">\n\n                    <div class="alert alert-danger" role="alert" id="unverified-project-limit-msg" style="display: none">\n                        Verify your email address to create more than 5 pads.\n                    </div>\n\n                    <div class="mb-3">\n                        <label class="form-label" for="new-project-name">Pad name:</label>\n                        <input id="new-project-name" class="form-control" name="name" type="text" placeholder="CoolPad" maxlength="50" autocomplete="off">\n                    </div>\n\n                    <label class="form-label">Select a programming language:</label>\n                    <div class="dropdown">\n                        <button class="form-control d-block w-100" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="cursor: default">\n                            <i class="fa-solid fa-caret-down" style="float: right; position: relative; top: 3px;"></i>\n                            <span class="d-flex align-items-center" id="lang-dropdown-title">\n                                <img class="me-2" src="/static/images/icons/html.png" width="16" height="16" alt="HTML/CSS/JS">\n                                HTML/CSS/JS\n                            </span>\n                            <input type="hidden" id="selected-language" name="lang" value="htmlmixed">\n                        </button>\n                        <ul class="dropdown-menu shadow-lg w-100" id="lang-dropdown">\n                            <li><button class="dropdown-item d-flex align-items-center" data-lang="htmlmixed" type="button">\n                                <img class="me-2" src="/static/images/icons/html.png" width="16" height="16" alt="HTML/CSS/JS">\n                                HTML/CSS/JS\n                            </button></li>\n                            <li><button class="dropdown-item d-flex align-items-center" data-lang="python" type="button">\n                                <img class="me-2" src="/static/images/icons/python.png" width="16" height="16" alt="Python">\n                                Python\n                            </button></li>\n                            <li><button class="dropdown-item d-flex align-items-center" data-lang="java" type="button">\n                                <img class="me-2" src="/static/images/icons/java.png" width="16" height="16" alt="Java">\n                                Java\n                            </button></li>\n                            <li><button class="dropdown-item d-flex align-items-center" data-lang="cpp" type="button">\n                                <img class="me-2" src="/static/images/icons/cpp.svg" width="16" height="16" alt="C++">\n                                C++\n                            </button></li>\n                            <li><button class="dropdown-item d-flex align-items-center" data-lang="php" type="button">\n                                <img class="me-2" src="/static/images/icons/php.png" width="16" height="16" alt="PHP">\n                                PHP\n                            </button></li>\n                            <li><button class="dropdown-item d-flex align-items-center" data-lang="text" type="button">\n                                <i class="me-2 pe-1 fa-solid fa-file-lines"></i>\n                                Plain Text\n                            </button></li>\n                        </ul>\n                    </div>\n                </div>\n                <div class="modal-footer">\n                    <button type="submit" class="btn btn-primary" id="create-new-project-btn">Create!</button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>'),$("#create-new-project-btn").prop("disabled",!1),$("#unverified-project-limit-msg").hide(),null==e&&(e=""),$("#new-project-parent").val(e),(0,i.l)((e=>{e&&($("#create-new-project-btn").prop("disabled",!0),$("#unverified-project-limit-msg").show())})),document.querySelectorAll(".modal").forEach((e=>{bootstrap.Modal.getOrCreateInstance(e).hide()})),bootstrap.Modal.getOrCreateInstance("#new-project").show(),$("#new-project-name").off("keydown"),$("#new-project-name").keydown((e=>{"Enter"==e.key&&(e.preventDefault(),e.stopPropagation())})),$("#lang-dropdown button").off("click"),$("#lang-dropdown button").click((e=>{$("#selected-language").val(e.currentTarget.dataset.lang),$("#lang-dropdown-title").html(e.currentTarget.innerHTML)})),$("#new-project-form").off("submit"),$("#new-project-form").on("submit",(async e=>{e.preventDefault();const i=new FormData(document.getElementById("new-project-form"));try{const e=await fetch("/api/projects/new_project",{method:"POST",body:i});if(!e.ok)throw new Error(`Failed to create new pad: ${e.status}`);const a=await e.json(),s=`/edit/${a.id}`;if(t?window.open(s):window.location.href=s,n){const e=Object.fromEntries(i.entries());n({...e,...a})}bootstrap.Modal.getOrCreateInstance("#new-project").hide()}catch(e){console.error(e.message)}}))}}},e=>{e.O(0,[5888,5933,23,7382,5338,8260,3508,6591,710,3304,8370,632],(()=>e(e.s=9264)));var t=e.O();window.PadEditor=t}]);