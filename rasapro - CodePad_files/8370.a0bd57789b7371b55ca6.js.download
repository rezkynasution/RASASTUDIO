"use strict";(self.webpackChunkcodepad=self.webpackChunkcodepad||[]).push([[8370],{18370:(e,t,s)=>{function i(e,t){0==$("#share-project").length&&$("body").append('\n<div class="modal fade" id="share-project" tabindex="-1" role="dialog" aria-hidden="true" data-bs-backdrop="static">\n    <div class="modal-dialog modal-dialog-centered" role="document">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h4 class="modal-title">Sharing for <b id="share-modal-name">Project Name</b></h4>\n                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n            </div>\n            <div class="modal-body">\n                <share-settings id="share-modal-share-settings"></share-settings>\n            </div>\n            <div class="modal-footer">\n                <button id="share-modal-confirm" class="btn btn-primary" data-bs-dismiss="modal">OK</button>\n                <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>\n            </div>\n        </div>\n    </div>\n</div>'),document.querySelectorAll(".modal").forEach((e=>{bootstrap.Modal.getOrCreateInstance(e).hide()})),bootstrap.Modal.getOrCreateInstance("#share-project").show(),$("#share-modal-name").text(e.name),$("#share-modal-confirm").off("click"),$("#share-modal-confirm").click((()=>{$("#share-modal-share-settings")[0].saveSettings()})),$("#share-modal-share-settings")[0].initializeSettings(e),t&&$("#share-modal-share-settings")[0].setUsernameIfAdmin(t)}s.d(t,{x:()=>i}),s(18111),s(7588),s(40656)},40656:(e,t,s)=>{s(18111),s(20116),s(17642),s(58004),s(33853),s(45876),s(32475),s(15024),s(31698);var i=s(89130),n=s(58987),a=s(35086),r=s(77603);class o extends HTMLElement{connectedCallback(){const e=$("#share-settings-template")[0].content;this.appendChild(e.cloneNode(!0)),this.find=e=>$(this).find(e);for(const e of this.find('[data-bs-toggle="tooltip"]').get())new bootstrap.Tooltip(e,{fallbackPlacements:["bottom"]});this.currentProjectData=null,this.isLessonData=!1,this.originalEditUsers=new Set,this.originalViewUsers=new Set,this.newEditUsers=new Set,this.newViewUsers=new Set,this.yourUsername=this.find(".collaborators-list").data("your-username"),this.find(".anonymous-signup-link").click((()=>{(0,n.f)()})),this.find(".anonymous-login-link").click((()=>{(0,a._)()})),this.updateLinkShareDescription(),this.find(".link-share-select").on("input",(()=>{this.updateLinkShareDescription()}));for(const e of this.find(".copy-button").get()){let t=0;const s=new bootstrap.Popover(e,{trigger:"click"});e.addEventListener("click",(()=>{const i=e.getAttribute("data-link");if(!i)return;t&&clearTimeout(t);const n=e=>{s.setContent({".popover-body":e}),t=setTimeout((()=>{s.hide()}),1500)};navigator.clipboard?navigator.clipboard.writeText(i).then((()=>{n("Copied!")}),(()=>{n("Copy failed")})):n("Copy not supported")}))}this.find(".add-collaborator-form").on("submit",(e=>{e.preventDefault(),e.stopPropagation();const t=new FormData(e.currentTarget);this.addCollaboratorByName(t.get("username"))})),this.find(".add-collaborator-form input").on("input",(e=>{e.stopPropagation()})),this.find(".invite-link-regenerate").click((()=>{h(this.currentProjectData)})),this.find(".invite-link-enable-wrapper input").change((e=>{e.stopPropagation(),e.currentTarget.checked?h(this.currentProjectData):async function(e){let t=await fetch("/api/projects/delete_invite_token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e.id})});if(t.ok)e.editorInviteToken=null;else{let e=await t.text();alert(`Failed to delete invite link: ${t.status}\n${e}`)}}(this.currentProjectData)})),this.onProjectDataChange=e=>{if("editorInviteToken"===e){let e="";this.currentProjectData.editorInviteToken?(this.find(".invite-link-enable-wrapper input").prop("checked",!0),this.find(".invite-link-info").show(),e=`${location.protocol}//${location.host}/join_pad/${this.currentProjectData.editorInviteToken}`):(this.find(".invite-link-enable-wrapper input").prop("checked",!1),this.find(".invite-link-info").hide()),this.find(".invite-link-copy").attr("data-link",e),this.find(".invite-link-input").val(e)}}}initializeSettings(e){if(this.currentProjectData&&!this.isLessonData&&this.currentProjectData.removeChangeHandler(this.onProjectDataChange),this.isLessonData=e instanceof r.j,void 0===e&&(e=this.currentProjectData),!this.isLessonData){const e=this.find(".collaborators-wrapper");window.CodePadGlobals.tenantSettings&&window.CodePadGlobals.tenantSettings.collaboration||e.hide()}if(e)if(this.currentProjectData=e,this.find(".show-if-project").show(),null!=e.ownerName||this.isLessonData){if(this.find(".anonymous-sharing-error").hide(),this.find(".change-share-options").show(),this.find(".owner-name").html(""),this.find(".collaborators-list").html(""),this.find(".add-collaborator-form")[0].reset(),this.isLessonData){this.originalEditUsers=new Set,this.originalViewUsers=new Set(e.shareUsers),this.newEditUsers=new Set,this.newViewUsers=new Set(this.originalViewUsers),this.find(".show-if-project").hide();for(const t of e.shareUsers)this.addCollaboratorElement(t,!1)}else{this.originalEditUsers=new Set;for(const t of e.editUsers)this.originalEditUsers.add(t);this.originalViewUsers=new Set;for(const t of e.viewUsers)this.originalViewUsers.add(t);this.newEditUsers=new Set(this.originalEditUsers),this.newViewUsers=new Set(this.originalViewUsers),this.find(".link-share-copy").attr("data-link",`${location.protocol}//${location.host}/edit/${this.currentProjectData.id}`),this.currentProjectData.registerChangeHandler(this.onProjectDataChange),this.onProjectDataChange("editorInviteToken",this.currentProjectData.editorInviteToken),t=this.find(".link-share-select"),(s=e.linkShareMode)==i.P.PUBLIC?t.val("public"):s==i.P.UNLISTED?t.val("unlisted"):t.val("private"),this.updateLinkShareDescription();for(const t of e.viewUsers)this.addCollaboratorElement(t,!1);for(const t of e.editUsers)this.addCollaboratorElement(t,!0)}if(null!=this.currentProjectData.ownerName){let e=this.currentProjectData.ownerName;e==this.yourUsername&&(e+=" (you)");const t=$(`\n<a class="btn btn-transparent d-flex align-items-center flex-grow-1 text-start" href="/user/${this.currentProjectData.ownerName}" target="_blank" title="Open profile page in new tab">\n<img src="/profilepic/${this.currentProjectData.ownerName}" width="32" class="me-2" style="border-radius: 50%">\n${e}\n<span class="ms-auto">\n    Owner\n</span>\n</a>`);this.find(".owner-name").prepend(t)}}else this.find(".anonymous-sharing-error").show(),this.find(".change-share-options").hide();var t,s}setUsernameIfAdmin(e){this.usernameIfAdmin=e}haveSettingsChanged(){const e=(e,t)=>e.size===t.size&&0===e.difference(t).size;return!e(this.originalEditUsers,this.newEditUsers)||!e(this.originalViewUsers,this.newViewUsers)||!this.isLessonData&&d(this.find(".link-share-select"))!=this.currentProjectData.linkShareMode}async saveSettings(){if(this.haveSettingsChanged())if(this.isLessonData){let e=[...this.newViewUsers],t="/api/lessons/update_sharing";const s={lessonId:this.currentProjectData.id,shareUsers:e};this.usernameIfAdmin&&(t="/api/admin/update_shared_lesson_users",s.username=this.usernameIfAdmin),(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok&&(this.currentProjectData.shareUsers=e)}else if(null!=this.currentProjectData.ownerName){let e=null;const t=d(this.find(".link-share-select"));t!=this.currentProjectData.linkShareMode&&(e=t);const s=this.newEditUsers.difference(this.originalEditUsers),n=this.originalEditUsers.difference(this.newEditUsers),a=this.newViewUsers.difference(this.originalViewUsers),r=this.originalViewUsers.difference(this.newViewUsers);!async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Set,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Set,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new Set;const d={};if(null!=s&&(d.linkShareMode=s),n.size>0&&(d.addedEditUsers=[...n]),a.size>0&&(d.removedEditUsers=[...a]),r.size>0&&(d.addedViewUsers=[...r]),o.size>0&&(d.removedViewUsers=[...o]),0==Object.keys(d).length)return;const h=await fetch("/api/projects/update_sharing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e.id,...d})});if(h.ok){if(null!=s&&(e.linkShareMode=s),r.size>0||o.size>0){let t=e.viewUsers;t=t.union(r),t=t.difference(o),e.viewUsers=t}if(n.size>0||a.size>0){let s=e.editUsers;if(s=s.union(n),s=s.difference(a),e.editUsers=s,e.ownerName!==t&&!s.has(t)){let s="view";e.linkShareMode!=i.P.PRIVATE||e.viewUsers.has(t)||(s="none"),e.triggerAccessUpdatedEvent(s)}}}else{const e=await h.text();alert(`Failed to save settings: ${h.status}\n${e}`)}}(this.currentProjectData,this.yourUsername,e,s,n,a,r)}}updateLinkShareDescription(){const e=d(this.find(".link-share-select"));e==i.P.PRIVATE?this.find(".link-share-explanation").text("Only collaborators can access."):e==i.P.PUBLIC?this.find(".link-share-explanation").text("Anyone with the link can view, and the pad will be advertised on CodePad's homepage."):e==i.P.UNLISTED&&this.find(".link-share-explanation").text("Anyone with the link can view.")}addCollaboratorElement(e,t){let s="fa-eye";t&&(s="fa-pen");let i=e;e==this.yourUsername&&(i+=" (you)");let n=`\n<button class="btn btn-transparent dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">\n    <i class="fa-solid ${s}"></i>\n</button>\n<div class="dropdown" style="margin-left: auto;">\n    <div class="dropdown-menu dropdown-menu-end">\n        <a class="dropdown-item view-option" href="javascript:"><i class="fa-solid fa-eye me-2"></i>Viewer</a>\n        <a class="dropdown-item edit-option" href="javascript:"><i class="fa-solid fa-pen me-2"></i>Editor</a>\n    </div>\n</div>`;this.isLessonData&&(n="");const a=$(`\n<div class="input-group d-flex">\n<a class="btn btn-transparent d-flex align-items-center flex-grow-1 text-start" href="/user/${e}" target="_blank" title="Open profile page in new tab">\n    <img src="/profilepic/${e}" width="32" class="me-2" style="border-radius: 50%">\n    ${i}\n</a>\n${n}\n<button class="btn btn-transparent remove-btn">\n    <i class="fa-solid fa-trash text-danger"></i>\n</button>\n</div>`),r=this.find(".collaborators-list");if(r.prepend(a),!this.isLessonData){const t=a.find(".dropdown-toggle");new bootstrap.Dropdown(t[0]),a.find(".view-option").click((()=>{t.find("i").removeClass("fa-pen").addClass("fa-eye"),r.trigger("input"),this.newEditUsers.delete(e),this.newViewUsers.add(e)})),a.find(".edit-option").click((()=>{t.find("i").addClass("fa-pen").removeClass("fa-eye"),r.trigger("input"),this.newEditUsers.add(e),this.newViewUsers.delete(e)}))}a.find(".remove-btn").click((()=>{a.remove(),r.trigger("input"),this.newEditUsers.delete(e),this.newViewUsers.delete(e)}))}async addCollaboratorByName(e){if((e=e.toLowerCase())==this.yourUsername.toLowerCase())return;const t=await fetch("/api/accounts/get_username_with_case/"+e);if(t.ok){const e=this.find(".add-collaborator-form");this.find(".no-user-error").hide(),e[0].reset();const s=await t.text();if(this.newEditUsers.has(s)||this.newViewUsers.has(s))return;this.newViewUsers.add(s),this.addCollaboratorElement(s,!1),e.trigger("input")}else this.find(".no-user-error").show()}}function d(e){return"public"===e.val()?i.P.PUBLIC:"unlisted"===e.val()?i.P.UNLISTED:i.P.PRIVATE}async function h(e){let t=await fetch("/api/projects/generate_invite_token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e.id})}),s=await t.text();t.ok?e.editorInviteToken=s:alert(`Failed to generate invite link: ${t.status}\n${s}`)}customElements.define("share-settings",o)},77603:(e,t,s)=>{s.d(t,{G:()=>n,j:()=>i}),s(18111),s(61701),s(17642),s(58004),s(33853),s(45876),s(32475),s(15024),s(31698);class i{#e;#t;#s;#i;#n;#a;#r;#o;#d;#h;#l;#c;#g;static convertArray(e){return e.map((e=>new i(e)))}constructor(e){this.existingFields=new Set,"string"==typeof e&&(e=JSON.parse(e)),this.#e=this.readField(e,"id",!0),this.#t=this.readField(e,"created"),this.#s=this.readField(e,"name",!0),this.#i=this.readField(e,"description"),this.#n=this.readField(e,"thumbnail"),this.#a=this.readField(e,"authorName"),this.#r=this.readField(e,"adminsOnly"),this.#o=this.readField(e,"stepsEnabled"),this.#d=this.readField(e,"steps"),this.#o&&this.validateStepData(this.#d),this.#h=this.readField(e,"isInstructor"),this.#l=this.readField(e,"wasInvited"),this.#c=this.readField(e,"shareUsers"),this.#g=this.readField(e,"status")}readField(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t in e)return this.existingFields.add(t),e[t];if(s)throw new Error('Data is missing field "'+t+'"!');return this.existingFields.has(t)?this[t]:void 0}validateStepData(e){for(let t=0;t<e.length;t++)"path"in e[t]||console.warn("Lesson "+this.#e+", step "+t+' is missing attribute "path"!'),"title"in e[t]||console.warn("Lesson "+this.#e+", step "+t+' is missing attribute "title"!')}get id(){return this.#e}get created(){return this.existingFields.has("created")||console.warn("Accessing LessonData.created but it was never loaded from server"),this.#t}get name(){return this.#s}get description(){return this.existingFields.has("description")||console.warn("Accessing LessonData.description but it was never loaded from server"),this.#i}get thumbnail(){return this.existingFields.has("thumbnail")||console.warn("Accessing LessonData.thumbnail but it was never loaded from server"),this.#n}get authorName(){return this.existingFields.has("authorName")||console.warn("Accessing LessonData.authorName but it was never loaded from server"),this.#a}get adminsOnly(){return this.existingFields.has("adminsOnly")||console.warn("Accessing LessonData.adminsOnly but it was never loaded from server"),this.#r}get stepsEnabled(){return this.existingFields.has("stepsEnabled")||console.warn("Accessing LessonData.stepsEnabled but it was never loaded from server"),this.#o}get steps(){return this.existingFields.has("steps")||console.warn("Accessing LessonData.steps but it was never loaded from server"),this.#d}get isInstructor(){return this.existingFields.has("isInstructor")||console.warn("Accessing LessonData.isInstructor but it was never loaded from server"),this.#h}get wasInvited(){return this.existingFields.has("wasInvited")||console.warn("Accessing LessonData.wasInvited but it was never loaded from server"),this.#l}get shareUsers(){return this.existingFields.has("shareUsers")||console.warn("Accessing LessonData.shareUsers but it was never loaded from server"),this.#c}set shareUsers(e){this.#c=e}get status(){return this.existingFields.has("status")||console.warn("Accessing LessonData.status but it was never loaded from server"),this.#g}}class n{#u;constructor(e){"string"==typeof e&&(e=JSON.parse(e)),this.#u=e.path}get path(){return this.#u}}},89130:(e,t,s)=>{s.d(t,{P:()=>a,w:()=>n}),s(44114),s(18111),s(61701),s(17642),s(58004),s(33853),s(45876),s(32475),s(15024),s(31698);const i={};class n{#e;#s;#i;#f;#p;#n;#t;#m;#w;#v;#b;#k;#U;#S;#D;#F;#P;#y;static convertArray(e){return e.map((e=>new n(e)))}constructor(e){this.changeHandlers=[],this.deleteHandlers=[],this.accessHandlers=[],this.existingFields=new Set,"string"==typeof e&&(e=JSON.parse(e));const t=this.readField(e,"id",!0);if(t in i){const s=i[t];return s.existingFields.has("description")||(s.#i=s.readField(e,"description")),s.existingFields.has("created")||(s.#t=s.readField(e,"created")),s.existingFields.has("linkShareMode")||(s.#w=s.readField(e,"linkShareMode")),s.existingFields.has("editUsers")||(s.#v=s.readField(e,"editUsers")),s.existingFields.has("viewUsers")||(s.#b=s.readField(e,"viewUsers")),s.existingFields.has("parentId")||(s.#k=s.readField(e,"parentId")),s.existingFields.has("firstShareDate")||(s.#D=s.readField(e,"firstShareDate")),s.existingFields.has("likeDate")||(s.#F=s.readField(e,"likeDate")),s.existingFields.has("totalLikes")||(s.#U=s.readField(e,"totalLikes")),s.existingFields.has("isSubmittedAssignment")||(s.#y=s.readField(e,"isSubmittedAssignment")),s}i[t]=this,this.#e=t,this.#s=this.readField(e,"name",!0),this.#i=this.readField(e,"description"),this.#f=this.readField(e,"lang",!0),this.#p=this.readField(e,"ownerName",!0),this.#n=this.readField(e,"thumbnail",!0),this.#t=this.readField(e,"created"),this.#m=this.readField(e,"modified",!0),this.#w=this.readField(e,"linkShareMode"),this.#v=this.readField(e,"editUsers"),this.#b=this.readField(e,"viewUsers"),this.#k=this.readField(e,"parentId"),this.#D=this.readField(e,"firstShareDate"),this.#F=this.readField(e,"likeDate"),this.#U=this.readField(e,"totalLikes"),this.#P=this.readField(e,"editorInviteToken"),this.#y=this.readField(e,"isSubmittedAssignment")}applyNewData(e){this.name=this.readField(e,"name"),this.description=this.readField(e,"description"),this.thumbnail=this.readField(e,"thumbnail"),this.modified=this.readField(e,"modified"),this.linkShareMode=this.readField(e,"linkShareMode"),this.editUsers=this.readField(e,"editUsers"),this.viewUsers=this.readField(e,"viewUsers"),this.editorInviteToken=this.readField(e,"editorInviteToken")}readField(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t in e)return this.existingFields.add(t),"editUsers"===t||"viewUsers"===t?new Set(e[t]):e[t];if(s)throw new Error('Project data is missing field "'+t+'"!');return this.existingFields.has(t)?this[t]:void 0}get id(){return this.#e}get name(){return this.#s}set name(e){if(e!=this.#s){const t=this.#s;this.#s=e,this.triggerChangeEvent("name",t)}}get description(){return this.existingFields.has("description")||console.warn("Accessing ProjectData.description but it was never loaded from server"),this.#i}set description(e){if(e!=this.#i){const t=this.#i;this.#i=e,this.triggerChangeEvent("description",t)}}get lang(){return this.#f}get ownerName(){return this.#p}get thumbnail(){return this.#n}set thumbnail(e){if(e!=this.#n){const t=this.#n;this.#n=e,this.triggerChangeEvent("thumbnail",t)}}forceThumbnailChange(){this.triggerChangeEvent("thumbnail",this.#n)}get created(){return this.existingFields.has("created")||console.warn("Accessing ProjectData.created but it was never loaded from server"),this.#t}get modified(){return this.#m}set modified(e){if(e!=this.#m){const t=this.#m;this.#m=e,this.triggerChangeEvent("modified",t)}}get firstShareDate(){return this.existingFields.has("firstShareDate")||console.warn("Accessing ProjectData.firstShareDate but it was never loaded from server"),this.#D}get likeDate(){return this.existingFields.has("likeDate")||console.warn("Accessing ProjectData.likeDate but it was never loaded from server"),this.#F}get linkShareMode(){return this.existingFields.has("linkShareMode")||console.warn("Accessing ProjectData.linkShareMode but it was never loaded from server"),this.#w}get totalLikes(){return this.existingFields.has("totalLikes")||console.warn("Accessing ProjectData.totalLikes but it was never loaded from server"),this.#U}set totalLikes(e){if(e!=this.#U){const t=this.#U;this.#U=e,this.triggerChangeEvent("totalLikes",t)}}set linkShareMode(e){if(e!=this.#w){const t=this.#w;this.#w=e,this.triggerChangeEvent("linkShareMode",t)}}get editUsers(){return this.existingFields.has("editUsers")||console.warn("Accessing ProjectData.editUsers but it was never loaded from server"),new Set(this.#v)}set editUsers(e){if(e instanceof Set){if(e.size!=this.editUsers.size||e.difference(this.editUsers).size>0){const t=this.#v;this.#v=new Set(e),this.triggerChangeEvent("editUsers",t)}}else console.warn("Tried setting ProjectData.editUsers, but new data wasn't a Set")}get viewUsers(){return this.existingFields.has("viewUsers")||console.warn("Accessing ProjectData.viewUsers but it was never loaded from server"),new Set(this.#b)}set viewUsers(e){if(e instanceof Set){if(e.size!=this.viewUsers.size||e.difference(this.viewUsers).size>0){const t=this.#b;this.#b=new Set(e),this.triggerChangeEvent("viewUsers",t)}}else console.warn("Tried setting ProjectData.viewUsers, but new data wasn't a Set")}get parentPath(){return this.#S}set parentPath(e){this.#S=e}get parentId(){return this.existingFields.has("parentId")||console.warn("Accessing ProjectData.parentId but it was never loaded from server"),this.#k}get editorInviteToken(){return this.existingFields.has("editorInviteToken")||console.warn("Accessing ProjectData.editorInviteToken but it was never loaded from server"),this.#P}get isSubmittedAssignment(){return!!this.existingFields.has("isSubmittedAssignment")&&this.#y}set editorInviteToken(e){if(e!=this.#P){const t=this.#P;this.#P=e,this.triggerChangeEvent("editorInviteToken",t)}}registerChangeHandler(e){this.changeHandlers.push(e)}removeChangeHandler(e){const t=this.changeHandlers.indexOf(e);t>=0&&this.changeHandlers.splice(t,1)}triggerChangeEvent(e,t){for(const s of this.changeHandlers.slice())s(e,t)}registerDeleteHandler(e){this.deleteHandlers.push(e)}removeDeleteHandler(e){const t=this.deleteHandlers.indexOf(e);t>=0&&this.deleteHandlers.splice(t,1)}triggerDeleteEvent(){for(const e of this.deleteHandlers.slice())e()}registerAccessUpdatedHandler(e){this.accessHandlers.push(e)}removeAccessUpdatedHandler(e){const t=this.accessHandlers.indexOf(e);t>=0&&this.accessHandlers.splice(t,1)}triggerAccessUpdatedEvent(e){for(const t of this.accessHandlers.slice())t(e)}}class a{static get PRIVATE(){return 0}static get PUBLIC(){return 1}static get UNLISTED(){return 2}}}}]);